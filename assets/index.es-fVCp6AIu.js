import{bb as Nn,g as Tn,bc as Mu,ba as Bu,c as Kr}from"./index-DxQ2fk7C.js";import{s as ju,a as zu,d as qu,f as mr,g as ta,c as Ku,b as Pn,e as Vu,h as Rn,p as Hu}from"./format-DMa376I5.js";var Cn={exports:{}},er=typeof Reflect=="object"?Reflect:null,_s=er&&typeof er.apply=="function"?er.apply:function(e,r,i){return Function.prototype.apply.call(e,r,i)},Xr;er&&typeof er.ownKeys=="function"?Xr=er.ownKeys:Object.getOwnPropertySymbols?Xr=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Xr=function(e){return Object.getOwnPropertyNames(e)};function ku(t){console&&console.warn&&console.warn(t)}var ra=Number.isNaN||function(e){return e!==e};function oe(){oe.init.call(this)}Cn.exports=oe;Cn.exports.once=Ju;oe.EventEmitter=oe;oe.prototype._events=void 0;oe.prototype._eventsCount=0;oe.prototype._maxListeners=void 0;var Es=10;function li(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(oe,"defaultMaxListeners",{enumerable:!0,get:function(){return Es},set:function(t){if(typeof t!="number"||t<0||ra(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Es=t}});oe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};oe.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||ra(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function ia(t){return t._maxListeners===void 0?oe.defaultMaxListeners:t._maxListeners}oe.prototype.getMaxListeners=function(){return ia(this)};oe.prototype.emit=function(e){for(var r=[],i=1;i<arguments.length;i++)r.push(arguments[i]);var n=e==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var o;if(r.length>0&&(o=r[0]),o instanceof Error)throw o;var c=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw c.context=o,c}var u=s[e];if(u===void 0)return!1;if(typeof u=="function")_s(u,this,r);else for(var h=u.length,l=ca(u,h),i=0;i<h;++i)_s(l[i],this,r);return!0};function na(t,e,r,i){var n,s,o;if(li(r),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),o=s[e]),o===void 0)o=s[e]=r,++t._eventsCount;else if(typeof o=="function"?o=s[e]=i?[r,o]:[o,r]:i?o.unshift(r):o.push(r),n=ia(t),n>0&&o.length>n&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=o.length,ku(c)}return t}oe.prototype.addListener=function(e,r){return na(this,e,r,!1)};oe.prototype.on=oe.prototype.addListener;oe.prototype.prependListener=function(e,r){return na(this,e,r,!0)};function Gu(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function sa(t,e,r){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},n=Gu.bind(i);return n.listener=r,i.wrapFn=n,n}oe.prototype.once=function(e,r){return li(r),this.on(e,sa(this,e,r)),this};oe.prototype.prependOnceListener=function(e,r){return li(r),this.prependListener(e,sa(this,e,r)),this};oe.prototype.removeListener=function(e,r){var i,n,s,o,c;if(li(r),n=this._events,n===void 0)return this;if(i=n[e],i===void 0)return this;if(i===r||i.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||r));else if(typeof i!="function"){for(s=-1,o=i.length-1;o>=0;o--)if(i[o]===r||i[o].listener===r){c=i[o].listener,s=o;break}if(s<0)return this;s===0?i.shift():Wu(i,s),i.length===1&&(n[e]=i[0]),n.removeListener!==void 0&&this.emit("removeListener",e,c||r)}return this};oe.prototype.off=oe.prototype.removeListener;oe.prototype.removeAllListeners=function(e){var r,i,n;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var s=Object.keys(i),o;for(n=0;n<s.length;++n)o=s[n],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=i[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(n=r.length-1;n>=0;n--)this.removeListener(e,r[n]);return this};function oa(t,e,r){var i=t._events;if(i===void 0)return[];var n=i[e];return n===void 0?[]:typeof n=="function"?r?[n.listener||n]:[n]:r?Yu(n):ca(n,n.length)}oe.prototype.listeners=function(e){return oa(this,e,!0)};oe.prototype.rawListeners=function(e){return oa(this,e,!1)};oe.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):aa.call(t,e)};oe.prototype.listenerCount=aa;function aa(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}oe.prototype.eventNames=function(){return this._eventsCount>0?Xr(this._events):[]};function ca(t,e){for(var r=new Array(e),i=0;i<e;++i)r[i]=t[i];return r}function Wu(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Yu(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function Ju(t,e){return new Promise(function(r,i){function n(o){t.removeListener(e,s),i(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",n),r([].slice.call(arguments))}ua(t,e,s,{once:!0}),e!=="error"&&Qu(t,n,{once:!0})})}function Qu(t,e,r){typeof t.on=="function"&&ua(t,"error",e,r)}function ua(t,e,r,i){if(typeof t.on=="function")i.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function n(s){i.once&&t.removeEventListener(e,n),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var at=Cn.exports;const ha=Nn(at),Xu=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Zu=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,eh=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function th(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){rh(t);return}return e}function rh(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function Vr(t,e={}){if(typeof t!="string")return t;const r=t.trim();if(t[0]==='"'&&t.endsWith('"')&&!t.includes("\\"))return r.slice(1,-1);if(r.length<=9){const i=r.toLowerCase();if(i==="true")return!0;if(i==="false")return!1;if(i==="undefined")return;if(i==="null")return null;if(i==="nan")return Number.NaN;if(i==="infinity")return Number.POSITIVE_INFINITY;if(i==="-infinity")return Number.NEGATIVE_INFINITY}if(!eh.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(Xu.test(t)||Zu.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,th)}return JSON.parse(t)}catch(i){if(e.strict)throw i;return t}}function ih(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function Te(t,...e){try{return ih(t(...e))}catch(r){return Promise.reject(r)}}function nh(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function sh(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function Zr(t){if(nh(t))return String(t);if(sh(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return Zr(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const sn="base64:";function oh(t){return typeof t=="string"?t:sn+uh(t)}function ah(t){return typeof t!="string"||!t.startsWith(sn)?t:ch(t.slice(sn.length))}function ch(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function uh(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function He(t){var e;return t&&((e=t.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function hh(...t){return He(t.join(":"))}function Hr(t){return t=He(t),t?t+":":""}const lh="memory",fh=()=>{const t=new Map;return{name:lh,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function dh(t={}){const e={mounts:{"":t.driver||fh()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=h=>{for(const l of e.mountpoints)if(h.startsWith(l))return{base:l,relativeKey:h.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:h,driver:e.mounts[""]}},i=(h,l)=>e.mountpoints.filter(f=>f.startsWith(h)||l&&h.startsWith(f)).map(f=>({relativeBase:h.length>f.length?h.slice(f.length):void 0,mountpoint:f,driver:e.mounts[f]})),n=(h,l)=>{if(e.watching){l=He(l);for(const f of e.watchListeners)f(h,l)}},s=async()=>{if(!e.watching){e.watching=!0;for(const h in e.mounts)e.unwatch[h]=await vs(e.mounts[h],n,h)}},o=async()=>{if(e.watching){for(const h in e.unwatch)await e.unwatch[h]();e.unwatch={},e.watching=!1}},c=(h,l,f)=>{const d=new Map,w=y=>{let S=d.get(y.base);return S||(S={driver:y.driver,base:y.base,items:[]},d.set(y.base,S)),S};for(const y of h){const S=typeof y=="string",I=He(S?y:y.key),T=S?void 0:y.value,v=S||!y.options?l:{...l,...y.options},m=r(I);w(m).items.push({key:I,value:T,relativeKey:m.relativeKey,options:v})}return Promise.all([...d.values()].map(y=>f(y))).then(y=>y.flat())},u={hasItem(h,l={}){h=He(h);const{relativeKey:f,driver:d}=r(h);return Te(d.hasItem,f,l)},getItem(h,l={}){h=He(h);const{relativeKey:f,driver:d}=r(h);return Te(d.getItem,f,l).then(w=>Vr(w))},getItems(h,l={}){return c(h,l,f=>f.driver.getItems?Te(f.driver.getItems,f.items.map(d=>({key:d.relativeKey,options:d.options})),l).then(d=>d.map(w=>({key:hh(f.base,w.key),value:Vr(w.value)}))):Promise.all(f.items.map(d=>Te(f.driver.getItem,d.relativeKey,d.options).then(w=>({key:d.key,value:Vr(w)})))))},getItemRaw(h,l={}){h=He(h);const{relativeKey:f,driver:d}=r(h);return d.getItemRaw?Te(d.getItemRaw,f,l):Te(d.getItem,f,l).then(w=>ah(w))},async setItem(h,l,f={}){if(l===void 0)return u.removeItem(h);h=He(h);const{relativeKey:d,driver:w}=r(h);w.setItem&&(await Te(w.setItem,d,Zr(l),f),w.watch||n("update",h))},async setItems(h,l){await c(h,l,async f=>{if(f.driver.setItems)return Te(f.driver.setItems,f.items.map(d=>({key:d.relativeKey,value:Zr(d.value),options:d.options})),l);f.driver.setItem&&await Promise.all(f.items.map(d=>Te(f.driver.setItem,d.relativeKey,Zr(d.value),d.options)))})},async setItemRaw(h,l,f={}){if(l===void 0)return u.removeItem(h,f);h=He(h);const{relativeKey:d,driver:w}=r(h);if(w.setItemRaw)await Te(w.setItemRaw,d,l,f);else if(w.setItem)await Te(w.setItem,d,oh(l),f);else return;w.watch||n("update",h)},async removeItem(h,l={}){typeof l=="boolean"&&(l={removeMeta:l}),h=He(h);const{relativeKey:f,driver:d}=r(h);d.removeItem&&(await Te(d.removeItem,f,l),(l.removeMeta||l.removeMata)&&await Te(d.removeItem,f+"$",l),d.watch||n("remove",h))},async getMeta(h,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),h=He(h);const{relativeKey:f,driver:d}=r(h),w=Object.create(null);if(d.getMeta&&Object.assign(w,await Te(d.getMeta,f,l)),!l.nativeOnly){const y=await Te(d.getItem,f+"$",l).then(S=>Vr(S));y&&typeof y=="object"&&(typeof y.atime=="string"&&(y.atime=new Date(y.atime)),typeof y.mtime=="string"&&(y.mtime=new Date(y.mtime)),Object.assign(w,y))}return w},setMeta(h,l,f={}){return this.setItem(h+"$",l,f)},removeMeta(h,l={}){return this.removeItem(h+"$",l)},async getKeys(h,l={}){h=Hr(h);const f=i(h,!0);let d=[];const w=[];for(const y of f){const S=await Te(y.driver.getKeys,y.relativeBase,l);for(const I of S){const T=y.mountpoint+He(I);d.some(v=>T.startsWith(v))||w.push(T)}d=[y.mountpoint,...d.filter(I=>!I.startsWith(y.mountpoint))]}return h?w.filter(y=>y.startsWith(h)&&y[y.length-1]!=="$"):w.filter(y=>y[y.length-1]!=="$")},async clear(h,l={}){h=Hr(h),await Promise.all(i(h,!1).map(async f=>{if(f.driver.clear)return Te(f.driver.clear,f.relativeBase,l);if(f.driver.removeItem){const d=await f.driver.getKeys(f.relativeBase||"",l);return Promise.all(d.map(w=>f.driver.removeItem(w,l)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(h=>Ds(h)))},async watch(h){return await s(),e.watchListeners.push(h),async()=>{e.watchListeners=e.watchListeners.filter(l=>l!==h),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(h,l){if(h=Hr(h),h&&e.mounts[h])throw new Error(`already mounted at ${h}`);return h&&(e.mountpoints.push(h),e.mountpoints.sort((f,d)=>d.length-f.length)),e.mounts[h]=l,e.watching&&Promise.resolve(vs(l,n,h)).then(f=>{e.unwatch[h]=f}).catch(console.error),u},async unmount(h,l=!0){var f,d;h=Hr(h),!(!h||!e.mounts[h])&&(e.watching&&h in e.unwatch&&((d=(f=e.unwatch)[h])==null||d.call(f),delete e.unwatch[h]),l&&await Ds(e.mounts[h]),e.mountpoints=e.mountpoints.filter(w=>w!==h),delete e.mounts[h])},getMount(h=""){h=He(h)+":";const l=r(h);return{driver:l.driver,base:l.base}},getMounts(h="",l={}){return h=He(h),i(h,l.parents).map(d=>({driver:d.driver,base:d.mountpoint}))},keys:(h,l={})=>u.getKeys(h,l),get:(h,l={})=>u.getItem(h,l),set:(h,l,f={})=>u.setItem(h,l,f),has:(h,l={})=>u.hasItem(h,l),del:(h,l={})=>u.removeItem(h,l),remove:(h,l={})=>u.removeItem(h,l)};return u}function vs(t,e,r){return t.watch?t.watch((i,n)=>e(i,r+n)):()=>{}}async function Ds(t){typeof t.dispose=="function"&&await Te(t.dispose)}function Vt(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function la(t,e){const r=indexedDB.open(t);r.onupgradeneeded=()=>r.result.createObjectStore(e);const i=Vt(r);return(n,s)=>i.then(o=>s(o.transaction(e,n).objectStore(e)))}let $i;function Or(){return $i||($i=la("keyval-store","keyval")),$i}function Ss(t,e=Or()){return e("readonly",r=>Vt(r.get(t)))}function ph(t,e,r=Or()){return r("readwrite",i=>(i.put(e,t),Vt(i.transaction)))}function gh(t,e=Or()){return e("readwrite",r=>(r.delete(t),Vt(r.transaction)))}function yh(t=Or()){return t("readwrite",e=>(e.clear(),Vt(e.transaction)))}function bh(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Vt(t.transaction)}function wh(t=Or()){return t("readonly",e=>{if(e.getAllKeys)return Vt(e.getAllKeys());const r=[];return bh(e,i=>r.push(i.key)).then(()=>r)})}const mh=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),_h=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,n)=>typeof n=="string"&&n.match(/^\d+n$/)?BigInt(n.substring(0,n.length-1)):n)};function fi(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return _h(t)}catch{return t}}function xr(t){return typeof t=="string"?t:mh(t)||""}const Eh="idb-keyval";var vh=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=n=>e+n;let i;return t.dbName&&t.storeName&&(i=la(t.dbName,t.storeName)),{name:Eh,options:t,async hasItem(n){return!(typeof await Ss(r(n),i)>"u")},async getItem(n){return await Ss(r(n),i)??null},setItem(n,s){return ph(r(n),s,i)},removeItem(n){return gh(r(n),i)},getKeys(){return wh(i)},clear(){return yh(i)}}};const Dh="WALLET_CONNECT_V2_INDEXED_DB",Sh="keyvaluestorage";let Ih=class{constructor(){this.indexedDb=dh({driver:vh({dbName:Dh,storeName:Sh})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,xr(r))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Fi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ei={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Fi<"u"&&Fi.localStorage?ei.exports=Fi.localStorage:typeof window<"u"&&window.localStorage?ei.exports=window.localStorage:ei.exports=new e})();function Oh(t){var e;return[t[0],fi((e=t[1])!=null?e:"")]}let xh=class{constructor(){this.localStorage=ei.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Oh)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return fi(r)}async setItem(e,r){this.localStorage.setItem(e,xr(r))}async removeItem(e){this.localStorage.removeItem(e)}};const Ah="wc_storage_version",Is=1,Nh=async(t,e,r)=>{const i=Ah,n=await e.getItem(i);if(n&&n>=Is){r(e);return}const s=await t.getKeys();if(!s.length){r(e);return}const o=[];for(;s.length;){const c=s.shift();if(!c)continue;const u=c.toLowerCase();if(u.includes("wc@")||u.includes("walletconnect")||u.includes("wc_")||u.includes("wallet_connect")){const h=await t.getItem(c);await e.setItem(c,h),o.push(c)}}await e.setItem(i,Is),r(e),Th(t,o)},Th=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};let Ph=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new xh;this.storage=e;try{const r=new Ih;Nh(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};var rr={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var on=function(t,e){return on=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},on(t,e)};function Rh(t,e){on(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var an=function(){return an=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},an.apply(this,arguments)};function Ch(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function $h(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(s=(n<3?o(s):n>3?o(e,r,s):o(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function Fh(t,e){return function(r,i){e(r,i,t)}}function Uh(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Lh(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function c(l){try{h(i.next(l))}catch(f){o(f)}}function u(l){try{h(i.throw(l))}catch(f){o(f)}}function h(l){l.done?s(l.value):n(l.value).then(c,u)}h((i=i.apply(t,e||[])).next())})}function Mh(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(h){return function(l){return u([h,l])}}function u(h){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=h[0]&2?n.return:h[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,h[1])).done)return s;switch(n=0,s&&(h=[h[0]&2,s.value]),h[0]){case 0:case 1:s=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,n=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(h[0]===6||h[0]===2)){r=0;continue}if(h[0]===3&&(!s||h[1]>s[0]&&h[1]<s[3])){r.label=h[1];break}if(h[0]===6&&r.label<s[1]){r.label=s[1],s=h;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(h);break}s[2]&&r.ops.pop(),r.trys.pop();continue}h=e.call(t,r)}catch(l){h=[6,l],n=0}finally{i=s=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function Bh(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function jh(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function cn(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function fa(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function zh(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(fa(arguments[e]));return t}function qh(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],o=0,c=s.length;o<c;o++,n++)i[n]=s[o];return i}function _r(t){return this instanceof _r?(this.v=t,this):new _r(t)}function Kh(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(d){i[d]&&(n[d]=function(w){return new Promise(function(y,S){s.push([d,w,y,S])>1||c(d,w)})})}function c(d,w){try{u(i[d](w))}catch(y){f(s[0][3],y)}}function u(d){d.value instanceof _r?Promise.resolve(d.value.v).then(h,l):f(s[0][2],d)}function h(d){c("next",d)}function l(d){c("throw",d)}function f(d,w){d(w),s.shift(),s.length&&c(s[0][0],s[0][1])}}function Vh(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(o){return(r=!r)?{value:_r(t[n](o)),done:n==="return"}:s?s(o):o}:s}}function Hh(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof cn=="function"?cn(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(o){return new Promise(function(c,u){o=t[s](o),n(c,u,o.done,o.value)})}}function n(s,o,c,u){Promise.resolve(u).then(function(h){s({value:h,done:c})},o)}}function kh(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Gh(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function Wh(t){return t&&t.__esModule?t:{default:t}}function Yh(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Jh(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const Qh=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return an},__asyncDelegator:Vh,__asyncGenerator:Kh,__asyncValues:Hh,__await:_r,__awaiter:Lh,__classPrivateFieldGet:Yh,__classPrivateFieldSet:Jh,__createBinding:Bh,__decorate:$h,__exportStar:jh,__extends:Rh,__generator:Mh,__importDefault:Wh,__importStar:Gh,__makeTemplateObject:kh,__metadata:Uh,__param:Fh,__read:fa,__rest:Ch,__spread:zh,__spreadArrays:qh,__values:cn},Symbol.toStringTag,{value:"Module"})),di=Tn(Qh);var ur={},j={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var un=function(t,e){return un=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},un(t,e)};function Xh(t,e){un(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var hn=function(){return hn=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},hn.apply(this,arguments)};function Zh(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function el(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(s=(n<3?o(s):n>3?o(e,r,s):o(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function tl(t,e){return function(r,i){e(r,i,t)}}function rl(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function il(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function c(l){try{h(i.next(l))}catch(f){o(f)}}function u(l){try{h(i.throw(l))}catch(f){o(f)}}function h(l){l.done?s(l.value):n(l.value).then(c,u)}h((i=i.apply(t,e||[])).next())})}function nl(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(h){return function(l){return u([h,l])}}function u(h){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=h[0]&2?n.return:h[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,h[1])).done)return s;switch(n=0,s&&(h=[h[0]&2,s.value]),h[0]){case 0:case 1:s=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,n=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(h[0]===6||h[0]===2)){r=0;continue}if(h[0]===3&&(!s||h[1]>s[0]&&h[1]<s[3])){r.label=h[1];break}if(h[0]===6&&r.label<s[1]){r.label=s[1],s=h;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(h);break}s[2]&&r.ops.pop(),r.trys.pop();continue}h=e.call(t,r)}catch(l){h=[6,l],n=0}finally{i=s=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function sl(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function ol(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function ln(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function da(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function al(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(da(arguments[e]));return t}function cl(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],o=0,c=s.length;o<c;o++,n++)i[n]=s[o];return i}function Er(t){return this instanceof Er?(this.v=t,this):new Er(t)}function ul(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(d){i[d]&&(n[d]=function(w){return new Promise(function(y,S){s.push([d,w,y,S])>1||c(d,w)})})}function c(d,w){try{u(i[d](w))}catch(y){f(s[0][3],y)}}function u(d){d.value instanceof Er?Promise.resolve(d.value.v).then(h,l):f(s[0][2],d)}function h(d){c("next",d)}function l(d){c("throw",d)}function f(d,w){d(w),s.shift(),s.length&&c(s[0][0],s[0][1])}}function hl(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(o){return(r=!r)?{value:Er(t[n](o)),done:n==="return"}:s?s(o):o}:s}}function ll(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof ln=="function"?ln(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(o){return new Promise(function(c,u){o=t[s](o),n(c,u,o.done,o.value)})}}function n(s,o,c,u){Promise.resolve(u).then(function(h){s({value:h,done:c})},o)}}function fl(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function dl(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function pl(t){return t&&t.__esModule?t:{default:t}}function gl(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function yl(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const bl=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return hn},__asyncDelegator:hl,__asyncGenerator:ul,__asyncValues:ll,__await:Er,__awaiter:il,__classPrivateFieldGet:gl,__classPrivateFieldSet:yl,__createBinding:sl,__decorate:el,__exportStar:ol,__extends:Xh,__generator:nl,__importDefault:pl,__importStar:dl,__makeTemplateObject:fl,__metadata:rl,__param:tl,__read:da,__rest:Zh,__spread:al,__spreadArrays:cl,__values:ln},Symbol.toStringTag,{value:"Module"})),pi=Tn(bl);var Ui={},hr={},Os;function wl(){if(Os)return hr;Os=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return hr.delay=t,hr}var Bt={},Li={},jt={},xs;function ml(){return xs||(xs=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.ONE_THOUSAND=jt.ONE_HUNDRED=void 0,jt.ONE_HUNDRED=100,jt.ONE_THOUSAND=1e3),jt}var Mi={},As;function _l(){return As||(As=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(Mi)),Mi}var Ns;function pa(){return Ns||(Ns=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=pi;e.__exportStar(ml(),t),e.__exportStar(_l(),t)}(Li)),Li}var Ts;function El(){if(Ts)return Bt;Ts=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.fromMiliseconds=Bt.toMiliseconds=void 0;const t=pa();function e(i){return i*t.ONE_THOUSAND}Bt.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return Bt.fromMiliseconds=r,Bt}var Ps;function vl(){return Ps||(Ps=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=pi;e.__exportStar(wl(),t),e.__exportStar(El(),t)}(Ui)),Ui}var Yt={},Rs;function Dl(){if(Rs)return Yt;Rs=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const n=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:n})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return Yt.Watch=t,Yt.default=t,Yt}var Bi={},lr={},Cs;function Sl(){if(Cs)return lr;Cs=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.IWatch=void 0;class t{}return lr.IWatch=t,lr}var $s;function Il(){return $s||($s=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),pi.__exportStar(Sl(),t)}(Bi)),Bi}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=pi;e.__exportStar(vl(),t),e.__exportStar(Dl(),t),e.__exportStar(Il(),t),e.__exportStar(pa(),t)})(j);var ji={},fr={};class Ht{}const Ol=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Ht},Symbol.toStringTag,{value:"Module"})),xl=Tn(Ol);var Fs;function Al(){if(Fs)return fr;Fs=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.IHeartBeat=void 0;const t=xl;class e extends t.IEvents{constructor(i){super()}}return fr.IHeartBeat=e,fr}var Us;function ga(){return Us||(Us=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),di.__exportStar(Al(),t)}(ji)),ji}var zi={},zt={},Ls;function Nl(){if(Ls)return zt;Ls=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.HEARTBEAT_EVENTS=zt.HEARTBEAT_INTERVAL=void 0;const t=j;return zt.HEARTBEAT_INTERVAL=t.FIVE_SECONDS,zt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},zt}var Ms;function ya(){return Ms||(Ms=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),di.__exportStar(Nl(),t)}(zi)),zi}var Bs;function Tl(){if(Bs)return ur;Bs=1,Object.defineProperty(ur,"__esModule",{value:!0}),ur.HeartBeat=void 0;const t=di,e=at,r=j,i=ga(),n=ya();class s extends i.IHeartBeat{constructor(c){super(c),this.events=new e.EventEmitter,this.interval=n.HEARTBEAT_INTERVAL,this.interval=(c==null?void 0:c.interval)||n.HEARTBEAT_INTERVAL}static init(c){return t.__awaiter(this,void 0,void 0,function*(){const u=new s(c);return yield u.init(),u})}init(){return t.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(c,u){this.events.on(c,u)}once(c,u){this.events.once(c,u)}off(c,u){this.events.off(c,u)}removeListener(c,u){this.events.removeListener(c,u)}initialize(){return t.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(n.HEARTBEAT_EVENTS.pulse)}}return ur.HeartBeat=s,ur}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=di;e.__exportStar(Tl(),t),e.__exportStar(ga(),t),e.__exportStar(ya(),t)})(rr);function Pl(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var Rl=Cl;function Cl(t,e,r){var i=r&&r.stringify||Pl,n=1;if(typeof t=="object"&&t!==null){var s=e.length+n;if(s===1)return t;var o=new Array(s);o[0]=i(t);for(var c=1;c<s;c++)o[c]=i(e[c]);return o.join(" ")}if(typeof t!="string")return t;var u=e.length;if(u===0)return t;for(var h="",l=1-n,f=-1,d=t&&t.length||0,w=0;w<d;){if(t.charCodeAt(w)===37&&w+1<d){switch(f=f>-1?f:0,t.charCodeAt(w+1)){case 100:case 102:if(l>=u||e[l]==null)break;f<w&&(h+=t.slice(f,w)),h+=Number(e[l]),f=w+2,w++;break;case 105:if(l>=u||e[l]==null)break;f<w&&(h+=t.slice(f,w)),h+=Math.floor(Number(e[l])),f=w+2,w++;break;case 79:case 111:case 106:if(l>=u||e[l]===void 0)break;f<w&&(h+=t.slice(f,w));var y=typeof e[l];if(y==="string"){h+="'"+e[l]+"'",f=w+2,w++;break}if(y==="function"){h+=e[l].name||"<anonymous>",f=w+2,w++;break}h+=i(e[l]),f=w+2,w++;break;case 115:if(l>=u)break;f<w&&(h+=t.slice(f,w)),h+=String(e[l]),f=w+2,w++;break;case 37:f<w&&(h+=t.slice(f,w)),h+="%",f=w+2,w++,l--;break}++l}++w}return f===-1?t:(f<d&&(h+=t.slice(f)),h)}const js=Rl;var $l=pt;const vr=Vl().console||{},Fl={mapHttpRequest:kr,mapHttpResponse:kr,wrapRequestSerializer:qi,wrapResponseSerializer:qi,wrapErrorSerializer:qi,req:kr,res:kr,err:jl};function Ul(t,e){return Array.isArray(t)?t.filter(function(i){return i!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function pt(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||vr;t.browser.write&&(t.browser.asObject=!0);const i=t.serializers||{},n=Ul(t.browser.serialize,i);let s=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);const o=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),t.enabled===!1&&(t.level="silent");const c=t.level||"info",u=Object.create(r);u.log||(u.log=Dr),Object.defineProperty(u,"levelVal",{get:l}),Object.defineProperty(u,"level",{get:f,set:d});const h={transmit:e,serialize:n,asObject:t.browser.asObject,levels:o,timestamp:zl(t)};u.levels=pt.levels,u.level=c,u.setMaxListeners=u.getMaxListeners=u.emit=u.addListener=u.on=u.prependListener=u.once=u.prependOnceListener=u.removeListener=u.removeAllListeners=u.listeners=u.listenerCount=u.eventNames=u.write=u.flush=Dr,u.serializers=i,u._serialize=n,u._stdErrSerialize=s,u.child=w,e&&(u._logEvent=fn());function l(){return this.level==="silent"?1/0:this.levels.values[this.level]}function f(){return this._level}function d(y){if(y!=="silent"&&!this.levels.values[y])throw Error("unknown level "+y);this._level=y,Jt(h,u,"error","log"),Jt(h,u,"fatal","error"),Jt(h,u,"warn","error"),Jt(h,u,"info","log"),Jt(h,u,"debug","log"),Jt(h,u,"trace","log")}function w(y,S){if(!y)throw new Error("missing bindings for child Pino");S=S||{},n&&y.serializers&&(S.serializers=y.serializers);const I=S.serializers;if(n&&I){var T=Object.assign({},i,I),v=t.browser.serialize===!0?Object.keys(T):n;delete y.serializers,gi([y],v,T,this._stdErrSerialize)}function m(b){this._childLevel=(b._childLevel|0)+1,this.error=Qt(b,y,"error"),this.fatal=Qt(b,y,"fatal"),this.warn=Qt(b,y,"warn"),this.info=Qt(b,y,"info"),this.debug=Qt(b,y,"debug"),this.trace=Qt(b,y,"trace"),T&&(this.serializers=T,this._serialize=v),e&&(this._logEvent=fn([].concat(b._logEvent.bindings,y)))}return m.prototype=this,new m(this)}return u}pt.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};pt.stdSerializers=Fl;pt.stdTimeFunctions=Object.assign({},{nullTime:ba,epochTime:wa,unixTime:ql,isoTime:Kl});function Jt(t,e,r,i){const n=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?Dr:n[r]?n[r]:vr[r]||vr[i]||Dr,Ll(t,e,r)}function Ll(t,e,r){!t.transmit&&e[r]===Dr||(e[r]=function(i){return function(){const s=t.timestamp(),o=new Array(arguments.length),c=Object.getPrototypeOf&&Object.getPrototypeOf(this)===vr?vr:this;for(var u=0;u<o.length;u++)o[u]=arguments[u];if(t.serialize&&!t.asObject&&gi(o,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?i.call(c,Ml(this,r,o,s)):i.apply(c,o),t.transmit){const h=t.transmit.level||e.level,l=pt.levels.values[h],f=pt.levels.values[r];if(f<l)return;Bl(this,{ts:s,methodLevel:r,methodValue:f,transmitLevel:h,transmitValue:pt.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},o)}}}(e[r]))}function Ml(t,e,r,i){t._serialize&&gi(r,t._serialize,t.serializers,t._stdErrSerialize);const n=r.slice();let s=n[0];const o={};i&&(o.time=i),o.level=pt.levels.values[e];let c=(t._childLevel|0)+1;if(c<1&&(c=1),s!==null&&typeof s=="object"){for(;c--&&typeof n[0]=="object";)Object.assign(o,n.shift());s=n.length?js(n.shift(),n):void 0}else typeof s=="string"&&(s=js(n.shift(),n));return s!==void 0&&(o.msg=s),o}function gi(t,e,r,i){for(const n in t)if(i&&t[n]instanceof Error)t[n]=pt.stdSerializers.err(t[n]);else if(typeof t[n]=="object"&&!Array.isArray(t[n]))for(const s in t[n])e&&e.indexOf(s)>-1&&s in r&&(t[n][s]=r[s](t[n][s]))}function Qt(t,e,r){return function(){const i=new Array(1+arguments.length);i[0]=e;for(var n=1;n<i.length;n++)i[n]=arguments[n-1];return t[r].apply(this,i)}}function Bl(t,e,r){const i=e.send,n=e.ts,s=e.methodLevel,o=e.methodValue,c=e.val,u=t._logEvent.bindings;gi(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=n,t._logEvent.messages=r.filter(function(h){return u.indexOf(h)===-1}),t._logEvent.level.label=s,t._logEvent.level.value=o,i(s,t._logEvent,c),t._logEvent=fn(u)}function fn(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function jl(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function zl(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?ba:wa}function kr(){return{}}function qi(t){return t}function Dr(){}function ba(){return!1}function wa(){return Date.now()}function ql(){return Math.round(Date.now()/1e3)}function Kl(){return new Date(Date.now()).toISOString()}function Vl(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}const $n=Nn($l),Hl={level:"info"},Ar="custom_context";var kl=Object.defineProperty,Gl=Object.defineProperties,Wl=Object.getOwnPropertyDescriptors,zs=Object.getOwnPropertySymbols,Yl=Object.prototype.hasOwnProperty,Jl=Object.prototype.propertyIsEnumerable,qs=(t,e,r)=>e in t?kl(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ql=(t,e)=>{for(var r in e||(e={}))Yl.call(e,r)&&qs(t,r,e[r]);if(zs)for(var r of zs(e))Jl.call(e,r)&&qs(t,r,e[r]);return t},Xl=(t,e)=>Gl(t,Wl(e));function Fn(t){return Xl(Ql({},t),{level:(t==null?void 0:t.level)||Hl.level})}function Zl(t,e=Ar){return t[e]||""}function ef(t,e,r=Ar){return t[r]=e,t}function Ge(t,e=Ar){let r="";return typeof t.bindings>"u"?r=Zl(t,e):r=t.bindings().context||"",r}function tf(t,e,r=Ar){const i=Ge(t,r);return i.trim()?`${i}/${e}`:e}function Qe(t,e,r=Ar){const i=tf(t,e,r),n=t.child({context:i});return ef(n,i,r)}let rf=class extends Ht{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}},nf=class extends Ht{constructor(e,r){super(),this.core=e,this.logger=r,this.records=new Map}};class sf{constructor(e,r){this.logger=e,this.core=r}}class of extends Ht{constructor(e,r){super(),this.relayer=e,this.logger=r}}let af=class extends Ht{constructor(e){super()}},cf=class{constructor(e,r,i,n){this.core=e,this.logger=r,this.name=i}};class uf extends Ht{constructor(e,r){super(),this.relayer=e,this.logger=r}}let hf=class extends Ht{constructor(e,r){super(),this.core=e,this.logger=r}};class lf{constructor(e,r){this.projectId=e,this.logger=r}}let ff=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}};class df{constructor(e){this.client=e}}function pf(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ma(t,...e){if(!pf(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Ks(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function gf(t,e){ma(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const Xt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ki=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function yf(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function _a(t){return typeof t=="string"&&(t=yf(t)),ma(t),t}let bf=class{clone(){return this._cloneInto()}};function wf(t){const e=i=>t().update(_a(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Ea(t=32){if(Xt&&typeof Xt.getRandomValues=="function")return Xt.getRandomValues(new Uint8Array(t));if(Xt&&typeof Xt.randomBytes=="function")return Xt.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function mf(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),c=Number(r&s),u=i?4:0,h=i?0:4;t.setUint32(e+u,o,i),t.setUint32(e+h,c,i)}class _f extends bf{constructor(e,r,i,n){super(),this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ki(this.buffer)}update(e){Ks(this);const{view:r,buffer:i,blockLen:n}=this;e=_a(e);const s=e.length;for(let o=0;o<s;){const c=Math.min(n-this.pos,s-o);if(c===n){const u=Ki(e);for(;n<=s-o;o+=n)this.process(u,o);continue}i.set(e.subarray(o,o+c),this.pos),this.pos+=c,o+=c,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ks(this),gf(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:n,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>n-o&&(this.process(i,0),o=0);for(let f=o;f<n;f++)r[f]=0;mf(i,n-8,BigInt(this.length*8),s),this.process(i,0);const c=Ki(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const h=u/4,l=this.get();if(h>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<h;f++)c.setUint32(4*f,l[f],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:n,finished:s,destroyed:o,pos:c}=this;return e.length=n,e.pos=c,e.finished=s,e.destroyed=o,n%r&&e.buffer.set(i),e}}const Gr=BigInt(2**32-1),dn=BigInt(32);function va(t,e=!1){return e?{h:Number(t&Gr),l:Number(t>>dn&Gr)}:{h:Number(t>>dn&Gr)|0,l:Number(t&Gr)|0}}function Ef(t,e=!1){let r=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let n=0;n<t.length;n++){const{h:s,l:o}=va(t[n],e);[r[n],i[n]]=[s,o]}return[r,i]}const vf=(t,e)=>BigInt(t>>>0)<<dn|BigInt(e>>>0),Df=(t,e,r)=>t>>>r,Sf=(t,e,r)=>t<<32-r|e>>>r,If=(t,e,r)=>t>>>r|e<<32-r,Of=(t,e,r)=>t<<32-r|e>>>r,xf=(t,e,r)=>t<<64-r|e>>>r-32,Af=(t,e,r)=>t>>>r-32|e<<64-r,Nf=(t,e)=>e,Tf=(t,e)=>t,Pf=(t,e,r)=>t<<r|e>>>32-r,Rf=(t,e,r)=>e<<r|t>>>32-r,Cf=(t,e,r)=>e<<r-32|t>>>64-r,$f=(t,e,r)=>t<<r-32|e>>>64-r;function Ff(t,e,r,i){const n=(e>>>0)+(i>>>0);return{h:t+r+(n/2**32|0)|0,l:n|0}}const Uf=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),Lf=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,Mf=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),Bf=(t,e,r,i,n)=>e+r+i+n+(t/2**32|0)|0,jf=(t,e,r,i,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(n>>>0),zf=(t,e,r,i,n,s)=>e+r+i+n+s+(t/2**32|0)|0,ee={fromBig:va,split:Ef,toBig:vf,shrSH:Df,shrSL:Sf,rotrSH:If,rotrSL:Of,rotrBH:xf,rotrBL:Af,rotr32H:Nf,rotr32L:Tf,rotlSH:Pf,rotlSL:Rf,rotlBH:Cf,rotlBL:$f,add:Ff,add3L:Uf,add3H:Lf,add4L:Mf,add4H:Bf,add5H:zf,add5L:jf},[qf,Kf]=ee.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),xt=new Uint32Array(80),At=new Uint32Array(80);let Vf=class extends _f{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:i,Bl:n,Ch:s,Cl:o,Dh:c,Dl:u,Eh:h,El:l,Fh:f,Fl:d,Gh:w,Gl:y,Hh:S,Hl:I}=this;return[e,r,i,n,s,o,c,u,h,l,f,d,w,y,S,I]}set(e,r,i,n,s,o,c,u,h,l,f,d,w,y,S,I){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=n|0,this.Ch=s|0,this.Cl=o|0,this.Dh=c|0,this.Dl=u|0,this.Eh=h|0,this.El=l|0,this.Fh=f|0,this.Fl=d|0,this.Gh=w|0,this.Gl=y|0,this.Hh=S|0,this.Hl=I|0}process(e,r){for(let m=0;m<16;m++,r+=4)xt[m]=e.getUint32(r),At[m]=e.getUint32(r+=4);for(let m=16;m<80;m++){const b=xt[m-15]|0,_=At[m-15]|0,E=ee.rotrSH(b,_,1)^ee.rotrSH(b,_,8)^ee.shrSH(b,_,7),a=ee.rotrSL(b,_,1)^ee.rotrSL(b,_,8)^ee.shrSL(b,_,7),p=xt[m-2]|0,A=At[m-2]|0,F=ee.rotrSH(p,A,19)^ee.rotrBH(p,A,61)^ee.shrSH(p,A,6),z=ee.rotrSL(p,A,19)^ee.rotrBL(p,A,61)^ee.shrSL(p,A,6),K=ee.add4L(a,z,At[m-7],At[m-16]),G=ee.add4H(K,E,F,xt[m-7],xt[m-16]);xt[m]=G|0,At[m]=K|0}let{Ah:i,Al:n,Bh:s,Bl:o,Ch:c,Cl:u,Dh:h,Dl:l,Eh:f,El:d,Fh:w,Fl:y,Gh:S,Gl:I,Hh:T,Hl:v}=this;for(let m=0;m<80;m++){const b=ee.rotrSH(f,d,14)^ee.rotrSH(f,d,18)^ee.rotrBH(f,d,41),_=ee.rotrSL(f,d,14)^ee.rotrSL(f,d,18)^ee.rotrBL(f,d,41),E=f&w^~f&S,a=d&y^~d&I,p=ee.add5L(v,_,a,Kf[m],At[m]),A=ee.add5H(p,T,b,E,qf[m],xt[m]),F=p|0,z=ee.rotrSH(i,n,28)^ee.rotrBH(i,n,34)^ee.rotrBH(i,n,39),K=ee.rotrSL(i,n,28)^ee.rotrBL(i,n,34)^ee.rotrBL(i,n,39),G=i&s^i&c^s&c,Y=n&o^n&u^o&u;T=S|0,v=I|0,S=w|0,I=y|0,w=f|0,y=d|0,{h:f,l:d}=ee.add(h|0,l|0,A|0,F|0),h=c|0,l=u|0,c=s|0,u=o|0,s=i|0,o=n|0;const C=ee.add3L(F,K,Y);i=ee.add3H(C,A,z,G),n=C|0}({h:i,l:n}=ee.add(this.Ah|0,this.Al|0,i|0,n|0)),{h:s,l:o}=ee.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:c,l:u}=ee.add(this.Ch|0,this.Cl|0,c|0,u|0),{h,l}=ee.add(this.Dh|0,this.Dl|0,h|0,l|0),{h:f,l:d}=ee.add(this.Eh|0,this.El|0,f|0,d|0),{h:w,l:y}=ee.add(this.Fh|0,this.Fl|0,w|0,y|0),{h:S,l:I}=ee.add(this.Gh|0,this.Gl|0,S|0,I|0),{h:T,l:v}=ee.add(this.Hh|0,this.Hl|0,T|0,v|0),this.set(i,n,s,o,c,u,h,l,f,d,w,y,S,I,T,v)}roundClean(){xt.fill(0),At.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const Hf=wf(()=>new Vf);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Un=BigInt(0),Da=BigInt(1),kf=BigInt(2);function Ln(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Mn(t){if(!Ln(t))throw new Error("Uint8Array expected")}function Vi(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const Gf=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Bn(t){Mn(t);let e="";for(let r=0;r<t.length;r++)e+=Gf[t[r]];return e}function Sa(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Un:BigInt("0x"+t)}const wt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Vs(t){if(t>=wt._0&&t<=wt._9)return t-wt._0;if(t>=wt.A&&t<=wt.F)return t-(wt.A-10);if(t>=wt.a&&t<=wt.f)return t-(wt.a-10)}function Ia(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let n=0,s=0;n<r;n++,s+=2){const o=Vs(t.charCodeAt(s)),c=Vs(t.charCodeAt(s+1));if(o===void 0||c===void 0){const u=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+u+'" at index '+s)}i[n]=o*16+c}return i}function Wf(t){return Sa(Bn(t))}function ti(t){return Mn(t),Sa(Bn(Uint8Array.from(t).reverse()))}function Oa(t,e){return Ia(t.toString(16).padStart(e*2,"0"))}function pn(t,e){return Oa(t,e).reverse()}function mt(t,e,r){let i;if(typeof e=="string")try{i=Ia(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Ln(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const n=i.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return i}function Hs(...t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];Mn(n),e+=n.length}const r=new Uint8Array(e);for(let i=0,n=0;i<t.length;i++){const s=t[i];r.set(s,n),n+=s.length}return r}const Hi=t=>typeof t=="bigint"&&Un<=t;function Yf(t,e,r){return Hi(t)&&Hi(e)&&Hi(r)&&e<=t&&t<r}function dr(t,e,r,i){if(!Yf(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function Jf(t){let e;for(e=0;t>Un;t>>=Da,e+=1);return e}const Qf=t=>(kf<<BigInt(t-1))-Da,Xf={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Ln(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function jn(t,e,r={}){const i=(n,s,o)=>{const c=Xf[s];if(typeof c!="function")throw new Error("invalid validator function");const u=t[n];if(!(o&&u===void 0)&&!c(u,t))throw new Error("param "+String(n)+" is invalid. Expected "+s+", got "+u)};for(const[n,s]of Object.entries(e))i(n,s,!1);for(const[n,s]of Object.entries(r))i(n,s,!0);return t}function ks(t){const e=new WeakMap;return(r,...i)=>{const n=e.get(r);if(n!==void 0)return n;const s=t(r,...i);return e.set(r,s),s}}const Ce=BigInt(0),ve=BigInt(1),qt=BigInt(2),Zf=BigInt(3),gn=BigInt(4),Gs=BigInt(5),Ws=BigInt(8);function xe(t,e){const r=t%e;return r>=Ce?r:e+r}function ed(t,e,r){if(e<Ce)throw new Error("invalid exponent, negatives unsupported");if(r<=Ce)throw new Error("invalid modulus");if(r===ve)return Ce;let i=ve;for(;e>Ce;)e&ve&&(i=i*t%r),t=t*t%r,e>>=ve;return i}function ht(t,e,r){let i=t;for(;e-- >Ce;)i*=i,i%=r;return i}function Ys(t,e){if(t===Ce)throw new Error("invert: expected non-zero number");if(e<=Ce)throw new Error("invert: expected positive modulus, got "+e);let r=xe(t,e),i=e,n=Ce,s=ve;for(;r!==Ce;){const o=i/r,c=i%r,u=n-s*o;i=r,r=c,n=s,s=u}if(i!==ve)throw new Error("invert: does not exist");return xe(n,e)}function td(t){const e=(t-ve)/qt;let r,i,n;for(r=t-ve,i=0;r%qt===Ce;r/=qt,i++);for(n=qt;n<t&&ed(n,e,t)!==t-ve;n++)if(n>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const o=(t+ve)/gn;return function(c,u){const h=c.pow(u,o);if(!c.eql(c.sqr(h),u))throw new Error("Cannot find square root");return h}}const s=(r+ve)/qt;return function(o,c){if(o.pow(c,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let u=i,h=o.pow(o.mul(o.ONE,n),r),l=o.pow(c,s),f=o.pow(c,r);for(;!o.eql(f,o.ONE);){if(o.eql(f,o.ZERO))return o.ZERO;let d=1;for(let y=o.sqr(f);d<u&&!o.eql(y,o.ONE);d++)y=o.sqr(y);const w=o.pow(h,ve<<BigInt(u-d-1));h=o.sqr(w),l=o.mul(l,w),f=o.mul(f,h),u=d}return l}}function rd(t){if(t%gn===Zf){const e=(t+ve)/gn;return function(r,i){const n=r.pow(i,e);if(!r.eql(r.sqr(n),i))throw new Error("Cannot find square root");return n}}if(t%Ws===Gs){const e=(t-Gs)/Ws;return function(r,i){const n=r.mul(i,qt),s=r.pow(n,e),o=r.mul(i,s),c=r.mul(r.mul(o,qt),s),u=r.mul(o,r.sub(c,r.ONE));if(!r.eql(r.sqr(u),i))throw new Error("Cannot find square root");return u}}return td(t)}const id=(t,e)=>(xe(t,e)&ve)===ve,nd=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function sd(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=nd.reduce((i,n)=>(i[n]="function",i),e);return jn(t,r)}function od(t,e,r){if(r<Ce)throw new Error("invalid exponent, negatives unsupported");if(r===Ce)return t.ONE;if(r===ve)return e;let i=t.ONE,n=e;for(;r>Ce;)r&ve&&(i=t.mul(i,n)),n=t.sqr(n),r>>=ve;return i}function ad(t,e){const r=new Array(e.length),i=e.reduce((s,o,c)=>t.is0(o)?s:(r[c]=s,t.mul(s,o)),t.ONE),n=t.inv(i);return e.reduceRight((s,o,c)=>t.is0(o)?s:(r[c]=t.mul(s,r[c]),t.mul(s,o)),n),r}function xa(t,e){const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function Aa(t,e,r=!1,i={}){if(t<=Ce)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:n,nByteLength:s}=xa(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const c=Object.freeze({ORDER:t,isLE:r,BITS:n,BYTES:s,MASK:Qf(n),ZERO:Ce,ONE:ve,create:u=>xe(u,t),isValid:u=>{if(typeof u!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof u);return Ce<=u&&u<t},is0:u=>u===Ce,isOdd:u=>(u&ve)===ve,neg:u=>xe(-u,t),eql:(u,h)=>u===h,sqr:u=>xe(u*u,t),add:(u,h)=>xe(u+h,t),sub:(u,h)=>xe(u-h,t),mul:(u,h)=>xe(u*h,t),pow:(u,h)=>od(c,u,h),div:(u,h)=>xe(u*Ys(h,t),t),sqrN:u=>u*u,addN:(u,h)=>u+h,subN:(u,h)=>u-h,mulN:(u,h)=>u*h,inv:u=>Ys(u,t),sqrt:i.sqrt||(u=>(o||(o=rd(t)),o(c,u))),invertBatch:u=>ad(c,u),cmov:(u,h,l)=>l?h:u,toBytes:u=>r?pn(u,s):Oa(u,s),fromBytes:u=>{if(u.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+u.length);return r?ti(u):Wf(u)}});return Object.freeze(c)}const Js=BigInt(0),Wr=BigInt(1);function ki(t,e){const r=e.negate();return t?r:e}function Na(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Gi(t,e){Na(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1);return{windows:r,windowSize:i}}function cd(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function ud(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const Wi=new WeakMap,Ta=new WeakMap;function Yi(t){return Ta.get(t)||1}function hd(t,e){return{constTimeNegate:ki,hasPrecomputes(r){return Yi(r)!==1},unsafeLadder(r,i,n=t.ZERO){let s=r;for(;i>Js;)i&Wr&&(n=n.add(s)),s=s.double(),i>>=Wr;return n},precomputeWindow(r,i){const{windows:n,windowSize:s}=Gi(i,e),o=[];let c=r,u=c;for(let h=0;h<n;h++){u=c,o.push(u);for(let l=1;l<s;l++)u=u.add(c),o.push(u);c=u.double()}return o},wNAF(r,i,n){const{windows:s,windowSize:o}=Gi(r,e);let c=t.ZERO,u=t.BASE;const h=BigInt(2**r-1),l=2**r,f=BigInt(r);for(let d=0;d<s;d++){const w=d*o;let y=Number(n&h);n>>=f,y>o&&(y-=l,n+=Wr);const S=w,I=w+Math.abs(y)-1,T=d%2!==0,v=y<0;y===0?u=u.add(ki(T,i[S])):c=c.add(ki(v,i[I]))}return{p:c,f:u}},wNAFUnsafe(r,i,n,s=t.ZERO){const{windows:o,windowSize:c}=Gi(r,e),u=BigInt(2**r-1),h=2**r,l=BigInt(r);for(let f=0;f<o;f++){const d=f*c;if(n===Js)break;let w=Number(n&u);if(n>>=l,w>c&&(w-=h,n+=Wr),w===0)continue;let y=i[d+Math.abs(w)-1];w<0&&(y=y.negate()),s=s.add(y)}return s},getPrecomputes(r,i,n){let s=Wi.get(i);return s||(s=this.precomputeWindow(i,r),r!==1&&Wi.set(i,n(s))),s},wNAFCached(r,i,n){const s=Yi(r);return this.wNAF(s,this.getPrecomputes(s,r,n),i)},wNAFCachedUnsafe(r,i,n,s){const o=Yi(r);return o===1?this.unsafeLadder(r,i,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,n),i,s)},setWindowSize(r,i){Na(i,e),Ta.set(r,i),Wi.delete(r)}}}function ld(t,e,r,i){if(cd(r,t),ud(i,e),r.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const n=t.ZERO,s=Jf(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,c=(1<<o)-1,u=new Array(c+1).fill(n),h=Math.floor((e.BITS-1)/o)*o;let l=n;for(let f=h;f>=0;f-=o){u.fill(n);for(let w=0;w<i.length;w++){const y=i[w],S=Number(y>>BigInt(f)&BigInt(c));u[S]=u[S].add(r[w])}let d=n;for(let w=u.length-1,y=n;w>0;w--)y=y.add(u[w]),d=d.add(y);if(l=l.add(d),f!==0)for(let w=0;w<o;w++)l=l.double()}return l}function fd(t){return sd(t.Fp),jn(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...xa(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const it=BigInt(0),Ke=BigInt(1),Yr=BigInt(2),dd=BigInt(8),pd={zip215:!0};function gd(t){const e=fd(t);return jn(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function yd(t){const e=gd(t),{Fp:r,n:i,prehash:n,hash:s,randomBytes:o,nByteLength:c,h:u}=e,h=Yr<<BigInt(c*8)-Ke,l=r.create,f=Aa(e.n,e.nBitLength),d=e.uvRatio||((C,O)=>{try{return{isValid:!0,value:r.sqrt(C*r.inv(O))}}catch{return{isValid:!1,value:it}}}),w=e.adjustScalarBytes||(C=>C),y=e.domain||((C,O,x)=>{if(Vi("phflag",x),O.length||x)throw new Error("Contexts/pre-hash are not supported");return C});function S(C,O){dr("coordinate "+C,O,it,h)}function I(C){if(!(C instanceof m))throw new Error("ExtendedPoint expected")}const T=ks((C,O)=>{const{ex:x,ey:P,ez:B}=C,q=C.is0();O==null&&(O=q?dd:r.inv(B));const V=l(x*O),W=l(P*O),R=l(B*O);if(q)return{x:it,y:Ke};if(R!==Ke)throw new Error("invZ was invalid");return{x:V,y:W}}),v=ks(C=>{const{a:O,d:x}=e;if(C.is0())throw new Error("bad point: ZERO");const{ex:P,ey:B,ez:q,et:V}=C,W=l(P*P),R=l(B*B),M=l(q*q),$=l(M*M),H=l(W*O),Q=l(M*l(H+R)),k=l($+l(x*l(W*R)));if(Q!==k)throw new Error("bad point: equation left != right (1)");const J=l(P*B),te=l(q*V);if(J!==te)throw new Error("bad point: equation left != right (2)");return!0});class m{constructor(O,x,P,B){this.ex=O,this.ey=x,this.ez=P,this.et=B,S("x",O),S("y",x),S("z",P),S("t",B),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(O){if(O instanceof m)throw new Error("extended point not allowed");const{x,y:P}=O||{};return S("x",x),S("y",P),new m(x,P,Ke,l(x*P))}static normalizeZ(O){const x=r.invertBatch(O.map(P=>P.ez));return O.map((P,B)=>P.toAffine(x[B])).map(m.fromAffine)}static msm(O,x){return ld(m,f,O,x)}_setWindowSize(O){E.setWindowSize(this,O)}assertValidity(){v(this)}equals(O){I(O);const{ex:x,ey:P,ez:B}=this,{ex:q,ey:V,ez:W}=O,R=l(x*W),M=l(q*B),$=l(P*W),H=l(V*B);return R===M&&$===H}is0(){return this.equals(m.ZERO)}negate(){return new m(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:O}=e,{ex:x,ey:P,ez:B}=this,q=l(x*x),V=l(P*P),W=l(Yr*l(B*B)),R=l(O*q),M=x+P,$=l(l(M*M)-q-V),H=R+V,Q=H-W,k=R-V,J=l($*Q),te=l(H*k),re=l($*k),ie=l(Q*H);return new m(J,te,ie,re)}add(O){I(O);const{a:x,d:P}=e,{ex:B,ey:q,ez:V,et:W}=this,{ex:R,ey:M,ez:$,et:H}=O;if(x===BigInt(-1)){const Ct=l((q-B)*(M+R)),pe=l((q+B)*(M-R)),le=l(pe-Ct);if(le===it)return this.double();const ge=l(V*Yr*H),ye=l(W*Yr*$),be=ye+ge,we=pe+Ct,me=ye-ge,ue=l(be*le),fe=l(we*me),_e=l(be*me),se=l(le*we);return new m(ue,fe,se,_e)}const Q=l(B*R),k=l(q*M),J=l(W*P*H),te=l(V*$),re=l((B+q)*(R+M)-Q-k),ie=te-J,ne=te+J,We=l(k-x*Q),ut=l(re*ie),gt=l(ne*We),Dt=l(re*We),Rt=l(ie*ne);return new m(ut,gt,Rt,Dt)}subtract(O){return this.add(O.negate())}wNAF(O){return E.wNAFCached(this,O,m.normalizeZ)}multiply(O){const x=O;dr("scalar",x,Ke,i);const{p:P,f:B}=this.wNAF(x);return m.normalizeZ([P,B])[0]}multiplyUnsafe(O,x=m.ZERO){const P=O;return dr("scalar",P,it,i),P===it?_:this.is0()||P===Ke?this:E.wNAFCachedUnsafe(this,P,m.normalizeZ,x)}isSmallOrder(){return this.multiplyUnsafe(u).is0()}isTorsionFree(){return E.unsafeLadder(this,i).is0()}toAffine(O){return T(this,O)}clearCofactor(){const{h:O}=e;return O===Ke?this:this.multiplyUnsafe(O)}static fromHex(O,x=!1){const{d:P,a:B}=e,q=r.BYTES;O=mt("pointHex",O,q),Vi("zip215",x);const V=O.slice(),W=O[q-1];V[q-1]=W&-129;const R=ti(V),M=x?h:r.ORDER;dr("pointHex.y",R,it,M);const $=l(R*R),H=l($-Ke),Q=l(P*$-B);let{isValid:k,value:J}=d(H,Q);if(!k)throw new Error("Point.fromHex: invalid y coordinate");const te=(J&Ke)===Ke,re=(W&128)!==0;if(!x&&J===it&&re)throw new Error("Point.fromHex: x=0 and x_0=1");return re!==te&&(J=l(-J)),m.fromAffine({x:J,y:R})}static fromPrivateKey(O){return A(O).point}toRawBytes(){const{x:O,y:x}=this.toAffine(),P=pn(x,r.BYTES);return P[P.length-1]|=O&Ke?128:0,P}toHex(){return Bn(this.toRawBytes())}}m.BASE=new m(e.Gx,e.Gy,Ke,l(e.Gx*e.Gy)),m.ZERO=new m(it,Ke,Ke,it);const{BASE:b,ZERO:_}=m,E=hd(m,c*8);function a(C){return xe(C,i)}function p(C){return a(ti(C))}function A(C){const O=r.BYTES;C=mt("private key",C,O);const x=mt("hashed private key",s(C),2*O),P=w(x.slice(0,O)),B=x.slice(O,2*O),q=p(P),V=b.multiply(q),W=V.toRawBytes();return{head:P,prefix:B,scalar:q,point:V,pointBytes:W}}function F(C){return A(C).pointBytes}function z(C=new Uint8Array,...O){const x=Hs(...O);return p(s(y(x,mt("context",C),!!n)))}function K(C,O,x={}){C=mt("message",C),n&&(C=n(C));const{prefix:P,scalar:B,pointBytes:q}=A(O),V=z(x.context,P,C),W=b.multiply(V).toRawBytes(),R=z(x.context,W,q,C),M=a(V+R*B);dr("signature.s",M,it,i);const $=Hs(W,pn(M,r.BYTES));return mt("result",$,r.BYTES*2)}const G=pd;function Y(C,O,x,P=G){const{context:B,zip215:q}=P,V=r.BYTES;C=mt("signature",C,2*V),O=mt("message",O),x=mt("publicKey",x,V),q!==void 0&&Vi("zip215",q),n&&(O=n(O));const W=ti(C.slice(V,2*V));let R,M,$;try{R=m.fromHex(x,q),M=m.fromHex(C.slice(0,V),q),$=b.multiplyUnsafe(W)}catch{return!1}if(!q&&R.isSmallOrder())return!1;const H=z(B,M.toRawBytes(),R.toRawBytes(),O);return M.add(R.multiplyUnsafe(H)).subtract($).clearCofactor().equals(m.ZERO)}return b._setWindowSize(8),{CURVE:e,getPublicKey:F,sign:K,verify:Y,ExtendedPoint:m,utils:{getExtendedPublicKey:A,randomPrivateKey:()=>o(r.BYTES),precompute(C=8,O=m.BASE){return O._setWindowSize(C),O.multiply(BigInt(3)),O}}}}BigInt(0),BigInt(1);const zn=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Qs=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const bd=BigInt(1),Xs=BigInt(2);BigInt(3);const wd=BigInt(5),md=BigInt(8);function _d(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),n=BigInt(80),s=zn,o=t*t%s*t%s,c=ht(o,Xs,s)*o%s,u=ht(c,bd,s)*t%s,h=ht(u,wd,s)*u%s,l=ht(h,e,s)*h%s,f=ht(l,r,s)*l%s,d=ht(f,i,s)*f%s,w=ht(d,n,s)*d%s,y=ht(w,n,s)*d%s,S=ht(y,e,s)*h%s;return{pow_p_5_8:ht(S,Xs,s)*t%s,b2:o}}function Ed(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function vd(t,e){const r=zn,i=xe(e*e*e,r),n=xe(i*i*e,r),s=_d(t*n).pow_p_5_8;let o=xe(t*i*s,r);const c=xe(e*o*o,r),u=o,h=xe(o*Qs,r),l=c===t,f=c===xe(-t,r),d=c===xe(-t*Qs,r);return l&&(o=u),(f||d)&&(o=h),id(o,r)&&(o=xe(-o,r)),{isValid:l||f,value:o}}const Dd=Aa(zn,void 0,!0),Sd={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Dd,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:md,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Hf,randomBytes:Ea,adjustScalarBytes:Ed,uvRatio:vd},Pa=yd(Sd),Id="EdDSA",Od="JWT",Ra=".",Ca="base64url",xd="utf8",Ad="utf8",Nd=":",Td="did",Pd="key",Zs="base58btc",Rd="z",Cd="K36",$d=32;function qn(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function $a(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?qn(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Fa(t,e){e||(e=t.reduce((n,s)=>n+s.length,0));const r=$a(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return qn(r)}function Fd(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=n}var c=t.length,u=t.charAt(0),h=Math.log(c)/Math.log(256),l=Math.log(256)/Math.log(c);function f(y){if(y instanceof Uint8Array||(ArrayBuffer.isView(y)?y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength):Array.isArray(y)&&(y=Uint8Array.from(y))),!(y instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(y.length===0)return"";for(var S=0,I=0,T=0,v=y.length;T!==v&&y[T]===0;)T++,S++;for(var m=(v-T)*l+1>>>0,b=new Uint8Array(m);T!==v;){for(var _=y[T],E=0,a=m-1;(_!==0||E<I)&&a!==-1;a--,E++)_+=256*b[a]>>>0,b[a]=_%c>>>0,_=_/c>>>0;if(_!==0)throw new Error("Non-zero carry");I=E,T++}for(var p=m-I;p!==m&&b[p]===0;)p++;for(var A=u.repeat(S);p<m;++p)A+=t.charAt(b[p]);return A}function d(y){if(typeof y!="string")throw new TypeError("Expected String");if(y.length===0)return new Uint8Array;var S=0;if(y[S]!==" "){for(var I=0,T=0;y[S]===u;)I++,S++;for(var v=(y.length-S)*h+1>>>0,m=new Uint8Array(v);y[S];){var b=r[y.charCodeAt(S)];if(b===255)return;for(var _=0,E=v-1;(b!==0||_<T)&&E!==-1;E--,_++)b+=c*m[E]>>>0,m[E]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");T=_,S++}if(y[S]!==" "){for(var a=v-T;a!==v&&m[a]===0;)a++;for(var p=new Uint8Array(I+(v-a)),A=I;a!==v;)p[A++]=m[a++];return p}}}function w(y){var S=d(y);if(S)return S;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:d,decode:w}}var Ud=Fd,Ld=Ud;const Ua=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Md=t=>new TextEncoder().encode(t),Bd=t=>new TextDecoder().decode(t);class jd{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}let zd=class{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return La(this,e)}};class qd{constructor(e){this.decoders=e}or(e){return La(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const La=(t,e)=>new qd({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Kd{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new jd(e,r,i),this.decoder=new zd(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const yi=({name:t,prefix:e,encode:r,decode:i})=>new Kd(t,e,r,i),Nr=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=Ld(r,e);return yi({prefix:t,name:e,encode:i,decode:s=>Ua(n(s))})},Vd=(t,e,r,i)=>{const n={};for(let l=0;l<e.length;++l)n[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let c=0,u=0,h=0;for(let l=0;l<s;++l){const f=n[t[l]];if(f===void 0)throw new SyntaxError(`Non-${i} character`);u=u<<r|f,c+=r,c>=8&&(c-=8,o[h++]=255&u>>c)}if(c>=r||255&u<<8-c)throw new SyntaxError("Unexpected end of data");return o},Hd=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",o=0,c=0;for(let u=0;u<t.length;++u)for(c=c<<8|t[u],o+=8;o>r;)o-=r,s+=e[n&c>>o];if(o&&(s+=e[n&c<<r-o]),i)for(;s.length*r&7;)s+="=";return s},Fe=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>yi({prefix:e,name:t,encode(n){return Hd(n,i,r)},decode(n){return Vd(n,i,r,t)}}),kd=yi({prefix:"\0",name:"identity",encode:t=>Bd(t),decode:t=>Md(t)});var Gd=Object.freeze({__proto__:null,identity:kd});const Wd=Fe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Yd=Object.freeze({__proto__:null,base2:Wd});const Jd=Fe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Qd=Object.freeze({__proto__:null,base8:Jd});const Xd=Nr({prefix:"9",name:"base10",alphabet:"0123456789"});var Zd=Object.freeze({__proto__:null,base10:Xd});const ep=Fe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),tp=Fe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var rp=Object.freeze({__proto__:null,base16:ep,base16upper:tp});const ip=Fe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),np=Fe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),sp=Fe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),op=Fe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ap=Fe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),cp=Fe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),up=Fe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),hp=Fe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),lp=Fe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var fp=Object.freeze({__proto__:null,base32:ip,base32upper:np,base32pad:sp,base32padupper:op,base32hex:ap,base32hexupper:cp,base32hexpad:up,base32hexpadupper:hp,base32z:lp});const dp=Nr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),pp=Nr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var gp=Object.freeze({__proto__:null,base36:dp,base36upper:pp});const yp=Nr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),bp=Nr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var wp=Object.freeze({__proto__:null,base58btc:yp,base58flickr:bp});const mp=Fe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),_p=Fe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ep=Fe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),vp=Fe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Dp=Object.freeze({__proto__:null,base64:mp,base64pad:_p,base64url:Ep,base64urlpad:vp});const Ma=Array.from(""),Sp=Ma.reduce((t,e,r)=>(t[r]=e,t),[]),Ip=Ma.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Op(t){return t.reduce((e,r)=>(e+=Sp[r],e),"")}function xp(t){const e=[];for(const r of t){const i=Ip[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Ap=yi({prefix:"",name:"base256emoji",encode:Op,decode:xp});var Np=Object.freeze({__proto__:null,base256emoji:Ap}),Tp=Ba,eo=128,Pp=-128,Rp=Math.pow(2,31);function Ba(t,e,r){e=e||[],r=r||0;for(var i=r;t>=Rp;)e[r++]=t&255|eo,t/=128;for(;t&Pp;)e[r++]=t&255|eo,t>>>=7;return e[r]=t|0,Ba.bytes=r-i+1,e}var Cp=yn,$p=128,to=127;function yn(t,i){var r=0,i=i||0,n=0,s=i,o,c=t.length;do{if(s>=c)throw yn.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=n<28?(o&to)<<n:(o&to)*Math.pow(2,n),n+=7}while(o>=$p);return yn.bytes=s-i,r}var Fp=Math.pow(2,7),Up=Math.pow(2,14),Lp=Math.pow(2,21),Mp=Math.pow(2,28),Bp=Math.pow(2,35),jp=Math.pow(2,42),zp=Math.pow(2,49),qp=Math.pow(2,56),Kp=Math.pow(2,63),Vp=function(t){return t<Fp?1:t<Up?2:t<Lp?3:t<Mp?4:t<Bp?5:t<jp?6:t<zp?7:t<qp?8:t<Kp?9:10},Hp={encode:Tp,decode:Cp,encodingLength:Vp},ja=Hp;const ro=(t,e,r=0)=>(ja.encode(t,e,r),e),io=t=>ja.encodingLength(t),bn=(t,e)=>{const r=e.byteLength,i=io(t),n=i+io(r),s=new Uint8Array(n+r);return ro(t,s,0),ro(r,s,i),s.set(e,n),new kp(t,r,e,s)};class kp{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const za=({name:t,code:e,encode:r})=>new Gp(t,e,r);class Gp{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?bn(this.code,r):r.then(i=>bn(this.code,i))}else throw Error("Unknown type, must be binary type")}}const qa=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Wp=za({name:"sha2-256",code:18,encode:qa("SHA-256")}),Yp=za({name:"sha2-512",code:19,encode:qa("SHA-512")});var Jp=Object.freeze({__proto__:null,sha256:Wp,sha512:Yp});const Ka=0,Qp="identity",Va=Ua,Xp=t=>bn(Ka,Va(t)),Zp={code:Ka,name:Qp,encode:Va,digest:Xp};var eg=Object.freeze({__proto__:null,identity:Zp});new TextEncoder,new TextDecoder;const no={...Gd,...Yd,...Qd,...Zd,...rp,...fp,...gp,...wp,...Dp,...Np};({...Jp,...eg});function Ha(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const so=Ha("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Ji=Ha("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=$a(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),ka={utf8:so,"utf-8":so,hex:no.base16,latin1:Ji,ascii:Ji,binary:Ji,...no};function Kn(t,e="utf8"){const r=ka[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function Vn(t,e="utf8"){const r=ka[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?qn(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function si(t){return Kn(Vn(xr(t),xd),Ca)}function Ga(t){const e=Vn(Cd,Zs),r=Rd+Kn(Fa([e,t]),Zs);return[Td,Pd,r].join(Nd)}function tg(t){return Kn(t,Ca)}function rg(t){return Vn([si(t.header),si(t.payload)].join(Ra),Ad)}function ig(t){return[si(t.header),si(t.payload),tg(t.signature)].join(Ra)}function oo(t=Ea($d)){const e=Pa.getPublicKey(t);return{secretKey:Fa([t,e]),publicKey:e}}async function ng(t,e,r,i,n=j.fromMiliseconds(Date.now())){const s={alg:Id,typ:Od},o=Ga(i.publicKey),c=n+r,u={iss:o,sub:t,aud:e,iat:n,exp:c},h=rg({header:s,payload:u}),l=Pa.sign(h,i.secretKey.slice(0,32));return ig({header:s,payload:u,signature:l})}var Hn={},bi={},Z={},Wa={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});function e(c,u){var h=c>>>16&65535,l=c&65535,f=u>>>16&65535,d=u&65535;return l*d+(h*d+l*f<<16>>>0)|0}t.mul=Math.imul||e;function r(c,u){return c+u|0}t.add=r;function i(c,u){return c-u|0}t.sub=i;function n(c,u){return c<<u|c>>>32-u}t.rotl=n;function s(c,u){return c<<32-u|c>>>u}t.rotr=s;function o(c){return typeof c=="number"&&isFinite(c)&&Math.floor(c)===c}t.isInteger=Number.isInteger||o,t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(c){return t.isInteger(c)&&c>=-t.MAX_SAFE_INTEGER&&c<=t.MAX_SAFE_INTEGER}})(Wa);Object.defineProperty(Z,"__esModule",{value:!0});var Ya=Wa;function sg(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])<<16>>16}Z.readInt16BE=sg;function og(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])>>>0}Z.readUint16BE=og;function ag(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])<<16>>16}Z.readInt16LE=ag;function cg(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])>>>0}Z.readUint16LE=cg;function Ja(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>8,e[r+1]=t>>>0,e}Z.writeUint16BE=Ja;Z.writeInt16BE=Ja;function Qa(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e}Z.writeUint16LE=Qa;Z.writeInt16LE=Qa;function wn(t,e){return e===void 0&&(e=0),t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}Z.readInt32BE=wn;function mn(t,e){return e===void 0&&(e=0),(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}Z.readUint32BE=mn;function _n(t,e){return e===void 0&&(e=0),t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}Z.readInt32LE=_n;function En(t,e){return e===void 0&&(e=0),(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}Z.readUint32LE=En;function oi(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>24,e[r+1]=t>>>16,e[r+2]=t>>>8,e[r+3]=t>>>0,e}Z.writeUint32BE=oi;Z.writeInt32BE=oi;function ai(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24,e}Z.writeUint32LE=ai;Z.writeInt32LE=ai;function ug(t,e){e===void 0&&(e=0);var r=wn(t,e),i=wn(t,e+4);return r*4294967296+i-(i>>31)*4294967296}Z.readInt64BE=ug;function hg(t,e){e===void 0&&(e=0);var r=mn(t,e),i=mn(t,e+4);return r*4294967296+i}Z.readUint64BE=hg;function lg(t,e){e===void 0&&(e=0);var r=_n(t,e),i=_n(t,e+4);return i*4294967296+r-(r>>31)*4294967296}Z.readInt64LE=lg;function fg(t,e){e===void 0&&(e=0);var r=En(t,e),i=En(t,e+4);return i*4294967296+r}Z.readUint64LE=fg;function Xa(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),oi(t/4294967296>>>0,e,r),oi(t>>>0,e,r+4),e}Z.writeUint64BE=Xa;Z.writeInt64BE=Xa;function Za(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),ai(t>>>0,e,r),ai(t/4294967296>>>0,e,r+4),e}Z.writeUint64LE=Za;Z.writeInt64LE=Za;function dg(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var i=0,n=1,s=t/8+r-1;s>=r;s--)i+=e[s]*n,n*=256;return i}Z.readUintBE=dg;function pg(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var i=0,n=1,s=r;s<r+t/8;s++)i+=e[s]*n,n*=256;return i}Z.readUintLE=pg;function gg(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!Ya.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var n=1,s=t/8+i-1;s>=i;s--)r[s]=e/n&255,n*=256;return r}Z.writeUintBE=gg;function yg(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!Ya.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var n=1,s=i;s<i+t/8;s++)r[s]=e/n&255,n*=256;return r}Z.writeUintLE=yg;function bg(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e)}Z.readFloat32BE=bg;function wg(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e,!0)}Z.readFloat32LE=wg;function mg(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e)}Z.readFloat64BE=mg;function _g(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e,!0)}Z.readFloat64LE=_g;function Eg(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t),e}Z.writeFloat32BE=Eg;function vg(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t,!0),e}Z.writeFloat32LE=vg;function Dg(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t),e}Z.writeFloat64BE=Dg;function Sg(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t,!0),e}Z.writeFloat64LE=Sg;var ct={};Object.defineProperty(ct,"__esModule",{value:!0});function Ig(t){for(var e=0;e<t.length;e++)t[e]=0;return t}ct.wipe=Ig;Object.defineProperty(bi,"__esModule",{value:!0});var Be=Z,vn=ct,Og=20;function xg(t,e,r){for(var i=1634760805,n=857760878,s=2036477234,o=1797285236,c=r[3]<<24|r[2]<<16|r[1]<<8|r[0],u=r[7]<<24|r[6]<<16|r[5]<<8|r[4],h=r[11]<<24|r[10]<<16|r[9]<<8|r[8],l=r[15]<<24|r[14]<<16|r[13]<<8|r[12],f=r[19]<<24|r[18]<<16|r[17]<<8|r[16],d=r[23]<<24|r[22]<<16|r[21]<<8|r[20],w=r[27]<<24|r[26]<<16|r[25]<<8|r[24],y=r[31]<<24|r[30]<<16|r[29]<<8|r[28],S=e[3]<<24|e[2]<<16|e[1]<<8|e[0],I=e[7]<<24|e[6]<<16|e[5]<<8|e[4],T=e[11]<<24|e[10]<<16|e[9]<<8|e[8],v=e[15]<<24|e[14]<<16|e[13]<<8|e[12],m=i,b=n,_=s,E=o,a=c,p=u,A=h,F=l,z=f,K=d,G=w,Y=y,C=S,O=I,x=T,P=v,B=0;B<Og;B+=2)m=m+a|0,C^=m,C=C>>>16|C<<16,z=z+C|0,a^=z,a=a>>>20|a<<12,b=b+p|0,O^=b,O=O>>>16|O<<16,K=K+O|0,p^=K,p=p>>>20|p<<12,_=_+A|0,x^=_,x=x>>>16|x<<16,G=G+x|0,A^=G,A=A>>>20|A<<12,E=E+F|0,P^=E,P=P>>>16|P<<16,Y=Y+P|0,F^=Y,F=F>>>20|F<<12,_=_+A|0,x^=_,x=x>>>24|x<<8,G=G+x|0,A^=G,A=A>>>25|A<<7,E=E+F|0,P^=E,P=P>>>24|P<<8,Y=Y+P|0,F^=Y,F=F>>>25|F<<7,b=b+p|0,O^=b,O=O>>>24|O<<8,K=K+O|0,p^=K,p=p>>>25|p<<7,m=m+a|0,C^=m,C=C>>>24|C<<8,z=z+C|0,a^=z,a=a>>>25|a<<7,m=m+p|0,P^=m,P=P>>>16|P<<16,G=G+P|0,p^=G,p=p>>>20|p<<12,b=b+A|0,C^=b,C=C>>>16|C<<16,Y=Y+C|0,A^=Y,A=A>>>20|A<<12,_=_+F|0,O^=_,O=O>>>16|O<<16,z=z+O|0,F^=z,F=F>>>20|F<<12,E=E+a|0,x^=E,x=x>>>16|x<<16,K=K+x|0,a^=K,a=a>>>20|a<<12,_=_+F|0,O^=_,O=O>>>24|O<<8,z=z+O|0,F^=z,F=F>>>25|F<<7,E=E+a|0,x^=E,x=x>>>24|x<<8,K=K+x|0,a^=K,a=a>>>25|a<<7,b=b+A|0,C^=b,C=C>>>24|C<<8,Y=Y+C|0,A^=Y,A=A>>>25|A<<7,m=m+p|0,P^=m,P=P>>>24|P<<8,G=G+P|0,p^=G,p=p>>>25|p<<7;Be.writeUint32LE(m+i|0,t,0),Be.writeUint32LE(b+n|0,t,4),Be.writeUint32LE(_+s|0,t,8),Be.writeUint32LE(E+o|0,t,12),Be.writeUint32LE(a+c|0,t,16),Be.writeUint32LE(p+u|0,t,20),Be.writeUint32LE(A+h|0,t,24),Be.writeUint32LE(F+l|0,t,28),Be.writeUint32LE(z+f|0,t,32),Be.writeUint32LE(K+d|0,t,36),Be.writeUint32LE(G+w|0,t,40),Be.writeUint32LE(Y+y|0,t,44),Be.writeUint32LE(C+S|0,t,48),Be.writeUint32LE(O+I|0,t,52),Be.writeUint32LE(x+T|0,t,56),Be.writeUint32LE(P+v|0,t,60)}function ec(t,e,r,i,n){if(n===void 0&&(n=0),t.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<r.length)throw new Error("ChaCha: destination is shorter than source");var s,o;if(n===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");s=new Uint8Array(16),o=s.length-e.length,s.set(e,o)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");s=e,o=n}for(var c=new Uint8Array(64),u=0;u<r.length;u+=64){xg(c,s,t);for(var h=u;h<u+64&&h<r.length;h++)i[h]=r[h]^c[h-u];Ng(s,0,o)}return vn.wipe(c),n===0&&vn.wipe(s),i}bi.streamXOR=ec;function Ag(t,e,r,i){return i===void 0&&(i=0),vn.wipe(r),ec(t,e,r,r,i)}bi.stream=Ag;function Ng(t,e,r){for(var i=1;r--;)i=i+(t[e]&255)|0,t[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var tc={},Pt={};Object.defineProperty(Pt,"__esModule",{value:!0});function Tg(t,e,r){return~(t-1)&e|t-1&r}Pt.select=Tg;function Pg(t,e){return(t|0)-(e|0)-1>>>31&1}Pt.lessOrEqual=Pg;function rc(t,e){if(t.length!==e.length)return 0;for(var r=0,i=0;i<t.length;i++)r|=t[i]^e[i];return 1&r-1>>>8}Pt.compare=rc;function Rg(t,e){return t.length===0||e.length===0?!1:rc(t,e)!==0}Pt.equal=Rg;(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Pt,r=ct;t.DIGEST_LENGTH=16;var i=function(){function o(c){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var u=c[0]|c[1]<<8;this._r[0]=u&8191;var h=c[2]|c[3]<<8;this._r[1]=(u>>>13|h<<3)&8191;var l=c[4]|c[5]<<8;this._r[2]=(h>>>10|l<<6)&7939;var f=c[6]|c[7]<<8;this._r[3]=(l>>>7|f<<9)&8191;var d=c[8]|c[9]<<8;this._r[4]=(f>>>4|d<<12)&255,this._r[5]=d>>>1&8190;var w=c[10]|c[11]<<8;this._r[6]=(d>>>14|w<<2)&8191;var y=c[12]|c[13]<<8;this._r[7]=(w>>>11|y<<5)&8065;var S=c[14]|c[15]<<8;this._r[8]=(y>>>8|S<<8)&8191,this._r[9]=S>>>5&127,this._pad[0]=c[16]|c[17]<<8,this._pad[1]=c[18]|c[19]<<8,this._pad[2]=c[20]|c[21]<<8,this._pad[3]=c[22]|c[23]<<8,this._pad[4]=c[24]|c[25]<<8,this._pad[5]=c[26]|c[27]<<8,this._pad[6]=c[28]|c[29]<<8,this._pad[7]=c[30]|c[31]<<8}return o.prototype._blocks=function(c,u,h){for(var l=this._fin?0:2048,f=this._h[0],d=this._h[1],w=this._h[2],y=this._h[3],S=this._h[4],I=this._h[5],T=this._h[6],v=this._h[7],m=this._h[8],b=this._h[9],_=this._r[0],E=this._r[1],a=this._r[2],p=this._r[3],A=this._r[4],F=this._r[5],z=this._r[6],K=this._r[7],G=this._r[8],Y=this._r[9];h>=16;){var C=c[u+0]|c[u+1]<<8;f+=C&8191;var O=c[u+2]|c[u+3]<<8;d+=(C>>>13|O<<3)&8191;var x=c[u+4]|c[u+5]<<8;w+=(O>>>10|x<<6)&8191;var P=c[u+6]|c[u+7]<<8;y+=(x>>>7|P<<9)&8191;var B=c[u+8]|c[u+9]<<8;S+=(P>>>4|B<<12)&8191,I+=B>>>1&8191;var q=c[u+10]|c[u+11]<<8;T+=(B>>>14|q<<2)&8191;var V=c[u+12]|c[u+13]<<8;v+=(q>>>11|V<<5)&8191;var W=c[u+14]|c[u+15]<<8;m+=(V>>>8|W<<8)&8191,b+=W>>>5|l;var R=0,M=R;M+=f*_,M+=d*(5*Y),M+=w*(5*G),M+=y*(5*K),M+=S*(5*z),R=M>>>13,M&=8191,M+=I*(5*F),M+=T*(5*A),M+=v*(5*p),M+=m*(5*a),M+=b*(5*E),R+=M>>>13,M&=8191;var $=R;$+=f*E,$+=d*_,$+=w*(5*Y),$+=y*(5*G),$+=S*(5*K),R=$>>>13,$&=8191,$+=I*(5*z),$+=T*(5*F),$+=v*(5*A),$+=m*(5*p),$+=b*(5*a),R+=$>>>13,$&=8191;var H=R;H+=f*a,H+=d*E,H+=w*_,H+=y*(5*Y),H+=S*(5*G),R=H>>>13,H&=8191,H+=I*(5*K),H+=T*(5*z),H+=v*(5*F),H+=m*(5*A),H+=b*(5*p),R+=H>>>13,H&=8191;var Q=R;Q+=f*p,Q+=d*a,Q+=w*E,Q+=y*_,Q+=S*(5*Y),R=Q>>>13,Q&=8191,Q+=I*(5*G),Q+=T*(5*K),Q+=v*(5*z),Q+=m*(5*F),Q+=b*(5*A),R+=Q>>>13,Q&=8191;var k=R;k+=f*A,k+=d*p,k+=w*a,k+=y*E,k+=S*_,R=k>>>13,k&=8191,k+=I*(5*Y),k+=T*(5*G),k+=v*(5*K),k+=m*(5*z),k+=b*(5*F),R+=k>>>13,k&=8191;var J=R;J+=f*F,J+=d*A,J+=w*p,J+=y*a,J+=S*E,R=J>>>13,J&=8191,J+=I*_,J+=T*(5*Y),J+=v*(5*G),J+=m*(5*K),J+=b*(5*z),R+=J>>>13,J&=8191;var te=R;te+=f*z,te+=d*F,te+=w*A,te+=y*p,te+=S*a,R=te>>>13,te&=8191,te+=I*E,te+=T*_,te+=v*(5*Y),te+=m*(5*G),te+=b*(5*K),R+=te>>>13,te&=8191;var re=R;re+=f*K,re+=d*z,re+=w*F,re+=y*A,re+=S*p,R=re>>>13,re&=8191,re+=I*a,re+=T*E,re+=v*_,re+=m*(5*Y),re+=b*(5*G),R+=re>>>13,re&=8191;var ie=R;ie+=f*G,ie+=d*K,ie+=w*z,ie+=y*F,ie+=S*A,R=ie>>>13,ie&=8191,ie+=I*p,ie+=T*a,ie+=v*E,ie+=m*_,ie+=b*(5*Y),R+=ie>>>13,ie&=8191;var ne=R;ne+=f*Y,ne+=d*G,ne+=w*K,ne+=y*z,ne+=S*F,R=ne>>>13,ne&=8191,ne+=I*A,ne+=T*p,ne+=v*a,ne+=m*E,ne+=b*_,R+=ne>>>13,ne&=8191,R=(R<<2)+R|0,R=R+M|0,M=R&8191,R=R>>>13,$+=R,f=M,d=$,w=H,y=Q,S=k,I=J,T=te,v=re,m=ie,b=ne,u+=16,h-=16}this._h[0]=f,this._h[1]=d,this._h[2]=w,this._h[3]=y,this._h[4]=S,this._h[5]=I,this._h[6]=T,this._h[7]=v,this._h[8]=m,this._h[9]=b},o.prototype.finish=function(c,u){u===void 0&&(u=0);var h=new Uint16Array(10),l,f,d,w;if(this._leftover){for(w=this._leftover,this._buffer[w++]=1;w<16;w++)this._buffer[w]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(l=this._h[1]>>>13,this._h[1]&=8191,w=2;w<10;w++)this._h[w]+=l,l=this._h[w]>>>13,this._h[w]&=8191;for(this._h[0]+=l*5,l=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=l,l=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=l,h[0]=this._h[0]+5,l=h[0]>>>13,h[0]&=8191,w=1;w<10;w++)h[w]=this._h[w]+l,l=h[w]>>>13,h[w]&=8191;for(h[9]-=8192,f=(l^1)-1,w=0;w<10;w++)h[w]&=f;for(f=~f,w=0;w<10;w++)this._h[w]=this._h[w]&f|h[w];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,d=this._h[0]+this._pad[0],this._h[0]=d&65535,w=1;w<8;w++)d=(this._h[w]+this._pad[w]|0)+(d>>>16)|0,this._h[w]=d&65535;return c[u+0]=this._h[0]>>>0,c[u+1]=this._h[0]>>>8,c[u+2]=this._h[1]>>>0,c[u+3]=this._h[1]>>>8,c[u+4]=this._h[2]>>>0,c[u+5]=this._h[2]>>>8,c[u+6]=this._h[3]>>>0,c[u+7]=this._h[3]>>>8,c[u+8]=this._h[4]>>>0,c[u+9]=this._h[4]>>>8,c[u+10]=this._h[5]>>>0,c[u+11]=this._h[5]>>>8,c[u+12]=this._h[6]>>>0,c[u+13]=this._h[6]>>>8,c[u+14]=this._h[7]>>>0,c[u+15]=this._h[7]>>>8,this._finished=!0,this},o.prototype.update=function(c){var u=0,h=c.length,l;if(this._leftover){l=16-this._leftover,l>h&&(l=h);for(var f=0;f<l;f++)this._buffer[this._leftover+f]=c[u+f];if(h-=l,u+=l,this._leftover+=l,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(h>=16&&(l=h-h%16,this._blocks(c,u,l),u+=l,h-=l),h){for(var f=0;f<h;f++)this._buffer[this._leftover+f]=c[u+f];this._leftover+=h}return this},o.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var c=new Uint8Array(16);return this.finish(c),c},o.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},o}();t.Poly1305=i;function n(o,c){var u=new i(o);u.update(c);var h=u.digest();return u.clean(),h}t.oneTimeAuth=n;function s(o,c){return o.length!==t.DIGEST_LENGTH||c.length!==t.DIGEST_LENGTH?!1:e.equal(o,c)}t.equal=s})(tc);(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=bi,r=tc,i=ct,n=Z,s=Pt;t.KEY_LENGTH=32,t.NONCE_LENGTH=12,t.TAG_LENGTH=16;var o=new Uint8Array(16),c=function(){function u(h){if(this.nonceLength=t.NONCE_LENGTH,this.tagLength=t.TAG_LENGTH,h.length!==t.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(h)}return u.prototype.seal=function(h,l,f,d){if(h.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var w=new Uint8Array(16);w.set(h,w.length-h.length);var y=new Uint8Array(32);e.stream(this._key,w,y,4);var S=l.length+this.tagLength,I;if(d){if(d.length!==S)throw new Error("ChaCha20Poly1305: incorrect destination length");I=d}else I=new Uint8Array(S);return e.streamXOR(this._key,w,l,I,4),this._authenticate(I.subarray(I.length-this.tagLength,I.length),y,I.subarray(0,I.length-this.tagLength),f),i.wipe(w),I},u.prototype.open=function(h,l,f,d){if(h.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(l.length<this.tagLength)return null;var w=new Uint8Array(16);w.set(h,w.length-h.length);var y=new Uint8Array(32);e.stream(this._key,w,y,4);var S=new Uint8Array(this.tagLength);if(this._authenticate(S,y,l.subarray(0,l.length-this.tagLength),f),!s.equal(S,l.subarray(l.length-this.tagLength,l.length)))return null;var I=l.length-this.tagLength,T;if(d){if(d.length!==I)throw new Error("ChaCha20Poly1305: incorrect destination length");T=d}else T=new Uint8Array(I);return e.streamXOR(this._key,w,l.subarray(0,l.length-this.tagLength),T,4),i.wipe(w),T},u.prototype.clean=function(){return i.wipe(this._key),this},u.prototype._authenticate=function(h,l,f,d){var w=new r.Poly1305(l);d&&(w.update(d),d.length%16>0&&w.update(o.subarray(d.length%16))),w.update(f),f.length%16>0&&w.update(o.subarray(f.length%16));var y=new Uint8Array(8);d&&n.writeUint64LE(d.length,y),w.update(y),n.writeUint64LE(f.length,y),w.update(y);for(var S=w.digest(),I=0;I<S.length;I++)h[I]=S[I];w.clean(),i.wipe(S),i.wipe(y)},u}();t.ChaCha20Poly1305=c})(Hn);var ic={},Tr={},kn={};Object.defineProperty(kn,"__esModule",{value:!0});function Cg(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}kn.isSerializableHash=Cg;Object.defineProperty(Tr,"__esModule",{value:!0});var lt=kn,$g=Pt,Fg=ct,nc=function(){function t(e,r){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(i).clean():i.set(r);for(var n=0;n<i.length;n++)i[n]^=54;this._inner.update(i);for(var n=0;n<i.length;n++)i[n]^=106;this._outer.update(i),lt.isSerializableHash(this._inner)&&lt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),Fg.wipe(i)}return t.prototype.reset=function(){if(!lt.isSerializableHash(this._inner)||!lt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){lt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),lt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(e){return this._inner.update(e),this},t.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(!lt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(e){if(!lt.isSerializableHash(this._inner)||!lt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(e){if(!lt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},t}();Tr.HMAC=nc;function Ug(t,e,r){var i=new nc(t,e);i.update(r);var n=i.digest();return i.clean(),n}Tr.hmac=Ug;Tr.equal=$g.equal;Object.defineProperty(ic,"__esModule",{value:!0});var ao=Tr,co=ct,Lg=function(){function t(e,r,i,n){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=n;var s=ao.hmac(this._hash,i,r);this._hmac=new ao.HMAC(e,s),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(e){for(var r=new Uint8Array(e),i=0;i<r.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[i]=this._buffer[this._bufpos++];return r},t.prototype.clean=function(){this._hmac.clean(),co.wipe(this._buffer),co.wipe(this._counter),this._bufpos=0},t}(),Mg=ic.HKDF=Lg,wi={},mi={},_i={};Object.defineProperty(_i,"__esModule",{value:!0});_i.BrowserRandomSource=void 0;const uo=65536;class Bg{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const r=new Uint8Array(e);for(let i=0;i<r.length;i+=uo)this._crypto.getRandomValues(r.subarray(i,i+Math.min(r.length-i,uo)));return r}}_i.BrowserRandomSource=Bg;var Ei={};Object.defineProperty(Ei,"__esModule",{value:!0});Ei.NodeRandomSource=void 0;const jg=ct;class zg{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof Mu<"u"){const e=Bu;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(e);if(r.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const i=new Uint8Array(e);for(let n=0;n<i.length;n++)i[n]=r[n];return(0,jg.wipe)(r),i}}Ei.NodeRandomSource=zg;Object.defineProperty(mi,"__esModule",{value:!0});mi.SystemRandomSource=void 0;const qg=_i,Kg=Ei;class Vg{constructor(){if(this.isAvailable=!1,this.name="",this._source=new qg.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new Kg.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}mi.SystemRandomSource=Vg;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const e=mi,r=Z,i=ct;t.defaultRandomSource=new e.SystemRandomSource;function n(h,l=t.defaultRandomSource){return l.randomBytes(h)}t.randomBytes=n;function s(h=t.defaultRandomSource){const l=n(4,h),f=(0,r.readUint32LE)(l);return(0,i.wipe)(l),f}t.randomUint32=s;const o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function c(h,l=o,f=t.defaultRandomSource){if(l.length<2)throw new Error("randomString charset is too short");if(l.length>256)throw new Error("randomString charset is too long");let d="";const w=l.length,y=256-256%w;for(;h>0;){const S=n(Math.ceil(h*256/y),f);for(let I=0;I<S.length&&h>0;I++){const T=S[I];T<y&&(d+=l.charAt(T%w),h--)}(0,i.wipe)(S)}return d}t.randomString=c;function u(h,l=o,f=t.defaultRandomSource){const d=Math.ceil(h/(Math.log(l.length)/Math.LN2));return c(d,l,f)}t.randomStringForEntropy=u})(wi);var vi={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Z,r=ct;t.DIGEST_LENGTH=32,t.BLOCK_SIZE=64;var i=function(){function c(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},c.prototype.update=function(u,h){if(h===void 0&&(h=u.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var l=0;if(this._bytesHashed+=h,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&h>0;)this._buffer[this._bufferLength++]=u[l++],h--;this._bufferLength===this.blockSize&&(s(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(h>=this.blockSize&&(l=s(this._temp,this._state,u,l,h),h%=this.blockSize);h>0;)this._buffer[this._bufferLength++]=u[l++],h--;return this},c.prototype.finish=function(u){if(!this._finished){var h=this._bytesHashed,l=this._bufferLength,f=h/536870912|0,d=h<<3,w=h%64<56?64:128;this._buffer[l]=128;for(var y=l+1;y<w-8;y++)this._buffer[y]=0;e.writeUint32BE(f,this._buffer,w-8),e.writeUint32BE(d,this._buffer,w-4),s(this._temp,this._state,this._buffer,0,w),this._finished=!0}for(var y=0;y<this.digestLength/4;y++)e.writeUint32BE(this._state[y],u,y*4);return this},c.prototype.digest=function(){var u=new Uint8Array(this.digestLength);return this.finish(u),u},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(u){return this._state.set(u.state),this._bufferLength=u.bufferLength,u.buffer&&this._buffer.set(u.buffer),this._bytesHashed=u.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(u){r.wipe(u.state),u.buffer&&r.wipe(u.buffer),u.bufferLength=0,u.bytesHashed=0},c}();t.SHA256=i;var n=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function s(c,u,h,l,f){for(;f>=64;){for(var d=u[0],w=u[1],y=u[2],S=u[3],I=u[4],T=u[5],v=u[6],m=u[7],b=0;b<16;b++){var _=l+b*4;c[b]=e.readUint32BE(h,_)}for(var b=16;b<64;b++){var E=c[b-2],a=(E>>>17|E<<15)^(E>>>19|E<<13)^E>>>10;E=c[b-15];var p=(E>>>7|E<<25)^(E>>>18|E<<14)^E>>>3;c[b]=(a+c[b-7]|0)+(p+c[b-16]|0)}for(var b=0;b<64;b++){var a=(((I>>>6|I<<26)^(I>>>11|I<<21)^(I>>>25|I<<7))+(I&T^~I&v)|0)+(m+(n[b]+c[b]|0)|0)|0,p=((d>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10))+(d&w^d&y^w&y)|0;m=v,v=T,T=I,I=S+a|0,S=y,y=w,w=d,d=a+p|0}u[0]+=d,u[1]+=w,u[2]+=y,u[3]+=S,u[4]+=I,u[5]+=T,u[6]+=v,u[7]+=m,l+=64,f-=64}return l}function o(c){var u=new i;u.update(c);var h=u.digest();return u.clean(),h}t.hash=o})(vi);var Gn={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.scalarMultBase=t.scalarMult=t.SHARED_KEY_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=void 0;const e=wi,r=ct;t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;function i(b){const _=new Float64Array(16);if(b)for(let E=0;E<b.length;E++)_[E]=b[E];return _}const n=new Uint8Array(32);n[0]=9;const s=i([56129,1]);function o(b){let _=1;for(let E=0;E<16;E++){let a=b[E]+_+65535;_=Math.floor(a/65536),b[E]=a-_*65536}b[0]+=_-1+37*(_-1)}function c(b,_,E){const a=~(E-1);for(let p=0;p<16;p++){const A=a&(b[p]^_[p]);b[p]^=A,_[p]^=A}}function u(b,_){const E=i(),a=i();for(let p=0;p<16;p++)a[p]=_[p];o(a),o(a),o(a);for(let p=0;p<2;p++){E[0]=a[0]-65517;for(let F=1;F<15;F++)E[F]=a[F]-65535-(E[F-1]>>16&1),E[F-1]&=65535;E[15]=a[15]-32767-(E[14]>>16&1);const A=E[15]>>16&1;E[14]&=65535,c(a,E,1-A)}for(let p=0;p<16;p++)b[2*p]=a[p]&255,b[2*p+1]=a[p]>>8}function h(b,_){for(let E=0;E<16;E++)b[E]=_[2*E]+(_[2*E+1]<<8);b[15]&=32767}function l(b,_,E){for(let a=0;a<16;a++)b[a]=_[a]+E[a]}function f(b,_,E){for(let a=0;a<16;a++)b[a]=_[a]-E[a]}function d(b,_,E){let a,p,A=0,F=0,z=0,K=0,G=0,Y=0,C=0,O=0,x=0,P=0,B=0,q=0,V=0,W=0,R=0,M=0,$=0,H=0,Q=0,k=0,J=0,te=0,re=0,ie=0,ne=0,We=0,ut=0,gt=0,Dt=0,Rt=0,Ct=0,pe=E[0],le=E[1],ge=E[2],ye=E[3],be=E[4],we=E[5],me=E[6],ue=E[7],fe=E[8],_e=E[9],se=E[10],Se=E[11],Ie=E[12],Ae=E[13],Oe=E[14],Ee=E[15];a=_[0],A+=a*pe,F+=a*le,z+=a*ge,K+=a*ye,G+=a*be,Y+=a*we,C+=a*me,O+=a*ue,x+=a*fe,P+=a*_e,B+=a*se,q+=a*Se,V+=a*Ie,W+=a*Ae,R+=a*Oe,M+=a*Ee,a=_[1],F+=a*pe,z+=a*le,K+=a*ge,G+=a*ye,Y+=a*be,C+=a*we,O+=a*me,x+=a*ue,P+=a*fe,B+=a*_e,q+=a*se,V+=a*Se,W+=a*Ie,R+=a*Ae,M+=a*Oe,$+=a*Ee,a=_[2],z+=a*pe,K+=a*le,G+=a*ge,Y+=a*ye,C+=a*be,O+=a*we,x+=a*me,P+=a*ue,B+=a*fe,q+=a*_e,V+=a*se,W+=a*Se,R+=a*Ie,M+=a*Ae,$+=a*Oe,H+=a*Ee,a=_[3],K+=a*pe,G+=a*le,Y+=a*ge,C+=a*ye,O+=a*be,x+=a*we,P+=a*me,B+=a*ue,q+=a*fe,V+=a*_e,W+=a*se,R+=a*Se,M+=a*Ie,$+=a*Ae,H+=a*Oe,Q+=a*Ee,a=_[4],G+=a*pe,Y+=a*le,C+=a*ge,O+=a*ye,x+=a*be,P+=a*we,B+=a*me,q+=a*ue,V+=a*fe,W+=a*_e,R+=a*se,M+=a*Se,$+=a*Ie,H+=a*Ae,Q+=a*Oe,k+=a*Ee,a=_[5],Y+=a*pe,C+=a*le,O+=a*ge,x+=a*ye,P+=a*be,B+=a*we,q+=a*me,V+=a*ue,W+=a*fe,R+=a*_e,M+=a*se,$+=a*Se,H+=a*Ie,Q+=a*Ae,k+=a*Oe,J+=a*Ee,a=_[6],C+=a*pe,O+=a*le,x+=a*ge,P+=a*ye,B+=a*be,q+=a*we,V+=a*me,W+=a*ue,R+=a*fe,M+=a*_e,$+=a*se,H+=a*Se,Q+=a*Ie,k+=a*Ae,J+=a*Oe,te+=a*Ee,a=_[7],O+=a*pe,x+=a*le,P+=a*ge,B+=a*ye,q+=a*be,V+=a*we,W+=a*me,R+=a*ue,M+=a*fe,$+=a*_e,H+=a*se,Q+=a*Se,k+=a*Ie,J+=a*Ae,te+=a*Oe,re+=a*Ee,a=_[8],x+=a*pe,P+=a*le,B+=a*ge,q+=a*ye,V+=a*be,W+=a*we,R+=a*me,M+=a*ue,$+=a*fe,H+=a*_e,Q+=a*se,k+=a*Se,J+=a*Ie,te+=a*Ae,re+=a*Oe,ie+=a*Ee,a=_[9],P+=a*pe,B+=a*le,q+=a*ge,V+=a*ye,W+=a*be,R+=a*we,M+=a*me,$+=a*ue,H+=a*fe,Q+=a*_e,k+=a*se,J+=a*Se,te+=a*Ie,re+=a*Ae,ie+=a*Oe,ne+=a*Ee,a=_[10],B+=a*pe,q+=a*le,V+=a*ge,W+=a*ye,R+=a*be,M+=a*we,$+=a*me,H+=a*ue,Q+=a*fe,k+=a*_e,J+=a*se,te+=a*Se,re+=a*Ie,ie+=a*Ae,ne+=a*Oe,We+=a*Ee,a=_[11],q+=a*pe,V+=a*le,W+=a*ge,R+=a*ye,M+=a*be,$+=a*we,H+=a*me,Q+=a*ue,k+=a*fe,J+=a*_e,te+=a*se,re+=a*Se,ie+=a*Ie,ne+=a*Ae,We+=a*Oe,ut+=a*Ee,a=_[12],V+=a*pe,W+=a*le,R+=a*ge,M+=a*ye,$+=a*be,H+=a*we,Q+=a*me,k+=a*ue,J+=a*fe,te+=a*_e,re+=a*se,ie+=a*Se,ne+=a*Ie,We+=a*Ae,ut+=a*Oe,gt+=a*Ee,a=_[13],W+=a*pe,R+=a*le,M+=a*ge,$+=a*ye,H+=a*be,Q+=a*we,k+=a*me,J+=a*ue,te+=a*fe,re+=a*_e,ie+=a*se,ne+=a*Se,We+=a*Ie,ut+=a*Ae,gt+=a*Oe,Dt+=a*Ee,a=_[14],R+=a*pe,M+=a*le,$+=a*ge,H+=a*ye,Q+=a*be,k+=a*we,J+=a*me,te+=a*ue,re+=a*fe,ie+=a*_e,ne+=a*se,We+=a*Se,ut+=a*Ie,gt+=a*Ae,Dt+=a*Oe,Rt+=a*Ee,a=_[15],M+=a*pe,$+=a*le,H+=a*ge,Q+=a*ye,k+=a*be,J+=a*we,te+=a*me,re+=a*ue,ie+=a*fe,ne+=a*_e,We+=a*se,ut+=a*Se,gt+=a*Ie,Dt+=a*Ae,Rt+=a*Oe,Ct+=a*Ee,A+=38*$,F+=38*H,z+=38*Q,K+=38*k,G+=38*J,Y+=38*te,C+=38*re,O+=38*ie,x+=38*ne,P+=38*We,B+=38*ut,q+=38*gt,V+=38*Dt,W+=38*Rt,R+=38*Ct,p=1,a=A+p+65535,p=Math.floor(a/65536),A=a-p*65536,a=F+p+65535,p=Math.floor(a/65536),F=a-p*65536,a=z+p+65535,p=Math.floor(a/65536),z=a-p*65536,a=K+p+65535,p=Math.floor(a/65536),K=a-p*65536,a=G+p+65535,p=Math.floor(a/65536),G=a-p*65536,a=Y+p+65535,p=Math.floor(a/65536),Y=a-p*65536,a=C+p+65535,p=Math.floor(a/65536),C=a-p*65536,a=O+p+65535,p=Math.floor(a/65536),O=a-p*65536,a=x+p+65535,p=Math.floor(a/65536),x=a-p*65536,a=P+p+65535,p=Math.floor(a/65536),P=a-p*65536,a=B+p+65535,p=Math.floor(a/65536),B=a-p*65536,a=q+p+65535,p=Math.floor(a/65536),q=a-p*65536,a=V+p+65535,p=Math.floor(a/65536),V=a-p*65536,a=W+p+65535,p=Math.floor(a/65536),W=a-p*65536,a=R+p+65535,p=Math.floor(a/65536),R=a-p*65536,a=M+p+65535,p=Math.floor(a/65536),M=a-p*65536,A+=p-1+37*(p-1),p=1,a=A+p+65535,p=Math.floor(a/65536),A=a-p*65536,a=F+p+65535,p=Math.floor(a/65536),F=a-p*65536,a=z+p+65535,p=Math.floor(a/65536),z=a-p*65536,a=K+p+65535,p=Math.floor(a/65536),K=a-p*65536,a=G+p+65535,p=Math.floor(a/65536),G=a-p*65536,a=Y+p+65535,p=Math.floor(a/65536),Y=a-p*65536,a=C+p+65535,p=Math.floor(a/65536),C=a-p*65536,a=O+p+65535,p=Math.floor(a/65536),O=a-p*65536,a=x+p+65535,p=Math.floor(a/65536),x=a-p*65536,a=P+p+65535,p=Math.floor(a/65536),P=a-p*65536,a=B+p+65535,p=Math.floor(a/65536),B=a-p*65536,a=q+p+65535,p=Math.floor(a/65536),q=a-p*65536,a=V+p+65535,p=Math.floor(a/65536),V=a-p*65536,a=W+p+65535,p=Math.floor(a/65536),W=a-p*65536,a=R+p+65535,p=Math.floor(a/65536),R=a-p*65536,a=M+p+65535,p=Math.floor(a/65536),M=a-p*65536,A+=p-1+37*(p-1),b[0]=A,b[1]=F,b[2]=z,b[3]=K,b[4]=G,b[5]=Y,b[6]=C,b[7]=O,b[8]=x,b[9]=P,b[10]=B,b[11]=q,b[12]=V,b[13]=W,b[14]=R,b[15]=M}function w(b,_){d(b,_,_)}function y(b,_){const E=i();for(let a=0;a<16;a++)E[a]=_[a];for(let a=253;a>=0;a--)w(E,E),a!==2&&a!==4&&d(E,E,_);for(let a=0;a<16;a++)b[a]=E[a]}function S(b,_){const E=new Uint8Array(32),a=new Float64Array(80),p=i(),A=i(),F=i(),z=i(),K=i(),G=i();for(let x=0;x<31;x++)E[x]=b[x];E[31]=b[31]&127|64,E[0]&=248,h(a,_);for(let x=0;x<16;x++)A[x]=a[x];p[0]=z[0]=1;for(let x=254;x>=0;--x){const P=E[x>>>3]>>>(x&7)&1;c(p,A,P),c(F,z,P),l(K,p,F),f(p,p,F),l(F,A,z),f(A,A,z),w(z,K),w(G,p),d(p,F,p),d(F,A,K),l(K,p,F),f(p,p,F),w(A,p),f(F,z,G),d(p,F,s),l(p,p,z),d(F,F,p),d(p,z,G),d(z,A,a),w(A,K),c(p,A,P),c(F,z,P)}for(let x=0;x<16;x++)a[x+16]=p[x],a[x+32]=F[x],a[x+48]=A[x],a[x+64]=z[x];const Y=a.subarray(32),C=a.subarray(16);y(Y,Y),d(C,C,Y);const O=new Uint8Array(32);return u(O,C),O}t.scalarMult=S;function I(b){return S(b,n)}t.scalarMultBase=I;function T(b){if(b.length!==t.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${t.SECRET_KEY_LENGTH} bytes`);const _=new Uint8Array(b);return{publicKey:I(_),secretKey:_}}t.generateKeyPairFromSeed=T;function v(b){const _=(0,e.randomBytes)(32,b),E=T(_);return(0,r.wipe)(_),E}t.generateKeyPair=v;function m(b,_,E=!1){if(b.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(_.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const a=S(b,_);if(E){let p=0;for(let A=0;A<a.length;A++)p|=a[A];if(p===0)throw new Error("X25519: invalid shared key")}return a}t.sharedKey=m})(Gn);function Wn(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function sc(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Wn(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function ho(t,e){e||(e=t.reduce((n,s)=>n+s.length,0));const r=sc(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return Wn(r)}function Hg(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=n}var c=t.length,u=t.charAt(0),h=Math.log(c)/Math.log(256),l=Math.log(256)/Math.log(c);function f(y){if(y instanceof Uint8Array||(ArrayBuffer.isView(y)?y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength):Array.isArray(y)&&(y=Uint8Array.from(y))),!(y instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(y.length===0)return"";for(var S=0,I=0,T=0,v=y.length;T!==v&&y[T]===0;)T++,S++;for(var m=(v-T)*l+1>>>0,b=new Uint8Array(m);T!==v;){for(var _=y[T],E=0,a=m-1;(_!==0||E<I)&&a!==-1;a--,E++)_+=256*b[a]>>>0,b[a]=_%c>>>0,_=_/c>>>0;if(_!==0)throw new Error("Non-zero carry");I=E,T++}for(var p=m-I;p!==m&&b[p]===0;)p++;for(var A=u.repeat(S);p<m;++p)A+=t.charAt(b[p]);return A}function d(y){if(typeof y!="string")throw new TypeError("Expected String");if(y.length===0)return new Uint8Array;var S=0;if(y[S]!==" "){for(var I=0,T=0;y[S]===u;)I++,S++;for(var v=(y.length-S)*h+1>>>0,m=new Uint8Array(v);y[S];){var b=r[y.charCodeAt(S)];if(b===255)return;for(var _=0,E=v-1;(b!==0||_<T)&&E!==-1;E--,_++)b+=c*m[E]>>>0,m[E]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");T=_,S++}if(y[S]!==" "){for(var a=v-T;a!==v&&m[a]===0;)a++;for(var p=new Uint8Array(I+(v-a)),A=I;a!==v;)p[A++]=m[a++];return p}}}function w(y){var S=d(y);if(S)return S;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:d,decode:w}}var kg=Hg,Gg=kg;const Wg=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Yg=t=>new TextEncoder().encode(t),Jg=t=>new TextDecoder().decode(t);class Qg{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Xg{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return oc(this,e)}}class Zg{constructor(e){this.decoders=e}or(e){return oc(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const oc=(t,e)=>new Zg({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class ey{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new Qg(e,r,i),this.decoder=new Xg(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Di=({name:t,prefix:e,encode:r,decode:i})=>new ey(t,e,r,i),Pr=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=Gg(r,e);return Di({prefix:t,name:e,encode:i,decode:s=>Wg(n(s))})},ty=(t,e,r,i)=>{const n={};for(let l=0;l<e.length;++l)n[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let c=0,u=0,h=0;for(let l=0;l<s;++l){const f=n[t[l]];if(f===void 0)throw new SyntaxError(`Non-${i} character`);u=u<<r|f,c+=r,c>=8&&(c-=8,o[h++]=255&u>>c)}if(c>=r||255&u<<8-c)throw new SyntaxError("Unexpected end of data");return o},ry=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",o=0,c=0;for(let u=0;u<t.length;++u)for(c=c<<8|t[u],o+=8;o>r;)o-=r,s+=e[n&c>>o];if(o&&(s+=e[n&c<<r-o]),i)for(;s.length*r&7;)s+="=";return s},Ue=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Di({prefix:e,name:t,encode(n){return ry(n,i,r)},decode(n){return ty(n,i,r,t)}}),iy=Di({prefix:"\0",name:"identity",encode:t=>Jg(t),decode:t=>Yg(t)}),ny=Object.freeze(Object.defineProperty({__proto__:null,identity:iy},Symbol.toStringTag,{value:"Module"})),sy=Ue({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),oy=Object.freeze(Object.defineProperty({__proto__:null,base2:sy},Symbol.toStringTag,{value:"Module"})),ay=Ue({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),cy=Object.freeze(Object.defineProperty({__proto__:null,base8:ay},Symbol.toStringTag,{value:"Module"})),uy=Pr({prefix:"9",name:"base10",alphabet:"0123456789"}),hy=Object.freeze(Object.defineProperty({__proto__:null,base10:uy},Symbol.toStringTag,{value:"Module"})),ly=Ue({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),fy=Ue({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),dy=Object.freeze(Object.defineProperty({__proto__:null,base16:ly,base16upper:fy},Symbol.toStringTag,{value:"Module"})),py=Ue({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),gy=Ue({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),yy=Ue({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),by=Ue({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),wy=Ue({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),my=Ue({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),_y=Ue({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ey=Ue({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),vy=Ue({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Dy=Object.freeze(Object.defineProperty({__proto__:null,base32:py,base32hex:wy,base32hexpad:_y,base32hexpadupper:Ey,base32hexupper:my,base32pad:yy,base32padupper:by,base32upper:gy,base32z:vy},Symbol.toStringTag,{value:"Module"})),Sy=Pr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Iy=Pr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Oy=Object.freeze(Object.defineProperty({__proto__:null,base36:Sy,base36upper:Iy},Symbol.toStringTag,{value:"Module"})),xy=Pr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Ay=Pr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Ny=Object.freeze(Object.defineProperty({__proto__:null,base58btc:xy,base58flickr:Ay},Symbol.toStringTag,{value:"Module"})),Ty=Ue({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Py=Ue({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ry=Ue({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Cy=Ue({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),$y=Object.freeze(Object.defineProperty({__proto__:null,base64:Ty,base64pad:Py,base64url:Ry,base64urlpad:Cy},Symbol.toStringTag,{value:"Module"})),ac=Array.from(""),Fy=ac.reduce((t,e,r)=>(t[r]=e,t),[]),Uy=ac.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Ly(t){return t.reduce((e,r)=>(e+=Fy[r],e),"")}function My(t){const e=[];for(const r of t){const i=Uy[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const By=Di({prefix:"",name:"base256emoji",encode:Ly,decode:My}),jy=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:By},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const lo={...ny,...oy,...cy,...hy,...dy,...Dy,...Oy,...Ny,...$y,...jy};function cc(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const fo=cc("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Qi=cc("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=sc(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),uc={utf8:fo,"utf-8":fo,hex:lo.base16,latin1:Qi,ascii:Qi,binary:Qi,...lo};function ot(t,e="utf8"){const r=uc[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Wn(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function tt(t,e="utf8"){const r=uc[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}var po=function(t,e,r){if(r||arguments.length===2)for(var i=0,n=e.length,s;i<n;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))},zy=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),qy=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),Ky=function(){function t(e,r,i,n){this.name=e,this.version=r,this.os=i,this.bot=n,this.type="bot-device"}return t}(),Vy=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),Hy=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),ky=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Gy=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,go=3,Wy=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",ky]],yo=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Yy(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Hy:typeof navigator<"u"?Qy(navigator.userAgent):Zy()}function Jy(t){return t!==""&&Wy.reduce(function(e,r){var i=r[0],n=r[1];if(e)return e;var s=n.exec(t);return!!s&&[i,s]},!1)}function Qy(t){var e=Jy(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new Vy;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<go&&(n=po(po([],n,!0),eb(go-n.length),!0)):n=[];var s=n.join("."),o=Xy(t),c=Gy.exec(t);return c&&c[1]?new Ky(r,s,o,c[1]):new zy(r,s,o)}function Xy(t){for(var e=0,r=yo.length;e<r;e++){var i=yo[e],n=i[0],s=i[1],o=s.exec(t);if(o)return n}return null}function Zy(){var t=typeof process<"u"&&process.version;return t?new qy(process.version.slice(1)):null}function eb(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var ae={};Object.defineProperty(ae,"__esModule",{value:!0});ae.getLocalStorage=ae.getLocalStorageOrThrow=ae.getCrypto=ae.getCryptoOrThrow=lc=ae.getLocation=ae.getLocationOrThrow=Yn=ae.getNavigator=ae.getNavigatorOrThrow=hc=ae.getDocument=ae.getDocumentOrThrow=ae.getFromWindowOrThrow=ae.getFromWindow=void 0;function kt(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}ae.getFromWindow=kt;function ir(t){const e=kt(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}ae.getFromWindowOrThrow=ir;function tb(){return ir("document")}ae.getDocumentOrThrow=tb;function rb(){return kt("document")}var hc=ae.getDocument=rb;function ib(){return ir("navigator")}ae.getNavigatorOrThrow=ib;function nb(){return kt("navigator")}var Yn=ae.getNavigator=nb;function sb(){return ir("location")}ae.getLocationOrThrow=sb;function ob(){return kt("location")}var lc=ae.getLocation=ob;function ab(){return ir("crypto")}ae.getCryptoOrThrow=ab;function cb(){return kt("crypto")}ae.getCrypto=cb;function ub(){return ir("localStorage")}ae.getLocalStorageOrThrow=ub;function hb(){return kt("localStorage")}ae.getLocalStorage=hb;var Jn={};Object.defineProperty(Jn,"__esModule",{value:!0});var fc=Jn.getWindowMetadata=void 0;const bo=ae;function lb(){let t,e;try{t=bo.getDocumentOrThrow(),e=bo.getLocationOrThrow()}catch{return null}function r(){const f=t.getElementsByTagName("link"),d=[];for(let w=0;w<f.length;w++){const y=f[w],S=y.getAttribute("rel");if(S&&S.toLowerCase().indexOf("icon")>-1){const I=y.getAttribute("href");if(I)if(I.toLowerCase().indexOf("https:")===-1&&I.toLowerCase().indexOf("http:")===-1&&I.indexOf("//")!==0){let T=e.protocol+"//"+e.host;if(I.indexOf("/")===0)T+=I;else{const v=e.pathname.split("/");v.pop();const m=v.join("/");T+=m+"/"+I}d.push(T)}else if(I.indexOf("//")===0){const T=e.protocol+I;d.push(T)}else d.push(I)}}return d}function i(...f){const d=t.getElementsByTagName("meta");for(let w=0;w<d.length;w++){const y=d[w],S=["itemprop","property","name"].map(I=>y.getAttribute(I)).filter(I=>I?f.includes(I):!1);if(S.length&&S){const I=y.getAttribute("content");if(I)return I}}return""}function n(){let f=i("name","og:site_name","og:title","twitter:title");return f||(f=t.title),f}function s(){return i("description","og:description","twitter:description","keywords")}const o=n(),c=s(),u=e.origin,h=r();return{description:c,url:u,icons:h,name:o}}fc=Jn.getWindowMetadata=lb;var Sr={},fb=function(t,e){for(var r={},i=Object.keys(t),n=Array.isArray(e),s=0;s<i.length;s++){var o=i[s],c=t[o];(n?e.indexOf(o)!==-1:e(o,c,t))&&(r[o]=c)}return r};(function(t){const e=zu,r=qu,i=ju,n=fb,s=v=>v==null,o=Symbol("encodeFragmentIdentifier");function c(v){switch(v.arrayFormat){case"index":return m=>(b,_)=>{const E=b.length;return _===void 0||v.skipNull&&_===null||v.skipEmptyString&&_===""?b:_===null?[...b,[l(m,v),"[",E,"]"].join("")]:[...b,[l(m,v),"[",l(E,v),"]=",l(_,v)].join("")]};case"bracket":return m=>(b,_)=>_===void 0||v.skipNull&&_===null||v.skipEmptyString&&_===""?b:_===null?[...b,[l(m,v),"[]"].join("")]:[...b,[l(m,v),"[]=",l(_,v)].join("")];case"colon-list-separator":return m=>(b,_)=>_===void 0||v.skipNull&&_===null||v.skipEmptyString&&_===""?b:_===null?[...b,[l(m,v),":list="].join("")]:[...b,[l(m,v),":list=",l(_,v)].join("")];case"comma":case"separator":case"bracket-separator":{const m=v.arrayFormat==="bracket-separator"?"[]=":"=";return b=>(_,E)=>E===void 0||v.skipNull&&E===null||v.skipEmptyString&&E===""?_:(E=E===null?"":E,_.length===0?[[l(b,v),m,l(E,v)].join("")]:[[_,l(E,v)].join(v.arrayFormatSeparator)])}default:return m=>(b,_)=>_===void 0||v.skipNull&&_===null||v.skipEmptyString&&_===""?b:_===null?[...b,l(m,v)]:[...b,[l(m,v),"=",l(_,v)].join("")]}}function u(v){let m;switch(v.arrayFormat){case"index":return(b,_,E)=>{if(m=/\[(\d*)\]$/.exec(b),b=b.replace(/\[\d*\]$/,""),!m){E[b]=_;return}E[b]===void 0&&(E[b]={}),E[b][m[1]]=_};case"bracket":return(b,_,E)=>{if(m=/(\[\])$/.exec(b),b=b.replace(/\[\]$/,""),!m){E[b]=_;return}if(E[b]===void 0){E[b]=[_];return}E[b]=[].concat(E[b],_)};case"colon-list-separator":return(b,_,E)=>{if(m=/(:list)$/.exec(b),b=b.replace(/:list$/,""),!m){E[b]=_;return}if(E[b]===void 0){E[b]=[_];return}E[b]=[].concat(E[b],_)};case"comma":case"separator":return(b,_,E)=>{const a=typeof _=="string"&&_.includes(v.arrayFormatSeparator),p=typeof _=="string"&&!a&&f(_,v).includes(v.arrayFormatSeparator);_=p?f(_,v):_;const A=a||p?_.split(v.arrayFormatSeparator).map(F=>f(F,v)):_===null?_:f(_,v);E[b]=A};case"bracket-separator":return(b,_,E)=>{const a=/(\[\])$/.test(b);if(b=b.replace(/\[\]$/,""),!a){E[b]=_&&f(_,v);return}const p=_===null?[]:_.split(v.arrayFormatSeparator).map(A=>f(A,v));if(E[b]===void 0){E[b]=p;return}E[b]=[].concat(E[b],p)};default:return(b,_,E)=>{if(E[b]===void 0){E[b]=_;return}E[b]=[].concat(E[b],_)}}}function h(v){if(typeof v!="string"||v.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function l(v,m){return m.encode?m.strict?e(v):encodeURIComponent(v):v}function f(v,m){return m.decode?r(v):v}function d(v){return Array.isArray(v)?v.sort():typeof v=="object"?d(Object.keys(v)).sort((m,b)=>Number(m)-Number(b)).map(m=>v[m]):v}function w(v){const m=v.indexOf("#");return m!==-1&&(v=v.slice(0,m)),v}function y(v){let m="";const b=v.indexOf("#");return b!==-1&&(m=v.slice(b)),m}function S(v){v=w(v);const m=v.indexOf("?");return m===-1?"":v.slice(m+1)}function I(v,m){return m.parseNumbers&&!Number.isNaN(Number(v))&&typeof v=="string"&&v.trim()!==""?v=Number(v):m.parseBooleans&&v!==null&&(v.toLowerCase()==="true"||v.toLowerCase()==="false")&&(v=v.toLowerCase()==="true"),v}function T(v,m){m=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},m),h(m.arrayFormatSeparator);const b=u(m),_=Object.create(null);if(typeof v!="string"||(v=v.trim().replace(/^[?#&]/,""),!v))return _;for(const E of v.split("&")){if(E==="")continue;let[a,p]=i(m.decode?E.replace(/\+/g," "):E,"=");p=p===void 0?null:["comma","separator","bracket-separator"].includes(m.arrayFormat)?p:f(p,m),b(f(a,m),p,_)}for(const E of Object.keys(_)){const a=_[E];if(typeof a=="object"&&a!==null)for(const p of Object.keys(a))a[p]=I(a[p],m);else _[E]=I(a,m)}return m.sort===!1?_:(m.sort===!0?Object.keys(_).sort():Object.keys(_).sort(m.sort)).reduce((E,a)=>{const p=_[a];return p&&typeof p=="object"&&!Array.isArray(p)?E[a]=d(p):E[a]=p,E},Object.create(null))}t.extract=S,t.parse=T,t.stringify=(v,m)=>{if(!v)return"";m=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},m),h(m.arrayFormatSeparator);const b=p=>m.skipNull&&s(v[p])||m.skipEmptyString&&v[p]==="",_=c(m),E={};for(const p of Object.keys(v))b(p)||(E[p]=v[p]);const a=Object.keys(E);return m.sort!==!1&&a.sort(m.sort),a.map(p=>{const A=v[p];return A===void 0?"":A===null?l(p,m):Array.isArray(A)?A.length===0&&m.arrayFormat==="bracket-separator"?l(p,m)+"[]":A.reduce(_(p),[]).join("&"):l(p,m)+"="+l(A,m)}).filter(p=>p.length>0).join("&")},t.parseUrl=(v,m)=>{m=Object.assign({decode:!0},m);const[b,_]=i(v,"#");return Object.assign({url:b.split("?")[0]||"",query:T(S(v),m)},m&&m.parseFragmentIdentifier&&_?{fragmentIdentifier:f(_,m)}:{})},t.stringifyUrl=(v,m)=>{m=Object.assign({encode:!0,strict:!0,[o]:!0},m);const b=w(v.url).split("?")[0]||"",_=t.extract(v.url),E=t.parse(_,{sort:!1}),a=Object.assign(E,v.query);let p=t.stringify(a,m);p&&(p=`?${p}`);let A=y(v.url);return v.fragmentIdentifier&&(A=`#${m[o]?l(v.fragmentIdentifier,m):v.fragmentIdentifier}`),`${b}${p}${A}`},t.pick=(v,m,b)=>{b=Object.assign({parseFragmentIdentifier:!0,[o]:!1},b);const{url:_,query:E,fragmentIdentifier:a}=t.parseUrl(v,b);return t.stringifyUrl({url:_,query:n(E,m),fragmentIdentifier:a},b)},t.exclude=(v,m,b)=>{const _=Array.isArray(m)?E=>!m.includes(E):(E,a)=>!m(E,a);return t.pick(v,_,b)}})(Sr);const db={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};function dc(t,e){return t.includes(":")?[t]:e.chains||[]}const pc="base10",qe="base16",Dn="base64pad",Qn="utf8",gc=0,Gt=1,pb=0,wo=1,Sn=12,Xn=32;function gb(){const t=Gn.generateKeyPair();return{privateKey:tt(t.secretKey,qe),publicKey:tt(t.publicKey,qe)}}function In(){const t=wi.randomBytes(Xn);return tt(t,qe)}function yb(t,e){const r=Gn.sharedKey(ot(t,qe),ot(e,qe)),i=new Mg(vi.SHA256,r).expand(Xn);return tt(i,qe)}function bb(t){const e=vi.hash(ot(t,qe));return tt(e,qe)}function tr(t){const e=vi.hash(ot(t,Qn));return tt(e,qe)}function wb(t){return ot(`${t}`,pc)}function Rr(t){return Number(tt(t,pc))}function mb(t){const e=wb(typeof t.type<"u"?t.type:gc);if(Rr(e)===Gt&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?ot(t.senderPublicKey,qe):void 0,i=typeof t.iv<"u"?ot(t.iv,qe):wi.randomBytes(Sn),n=new Hn.ChaCha20Poly1305(ot(t.symKey,qe)).seal(i,ot(t.message,Qn));return Eb({type:e,sealed:n,iv:i,senderPublicKey:r})}function _b(t){const e=new Hn.ChaCha20Poly1305(ot(t.symKey,qe)),{sealed:r,iv:i}=ci(t.encoded),n=e.open(i,r);if(n===null)throw new Error("Failed to decrypt");return tt(n,Qn)}function Eb(t){if(Rr(t.type)===Gt){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return tt(ho([t.type,t.senderPublicKey,t.iv,t.sealed]),Dn)}return tt(ho([t.type,t.iv,t.sealed]),Dn)}function ci(t){const e=ot(t,Dn),r=e.slice(pb,wo),i=wo;if(Rr(r)===Gt){const c=i+Xn,u=c+Sn,h=e.slice(i,c),l=e.slice(c,u),f=e.slice(u);return{type:r,sealed:f,iv:l,senderPublicKey:h}}const n=i+Sn,s=e.slice(i,n),o=e.slice(n);return{type:r,sealed:o,iv:s}}function vb(t,e){const r=ci(t);return yc({type:Rr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?tt(r.senderPublicKey,qe):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function yc(t){const e=(t==null?void 0:t.type)||gc;if(e===Gt){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function mo(t){return t.type===Gt&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var Db=Object.defineProperty,_o=Object.getOwnPropertySymbols,Sb=Object.prototype.hasOwnProperty,Ib=Object.prototype.propertyIsEnumerable,Eo=(t,e,r)=>e in t?Db(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vo=(t,e)=>{for(var r in e||(e={}))Sb.call(e,r)&&Eo(t,r,e[r]);if(_o)for(var r of _o(e))Ib.call(e,r)&&Eo(t,r,e[r]);return t};const Ob="ReactNative",Je={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},xb="js";function Zn(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Si(){return!hc()&&!!Yn()&&navigator.product===Ob}function Cr(){return!Zn()&&!!Yn()}function $r(){return Si()?Je.reactNative:Zn()?Je.node:Cr()?Je.browser:Je.unknown}function Ab(t,e){let r=Sr.parse(t);return r=vo(vo({},r),e),t=Sr.stringify(r),t}function Nb(){return fc()||{name:"",description:"",url:"",icons:[""]}}function Tb(){if($r()===Je.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:i}=global.Platform;return[r,i].join("-")}const t=Yy();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function Pb(){var t;const e=$r();return e===Je.browser?[e,((t=lc())==null?void 0:t.host)||"unknown"].join(":"):e}function Rb(t,e,r){const i=Tb(),n=Pb();return[[t,e].join("-"),[xb,r].join("-"),i,n].join("/")}function Cb({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:n,projectId:s,useOnCloseEvent:o}){const c=r.split("?"),u=Rb(t,e,i),h={auth:n,ua:u,projectId:s,useOnCloseEvent:o||void 0},l=Ab(c[1]||"",h);return c[0]+"?"+l}function Kt(t,e){return t.filter(r=>e.includes(r)).length===t.length}function bc(t){return Object.fromEntries(t.entries())}function wc(t){return new Map(Object.entries(t))}function Zt(t=j.FIVE_MINUTES,e){const r=j.toMiliseconds(t||j.FIVE_MINUTES);let i,n,s;return{resolve:o=>{s&&i&&(clearTimeout(s),i(o))},reject:o=>{s&&n&&(clearTimeout(s),n(o))},done:()=>new Promise((o,c)=>{s=setTimeout(()=>{c(new Error(e))},r),i=o,n=c})}}function Ir(t,e,r){return new Promise(async(i,n)=>{const s=setTimeout(()=>n(new Error(r)),e);try{const o=await t;i(o)}catch(o){n(o)}clearTimeout(s)})}function mc(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function $b(t){return mc("topic",t)}function Fb(t){return mc("id",t)}function _c(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function nt(t,e){return j.fromMiliseconds(Date.now()+j.toMiliseconds(t))}function Nt(t){return Date.now()>=j.toMiliseconds(t)}function De(t,e){return`${t}${e?`:${e}`:""}`}async function Ub({id:t,topic:e,wcDeepLink:r}){try{if(!r)return;const i=typeof r=="string"?JSON.parse(r):r;let n=i==null?void 0:i.href;if(typeof n!="string")return;n.endsWith("/")&&(n=n.slice(0,-1));const s=`${n}/wc?requestId=${t}&sessionTopic=${e}`,o=$r();o===Je.browser?s.startsWith("https://")?window.open(s,"_blank","noreferrer noopener"):window.open(s,"_self","noreferrer noopener"):o===Je.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(s)}catch(i){console.error(i)}}const Lb="irn";function On(t){return(t==null?void 0:t.relay)||{protocol:Lb}}function ri(t){const e=db[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var Mb=Object.defineProperty,Do=Object.getOwnPropertySymbols,Bb=Object.prototype.hasOwnProperty,jb=Object.prototype.propertyIsEnumerable,So=(t,e,r)=>e in t?Mb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zb=(t,e)=>{for(var r in e||(e={}))Bb.call(e,r)&&So(t,r,e[r]);if(Do)for(var r of Do(e))jb.call(e,r)&&So(t,r,e[r]);return t};function qb(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(n=>{if(n.startsWith(i)){const s=n.replace(i,""),o=t[n];r[s]=o}}),r}function Kb(t){const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),n=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",o=Sr.parse(s);return{protocol:i,topic:Vb(n[0]),version:parseInt(n[1],10),symKey:o.symKey,relay:qb(o)}}function Vb(t){return t.startsWith("//")?t.substring(2):t}function Hb(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(n=>{const s=r+e+n;t[n]&&(i[s]=t[n])}),i}function kb(t){return`${t.protocol}:${t.topic}@${t.version}?`+Sr.stringify(zb({symKey:t.symKey},Hb(t.relay)))}function nr(t){const e=[];return t.forEach(r=>{const[i,n]=r.split(":");e.push(`${i}:${n}`)}),e}function Gb(t){const e=[];return Object.values(t).forEach(r=>{e.push(...nr(r.accounts))}),e}function Wb(t,e){const r=[];return Object.values(t).forEach(i=>{nr(i.accounts).includes(e)&&r.push(...i.methods)}),r}function Yb(t,e){const r=[];return Object.values(t).forEach(i=>{nr(i.accounts).includes(e)&&r.push(...i.events)}),r}function Jb(t,e){const r=ii(t,e);if(r)throw new Error(r.message);const i={};for(const[n,s]of Object.entries(t))i[n]={methods:s.methods,events:s.events,chains:s.accounts.map(o=>`${o.split(":")[0]}:${o.split(":")[1]}`)};return i}const Qb={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Xb={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function U(t,e){const{message:r,code:i}=Xb[t];return{message:e?`${r} ${e}`:r,code:i}}function Pe(t,e){const{message:r,code:i}=Qb[t];return{message:e?`${r} ${e}`:r,code:i}}function Fr(t,e){return!!Array.isArray(t)}function wr(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function ze(t){return typeof t>"u"}function Re(t,e){return e&&ze(t)?!0:typeof t=="string"&&!!t.trim().length}function es(t,e){return e&&ze(t)?!0:typeof t=="number"&&!isNaN(t)}function Zb(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),n=Object.keys(r);let s=!0;return Kt(n,i)?(i.forEach(o=>{const{accounts:c,methods:u,events:h}=t.namespaces[o],l=nr(c),f=r[o];(!Kt(dc(o,f),l)||!Kt(f.methods,u)||!Kt(f.events,h))&&(s=!1)}),s):!1}function ui(t){return Re(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function ew(t){if(Re(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&ui(r)}}return!1}function tw(t){if(Re(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function rw(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function iw(t){return t==null?void 0:t.topic}function nw(t,e){let r=null;return Re(t==null?void 0:t.publicKey,!1)||(r=U("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function Io(t){let e=!0;return Fr(t)?t.length&&(e=t.every(r=>Re(r,!1))):e=!1,e}function sw(t,e,r){let i=null;return Fr(e)&&e.length?e.forEach(n=>{i||ui(n)||(i=Pe("UNSUPPORTED_CHAINS",`${r}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):ui(t)||(i=Pe("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function ow(t,e,r){let i=null;return Object.entries(t).forEach(([n,s])=>{if(i)return;const o=sw(n,dc(n,s),`${e} ${r}`);o&&(i=o)}),i}function aw(t,e){let r=null;return Fr(t)?t.forEach(i=>{r||ew(i)||(r=Pe("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=Pe("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function cw(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=aw(i==null?void 0:i.accounts,`${e} namespace`);n&&(r=n)}),r}function uw(t,e){let r=null;return Io(t==null?void 0:t.methods)?Io(t==null?void 0:t.events)||(r=Pe("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=Pe("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function Ec(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=uw(i,`${e}, namespace`);n&&(r=n)}),r}function hw(t,e,r){let i=null;if(t&&wr(t)){const n=Ec(t,e);n&&(i=n);const s=ow(t,e,r);s&&(i=s)}else i=U("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function ii(t,e){let r=null;if(t&&wr(t)){const i=Ec(t,e);i&&(r=i);const n=cw(t,e);n&&(r=n)}else r=U("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function vc(t){return Re(t.protocol,!0)}function lw(t,e){let r=!1;return t?t&&Fr(t)&&t.length&&t.forEach(i=>{r=vc(i)}):r=!0,r}function fw(t){return typeof t=="number"}function ke(t){return typeof t<"u"&&typeof t!==null}function dw(t){return!(!t||typeof t!="object"||!t.code||!es(t.code,!1)||!t.message||!Re(t.message,!1))}function pw(t){return!(ze(t)||!Re(t.method,!1))}function gw(t){return!(ze(t)||ze(t.result)&&ze(t.error)||!es(t.id,!1)||!Re(t.jsonrpc,!1))}function yw(t){return!(ze(t)||!Re(t.name,!1))}function Oo(t,e){return!(!ui(e)||!Gb(t).includes(e))}function bw(t,e,r){return Re(r,!1)?Wb(t,e).includes(r):!1}function ww(t,e,r){return Re(r,!1)?Yb(t,e).includes(r):!1}function xo(t,e,r){let i=null;const n=mw(t),s=_w(e),o=Object.keys(n),c=Object.keys(s),u=Ao(Object.keys(t)),h=Ao(Object.keys(e)),l=u.filter(f=>!h.includes(f));return l.length&&(i=U("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${l.toString()}
      Received: ${Object.keys(e).toString()}`)),Kt(o,c)||(i=U("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${c.toString()}`)),Object.keys(e).forEach(f=>{if(!f.includes(":")||i)return;const d=nr(e[f].accounts);d.includes(f)||(i=U("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${f}
        Required: ${f}
        Approved: ${d.toString()}`))}),o.forEach(f=>{i||(Kt(n[f].methods,s[f].methods)?Kt(n[f].events,s[f].events)||(i=U("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${f}`)):i=U("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${f}`))}),i}function mw(t){const e={};return Object.keys(t).forEach(r=>{var i;r.includes(":")?e[r]=t[r]:(i=t[r].chains)==null||i.forEach(n=>{e[n]={methods:t[r].methods,events:t[r].events}})}),e}function Ao(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function _w(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const i=nr(t[r].accounts);i==null||i.forEach(n=>{e[n]={accounts:t[r].accounts.filter(s=>s.includes(`${n}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function Ew(t,e){return es(t,!1)&&t<=e.max&&t>=e.min}function No(){const t=$r();return new Promise(e=>{switch(t){case Je.browser:e(vw());break;case Je.reactNative:e(Dw());break;case Je.node:e(Sw());break;default:e(!0)}})}function vw(){return Cr()&&(navigator==null?void 0:navigator.onLine)}async function Dw(){if(Si()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function Sw(){return!0}function Iw(t){switch($r()){case Je.browser:Ow(t);break;case Je.reactNative:xw(t);break}}function Ow(t){Cr()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function xw(t){Si()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>t(e==null?void 0:e.isConnected)))}const Xi={};let Jr=class{static get(e){return Xi[e]}static set(e,r){Xi[e]=r}static delete(e){delete Xi[e]}};class Aw{}class Nw extends Aw{constructor(){super()}}class Tw extends Nw{constructor(e){super()}}const Pw="^wss?:";function Rw(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function Cw(t,e){const r=Rw(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function To(t){return Cw(t,Pw)}function $w(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Dc(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function ts(t){return Dc(t)&&"method"in t}function Ii(t){return Dc(t)&&(vt(t)||st(t))}function vt(t){return"result"in t}function st(t){return"error"in t}class Fw extends Tw{constructor(e){super(e),this.events=new at.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(mr(e.method,e.params||[],e.id||ta().toString()),r)}async requestStrict(e,r){return new Promise(async(i,n)=>{if(!this.connection.connected)try{await this.open()}catch(s){n(s)}this.events.on(`${e.id}`,s=>{st(s)?n(s.error):i(s.result)});try{await this.connection.send(e,r)}catch(s){n(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Ii(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Uw=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Lw=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Po=t=>t.split("?")[0],Ro=10,Mw=Uw();class Bw{constructor(e){if(this.url=e,this.events=new at.EventEmitter,this.registering=!1,!To(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(xr(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!To(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),n(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const n=Ku.isReactNative()?void 0:{rejectUnauthorized:!$w(e)},s=new Mw(e,[],n);Lw()?s.onerror=o=>{const c=o;i(this.emitError(c.error))}:s.on("error",o=>{i(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),r(s)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?fi(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),n=i.message||i.toString(),s=Pn(e,n);this.events.emit("payload",s)}parseError(e,r=this.url){return Vu(e,Po(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Ro&&this.events.setMaxListeners(Ro)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${Po(this.url)}`));return this.events.emit("register_error",r),r}}var hi={exports:{}};hi.exports;(function(t,e){var r=200,i="__lodash_hash_undefined__",n=1,s=2,o=9007199254740991,c="[object Arguments]",u="[object Array]",h="[object AsyncFunction]",l="[object Boolean]",f="[object Date]",d="[object Error]",w="[object Function]",y="[object GeneratorFunction]",S="[object Map]",I="[object Number]",T="[object Null]",v="[object Object]",m="[object Promise]",b="[object Proxy]",_="[object RegExp]",E="[object Set]",a="[object String]",p="[object Symbol]",A="[object Undefined]",F="[object WeakMap]",z="[object ArrayBuffer]",K="[object DataView]",G="[object Float32Array]",Y="[object Float64Array]",C="[object Int8Array]",O="[object Int16Array]",x="[object Int32Array]",P="[object Uint8Array]",B="[object Uint8ClampedArray]",q="[object Uint16Array]",V="[object Uint32Array]",W=/[\\^$.*+?()[\]{}|]/g,R=/^\[object .+?Constructor\]$/,M=/^(?:0|[1-9]\d*)$/,$={};$[G]=$[Y]=$[C]=$[O]=$[x]=$[P]=$[B]=$[q]=$[V]=!0,$[c]=$[u]=$[z]=$[l]=$[K]=$[f]=$[d]=$[w]=$[S]=$[I]=$[v]=$[_]=$[E]=$[a]=$[F]=!1;var H=typeof Kr=="object"&&Kr&&Kr.Object===Object&&Kr,Q=typeof self=="object"&&self&&self.Object===Object&&self,k=H||Q||Function("return this")(),J=e&&!e.nodeType&&e,te=J&&!0&&t&&!t.nodeType&&t,re=te&&te.exports===J,ie=re&&H.process,ne=function(){try{return ie&&ie.binding&&ie.binding("util")}catch{}}(),We=ne&&ne.isTypedArray;function ut(g,D){for(var N=-1,L=g==null?0:g.length,ce=0,X=[];++N<L;){var de=g[N];D(de,N,g)&&(X[ce++]=de)}return X}function gt(g,D){for(var N=-1,L=D.length,ce=g.length;++N<L;)g[ce+N]=D[N];return g}function Dt(g,D){for(var N=-1,L=g==null?0:g.length;++N<L;)if(D(g[N],N,g))return!0;return!1}function Rt(g,D){for(var N=-1,L=Array(g);++N<g;)L[N]=D(N);return L}function Ct(g){return function(D){return g(D)}}function pe(g,D){return g.has(D)}function le(g,D){return g==null?void 0:g[D]}function ge(g){var D=-1,N=Array(g.size);return g.forEach(function(L,ce){N[++D]=[ce,L]}),N}function ye(g,D){return function(N){return g(D(N))}}function be(g){var D=-1,N=Array(g.size);return g.forEach(function(L){N[++D]=L}),N}var we=Array.prototype,me=Function.prototype,ue=Object.prototype,fe=k["__core-js_shared__"],_e=me.toString,se=ue.hasOwnProperty,Se=function(){var g=/[^.]+$/.exec(fe&&fe.keys&&fe.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),Ie=ue.toString,Ae=RegExp("^"+_e.call(se).replace(W,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Oe=re?k.Buffer:void 0,Ee=k.Symbol,os=k.Uint8Array,as=ue.propertyIsEnumerable,zc=we.splice,$t=Ee?Ee.toStringTag:void 0,cs=Object.getOwnPropertySymbols,qc=Oe?Oe.isBuffer:void 0,Kc=ye(Object.keys,Object),Ai=Wt(k,"DataView"),sr=Wt(k,"Map"),Ni=Wt(k,"Promise"),Ti=Wt(k,"Set"),Pi=Wt(k,"WeakMap"),or=Wt(Object,"create"),Vc=Lt(Ai),Hc=Lt(sr),kc=Lt(Ni),Gc=Lt(Ti),Wc=Lt(Pi),us=Ee?Ee.prototype:void 0,Ri=us?us.valueOf:void 0;function Ft(g){var D=-1,N=g==null?0:g.length;for(this.clear();++D<N;){var L=g[D];this.set(L[0],L[1])}}function Yc(){this.__data__=or?or(null):{},this.size=0}function Jc(g){var D=this.has(g)&&delete this.__data__[g];return this.size-=D?1:0,D}function Qc(g){var D=this.__data__;if(or){var N=D[g];return N===i?void 0:N}return se.call(D,g)?D[g]:void 0}function Xc(g){var D=this.__data__;return or?D[g]!==void 0:se.call(D,g)}function Zc(g,D){var N=this.__data__;return this.size+=this.has(g)?0:1,N[g]=or&&D===void 0?i:D,this}Ft.prototype.clear=Yc,Ft.prototype.delete=Jc,Ft.prototype.get=Qc,Ft.prototype.has=Xc,Ft.prototype.set=Zc;function yt(g){var D=-1,N=g==null?0:g.length;for(this.clear();++D<N;){var L=g[D];this.set(L[0],L[1])}}function eu(){this.__data__=[],this.size=0}function tu(g){var D=this.__data__,N=Mr(D,g);if(N<0)return!1;var L=D.length-1;return N==L?D.pop():zc.call(D,N,1),--this.size,!0}function ru(g){var D=this.__data__,N=Mr(D,g);return N<0?void 0:D[N][1]}function iu(g){return Mr(this.__data__,g)>-1}function nu(g,D){var N=this.__data__,L=Mr(N,g);return L<0?(++this.size,N.push([g,D])):N[L][1]=D,this}yt.prototype.clear=eu,yt.prototype.delete=tu,yt.prototype.get=ru,yt.prototype.has=iu,yt.prototype.set=nu;function Ut(g){var D=-1,N=g==null?0:g.length;for(this.clear();++D<N;){var L=g[D];this.set(L[0],L[1])}}function su(){this.size=0,this.__data__={hash:new Ft,map:new(sr||yt),string:new Ft}}function ou(g){var D=Br(this,g).delete(g);return this.size-=D?1:0,D}function au(g){return Br(this,g).get(g)}function cu(g){return Br(this,g).has(g)}function uu(g,D){var N=Br(this,g),L=N.size;return N.set(g,D),this.size+=N.size==L?0:1,this}Ut.prototype.clear=su,Ut.prototype.delete=ou,Ut.prototype.get=au,Ut.prototype.has=cu,Ut.prototype.set=uu;function Lr(g){var D=-1,N=g==null?0:g.length;for(this.__data__=new Ut;++D<N;)this.add(g[D])}function hu(g){return this.__data__.set(g,i),this}function lu(g){return this.__data__.has(g)}Lr.prototype.add=Lr.prototype.push=hu,Lr.prototype.has=lu;function St(g){var D=this.__data__=new yt(g);this.size=D.size}function fu(){this.__data__=new yt,this.size=0}function du(g){var D=this.__data__,N=D.delete(g);return this.size=D.size,N}function pu(g){return this.__data__.get(g)}function gu(g){return this.__data__.has(g)}function yu(g,D){var N=this.__data__;if(N instanceof yt){var L=N.__data__;if(!sr||L.length<r-1)return L.push([g,D]),this.size=++N.size,this;N=this.__data__=new Ut(L)}return N.set(g,D),this.size=N.size,this}St.prototype.clear=fu,St.prototype.delete=du,St.prototype.get=pu,St.prototype.has=gu,St.prototype.set=yu;function bu(g,D){var N=jr(g),L=!N&&Ru(g),ce=!N&&!L&&Ci(g),X=!N&&!L&&!ce&&ws(g),de=N||L||ce||X,Ne=de?Rt(g.length,String):[],$e=Ne.length;for(var he in g)se.call(g,he)&&!(de&&(he=="length"||ce&&(he=="offset"||he=="parent")||X&&(he=="buffer"||he=="byteLength"||he=="byteOffset")||xu(he,$e)))&&Ne.push(he);return Ne}function Mr(g,D){for(var N=g.length;N--;)if(ps(g[N][0],D))return N;return-1}function wu(g,D,N){var L=D(g);return jr(g)?L:gt(L,N(g))}function ar(g){return g==null?g===void 0?A:T:$t&&$t in Object(g)?Iu(g):Pu(g)}function hs(g){return cr(g)&&ar(g)==c}function ls(g,D,N,L,ce){return g===D?!0:g==null||D==null||!cr(g)&&!cr(D)?g!==g&&D!==D:mu(g,D,N,L,ls,ce)}function mu(g,D,N,L,ce,X){var de=jr(g),Ne=jr(D),$e=de?u:It(g),he=Ne?u:It(D);$e=$e==c?v:$e,he=he==c?v:he;var Ye=$e==v,rt=he==v,Me=$e==he;if(Me&&Ci(g)){if(!Ci(D))return!1;de=!0,Ye=!1}if(Me&&!Ye)return X||(X=new St),de||ws(g)?fs(g,D,N,L,ce,X):Du(g,D,$e,N,L,ce,X);if(!(N&n)){var Xe=Ye&&se.call(g,"__wrapped__"),Ze=rt&&se.call(D,"__wrapped__");if(Xe||Ze){var Ot=Xe?g.value():g,bt=Ze?D.value():D;return X||(X=new St),ce(Ot,bt,N,L,X)}}return Me?(X||(X=new St),Su(g,D,N,L,ce,X)):!1}function _u(g){if(!bs(g)||Nu(g))return!1;var D=gs(g)?Ae:R;return D.test(Lt(g))}function Eu(g){return cr(g)&&ys(g.length)&&!!$[ar(g)]}function vu(g){if(!Tu(g))return Kc(g);var D=[];for(var N in Object(g))se.call(g,N)&&N!="constructor"&&D.push(N);return D}function fs(g,D,N,L,ce,X){var de=N&n,Ne=g.length,$e=D.length;if(Ne!=$e&&!(de&&$e>Ne))return!1;var he=X.get(g);if(he&&X.get(D))return he==D;var Ye=-1,rt=!0,Me=N&s?new Lr:void 0;for(X.set(g,D),X.set(D,g);++Ye<Ne;){var Xe=g[Ye],Ze=D[Ye];if(L)var Ot=de?L(Ze,Xe,Ye,D,g,X):L(Xe,Ze,Ye,g,D,X);if(Ot!==void 0){if(Ot)continue;rt=!1;break}if(Me){if(!Dt(D,function(bt,Mt){if(!pe(Me,Mt)&&(Xe===bt||ce(Xe,bt,N,L,X)))return Me.push(Mt)})){rt=!1;break}}else if(!(Xe===Ze||ce(Xe,Ze,N,L,X))){rt=!1;break}}return X.delete(g),X.delete(D),rt}function Du(g,D,N,L,ce,X,de){switch(N){case K:if(g.byteLength!=D.byteLength||g.byteOffset!=D.byteOffset)return!1;g=g.buffer,D=D.buffer;case z:return!(g.byteLength!=D.byteLength||!X(new os(g),new os(D)));case l:case f:case I:return ps(+g,+D);case d:return g.name==D.name&&g.message==D.message;case _:case a:return g==D+"";case S:var Ne=ge;case E:var $e=L&n;if(Ne||(Ne=be),g.size!=D.size&&!$e)return!1;var he=de.get(g);if(he)return he==D;L|=s,de.set(g,D);var Ye=fs(Ne(g),Ne(D),L,ce,X,de);return de.delete(g),Ye;case p:if(Ri)return Ri.call(g)==Ri.call(D)}return!1}function Su(g,D,N,L,ce,X){var de=N&n,Ne=ds(g),$e=Ne.length,he=ds(D),Ye=he.length;if($e!=Ye&&!de)return!1;for(var rt=$e;rt--;){var Me=Ne[rt];if(!(de?Me in D:se.call(D,Me)))return!1}var Xe=X.get(g);if(Xe&&X.get(D))return Xe==D;var Ze=!0;X.set(g,D),X.set(D,g);for(var Ot=de;++rt<$e;){Me=Ne[rt];var bt=g[Me],Mt=D[Me];if(L)var ms=de?L(Mt,bt,Me,D,g,X):L(bt,Mt,Me,g,D,X);if(!(ms===void 0?bt===Mt||ce(bt,Mt,N,L,X):ms)){Ze=!1;break}Ot||(Ot=Me=="constructor")}if(Ze&&!Ot){var zr=g.constructor,qr=D.constructor;zr!=qr&&"constructor"in g&&"constructor"in D&&!(typeof zr=="function"&&zr instanceof zr&&typeof qr=="function"&&qr instanceof qr)&&(Ze=!1)}return X.delete(g),X.delete(D),Ze}function ds(g){return wu(g,Fu,Ou)}function Br(g,D){var N=g.__data__;return Au(D)?N[typeof D=="string"?"string":"hash"]:N.map}function Wt(g,D){var N=le(g,D);return _u(N)?N:void 0}function Iu(g){var D=se.call(g,$t),N=g[$t];try{g[$t]=void 0;var L=!0}catch{}var ce=Ie.call(g);return L&&(D?g[$t]=N:delete g[$t]),ce}var Ou=cs?function(g){return g==null?[]:(g=Object(g),ut(cs(g),function(D){return as.call(g,D)}))}:Uu,It=ar;(Ai&&It(new Ai(new ArrayBuffer(1)))!=K||sr&&It(new sr)!=S||Ni&&It(Ni.resolve())!=m||Ti&&It(new Ti)!=E||Pi&&It(new Pi)!=F)&&(It=function(g){var D=ar(g),N=D==v?g.constructor:void 0,L=N?Lt(N):"";if(L)switch(L){case Vc:return K;case Hc:return S;case kc:return m;case Gc:return E;case Wc:return F}return D});function xu(g,D){return D=D??o,!!D&&(typeof g=="number"||M.test(g))&&g>-1&&g%1==0&&g<D}function Au(g){var D=typeof g;return D=="string"||D=="number"||D=="symbol"||D=="boolean"?g!=="__proto__":g===null}function Nu(g){return!!Se&&Se in g}function Tu(g){var D=g&&g.constructor,N=typeof D=="function"&&D.prototype||ue;return g===N}function Pu(g){return Ie.call(g)}function Lt(g){if(g!=null){try{return _e.call(g)}catch{}try{return g+""}catch{}}return""}function ps(g,D){return g===D||g!==g&&D!==D}var Ru=hs(function(){return arguments}())?hs:function(g){return cr(g)&&se.call(g,"callee")&&!as.call(g,"callee")},jr=Array.isArray;function Cu(g){return g!=null&&ys(g.length)&&!gs(g)}var Ci=qc||Lu;function $u(g,D){return ls(g,D)}function gs(g){if(!bs(g))return!1;var D=ar(g);return D==w||D==y||D==h||D==b}function ys(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=o}function bs(g){var D=typeof g;return g!=null&&(D=="object"||D=="function")}function cr(g){return g!=null&&typeof g=="object"}var ws=We?Ct(We):Eu;function Fu(g){return Cu(g)?bu(g):vu(g)}function Uu(){return[]}function Lu(){return!1}t.exports=$u})(hi,hi.exports);var jw=hi.exports;const zw=Nn(jw);var qw={};function Kw(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=n}var c=t.length,u=t.charAt(0),h=Math.log(c)/Math.log(256),l=Math.log(256)/Math.log(c);function f(y){if(y instanceof Uint8Array||(ArrayBuffer.isView(y)?y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength):Array.isArray(y)&&(y=Uint8Array.from(y))),!(y instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(y.length===0)return"";for(var S=0,I=0,T=0,v=y.length;T!==v&&y[T]===0;)T++,S++;for(var m=(v-T)*l+1>>>0,b=new Uint8Array(m);T!==v;){for(var _=y[T],E=0,a=m-1;(_!==0||E<I)&&a!==-1;a--,E++)_+=256*b[a]>>>0,b[a]=_%c>>>0,_=_/c>>>0;if(_!==0)throw new Error("Non-zero carry");I=E,T++}for(var p=m-I;p!==m&&b[p]===0;)p++;for(var A=u.repeat(S);p<m;++p)A+=t.charAt(b[p]);return A}function d(y){if(typeof y!="string")throw new TypeError("Expected String");if(y.length===0)return new Uint8Array;var S=0;if(y[S]!==" "){for(var I=0,T=0;y[S]===u;)I++,S++;for(var v=(y.length-S)*h+1>>>0,m=new Uint8Array(v);y[S];){var b=r[y.charCodeAt(S)];if(b===255)return;for(var _=0,E=v-1;(b!==0||_<T)&&E!==-1;E--,_++)b+=c*m[E]>>>0,m[E]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");T=_,S++}if(y[S]!==" "){for(var a=v-T;a!==v&&m[a]===0;)a++;for(var p=new Uint8Array(I+(v-a)),A=I;a!==v;)p[A++]=m[a++];return p}}}function w(y){var S=d(y);if(S)return S;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:d,decode:w}}var Vw=Kw,Hw=Vw;const Sc=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},kw=t=>new TextEncoder().encode(t),Gw=t=>new TextDecoder().decode(t);class Ww{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Yw{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ic(this,e)}}class Jw{constructor(e){this.decoders=e}or(e){return Ic(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Ic=(t,e)=>new Jw({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Qw{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new Ww(e,r,i),this.decoder=new Yw(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Oi=({name:t,prefix:e,encode:r,decode:i})=>new Qw(t,e,r,i),Ur=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=Hw(r,e);return Oi({prefix:t,name:e,encode:i,decode:s=>Sc(n(s))})},Xw=(t,e,r,i)=>{const n={};for(let l=0;l<e.length;++l)n[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let c=0,u=0,h=0;for(let l=0;l<s;++l){const f=n[t[l]];if(f===void 0)throw new SyntaxError(`Non-${i} character`);u=u<<r|f,c+=r,c>=8&&(c-=8,o[h++]=255&u>>c)}if(c>=r||255&u<<8-c)throw new SyntaxError("Unexpected end of data");return o},Zw=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",o=0,c=0;for(let u=0;u<t.length;++u)for(c=c<<8|t[u],o+=8;o>r;)o-=r,s+=e[n&c>>o];if(o&&(s+=e[n&c<<r-o]),i)for(;s.length*r&7;)s+="=";return s},Le=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Oi({prefix:e,name:t,encode(n){return Zw(n,i,r)},decode(n){return Xw(n,i,r,t)}}),em=Oi({prefix:"\0",name:"identity",encode:t=>Gw(t),decode:t=>kw(t)});var tm=Object.freeze({__proto__:null,identity:em});const rm=Le({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var im=Object.freeze({__proto__:null,base2:rm});const nm=Le({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var sm=Object.freeze({__proto__:null,base8:nm});const om=Ur({prefix:"9",name:"base10",alphabet:"0123456789"});var am=Object.freeze({__proto__:null,base10:om});const cm=Le({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),um=Le({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var hm=Object.freeze({__proto__:null,base16:cm,base16upper:um});const lm=Le({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),fm=Le({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),dm=Le({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),pm=Le({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),gm=Le({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ym=Le({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),bm=Le({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),wm=Le({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),mm=Le({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var _m=Object.freeze({__proto__:null,base32:lm,base32upper:fm,base32pad:dm,base32padupper:pm,base32hex:gm,base32hexupper:ym,base32hexpad:bm,base32hexpadupper:wm,base32z:mm});const Em=Ur({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),vm=Ur({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Dm=Object.freeze({__proto__:null,base36:Em,base36upper:vm});const Sm=Ur({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Im=Ur({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Om=Object.freeze({__proto__:null,base58btc:Sm,base58flickr:Im});const xm=Le({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Am=Le({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Nm=Le({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Tm=Le({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Pm=Object.freeze({__proto__:null,base64:xm,base64pad:Am,base64url:Nm,base64urlpad:Tm});const Oc=Array.from(""),Rm=Oc.reduce((t,e,r)=>(t[r]=e,t),[]),Cm=Oc.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function $m(t){return t.reduce((e,r)=>(e+=Rm[r],e),"")}function Fm(t){const e=[];for(const r of t){const i=Cm[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Um=Oi({prefix:"",name:"base256emoji",encode:$m,decode:Fm});var Lm=Object.freeze({__proto__:null,base256emoji:Um}),Mm=xc,Co=128,Bm=-128,jm=Math.pow(2,31);function xc(t,e,r){e=e||[],r=r||0;for(var i=r;t>=jm;)e[r++]=t&255|Co,t/=128;for(;t&Bm;)e[r++]=t&255|Co,t>>>=7;return e[r]=t|0,xc.bytes=r-i+1,e}var zm=xn,qm=128,$o=127;function xn(t,i){var r=0,i=i||0,n=0,s=i,o,c=t.length;do{if(s>=c)throw xn.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=n<28?(o&$o)<<n:(o&$o)*Math.pow(2,n),n+=7}while(o>=qm);return xn.bytes=s-i,r}var Km=Math.pow(2,7),Vm=Math.pow(2,14),Hm=Math.pow(2,21),km=Math.pow(2,28),Gm=Math.pow(2,35),Wm=Math.pow(2,42),Ym=Math.pow(2,49),Jm=Math.pow(2,56),Qm=Math.pow(2,63),Xm=function(t){return t<Km?1:t<Vm?2:t<Hm?3:t<km?4:t<Gm?5:t<Wm?6:t<Ym?7:t<Jm?8:t<Qm?9:10},Zm={encode:Mm,decode:zm,encodingLength:Xm},Ac=Zm;const Fo=(t,e,r=0)=>(Ac.encode(t,e,r),e),Uo=t=>Ac.encodingLength(t),An=(t,e)=>{const r=e.byteLength,i=Uo(t),n=i+Uo(r),s=new Uint8Array(n+r);return Fo(t,s,0),Fo(r,s,i),s.set(e,n),new e1(t,r,e,s)};class e1{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const Nc=({name:t,code:e,encode:r})=>new t1(t,e,r);class t1{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?An(this.code,r):r.then(i=>An(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Tc=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),r1=Nc({name:"sha2-256",code:18,encode:Tc("SHA-256")}),i1=Nc({name:"sha2-512",code:19,encode:Tc("SHA-512")});var n1=Object.freeze({__proto__:null,sha256:r1,sha512:i1});const Pc=0,s1="identity",Rc=Sc,o1=t=>An(Pc,Rc(t)),a1={code:Pc,name:s1,encode:Rc,digest:o1};var c1=Object.freeze({__proto__:null,identity:a1});new TextEncoder,new TextDecoder;const Lo={...tm,...im,...sm,...am,...hm,..._m,...Dm,...Om,...Pm,...Lm};({...n1,...c1});function Cc(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function u1(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Cc(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function $c(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Mo=$c("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Zi=$c("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=u1(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),h1={utf8:Mo,"utf-8":Mo,hex:Lo.base16,latin1:Zi,ascii:Zi,binary:Zi,...Lo};function l1(t,e="utf8"){const r=h1[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Cc(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}const Fc="wc",f1=2,rs="core",Tt=`${Fc}@2:${rs}:`,d1={name:rs,logger:"error"},p1={database:":memory:"},g1="crypto",Bo="client_ed25519_seed",y1=j.ONE_DAY,b1="keychain",w1="0.3",m1="messages",_1="0.3",E1=j.SIX_HOURS,v1="publisher",Uc="irn",D1="error",Lc="wss://relay.walletconnect.com",jo="wss://relay.walletconnect.org",S1="relayer",je={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},I1="_subscription",_t={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},O1=j.ONE_SECOND,x1="2.10.0",A1=1e4,N1="0.3",T1="WALLETCONNECT_CLIENT_ID",dt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},P1="subscription",R1="0.3",C1=j.FIVE_SECONDS*1e3,$1="pairing",F1="0.3",pr={wc_pairingDelete:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:j.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:j.ONE_DAY,prompt:!1,tag:0},res:{ttl:j.ONE_DAY,prompt:!1,tag:0}}},ft={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},U1="history",L1="0.3",M1="expirer",et={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},B1="0.3",en="verify-api",ni="https://verify.walletconnect.com",zo="https://verify.walletconnect.org";class j1{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=b1,this.version=w1,this.initialized=!1,this.storagePrefix=Tt,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,n)=>{this.isInitialized(),this.keychain.set(i,n),await this.persist()},this.get=i=>{this.isInitialized();const n=this.keychain.get(i);if(typeof n>"u"){const{message:s}=U("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(s)}return n},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=Qe(r,this.name)}get context(){return Ge(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,bc(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?wc(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=U("NOT_INITIALIZED",this.name);throw new Error(e)}}}class z1{constructor(e,r,i){this.core=e,this.logger=r,this.name=g1,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=n=>(this.isInitialized(),this.keychain.has(n)),this.getClientId=async()=>{this.isInitialized();const n=await this.getClientSeed(),s=oo(n);return Ga(s.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const n=gb();return this.setPrivateKey(n.publicKey,n.privateKey)},this.signJWT=async n=>{this.isInitialized();const s=await this.getClientSeed(),o=oo(s),c=In();return await ng(c,n,y1,o)},this.generateSharedKey=(n,s,o)=>{this.isInitialized();const c=this.getPrivateKey(n),u=yb(c,s);return this.setSymKey(u,o)},this.setSymKey=async(n,s)=>{this.isInitialized();const o=s||bb(n);return await this.keychain.set(o,n),o},this.deleteKeyPair=async n=>{this.isInitialized(),await this.keychain.del(n)},this.deleteSymKey=async n=>{this.isInitialized(),await this.keychain.del(n)},this.encode=async(n,s,o)=>{this.isInitialized();const c=yc(o),u=xr(s);if(mo(c)){const d=c.senderPublicKey,w=c.receiverPublicKey;n=await this.generateSharedKey(d,w)}const h=this.getSymKey(n),{type:l,senderPublicKey:f}=c;return mb({type:l,symKey:h,message:u,senderPublicKey:f})},this.decode=async(n,s,o)=>{this.isInitialized();const c=vb(s,o);if(mo(c)){const u=c.receiverPublicKey,h=c.senderPublicKey;n=await this.generateSharedKey(u,h)}try{const u=this.getSymKey(n),h=_b({symKey:u,encoded:s});return fi(h)}catch(u){this.logger.error(`Failed to decode message from topic: '${n}', clientId: '${await this.getClientId()}'`),this.logger.error(u)}},this.getPayloadType=n=>{const s=ci(n);return Rr(s.type)},this.getPayloadSenderPublicKey=n=>{const s=ci(n);return s.senderPublicKey?tt(s.senderPublicKey,qe):void 0},this.core=e,this.logger=Qe(r,this.name),this.keychain=i||new j1(this.core,this.logger)}get context(){return Ge(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Bo)}catch{e=In(),await this.keychain.set(Bo,e)}return l1(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=U("NOT_INITIALIZED",this.name);throw new Error(e)}}}class q1 extends sf{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=m1,this.version=_1,this.initialized=!1,this.storagePrefix=Tt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,n)=>{this.isInitialized();const s=tr(n);let o=this.messages.get(i);return typeof o>"u"&&(o={}),typeof o[s]<"u"||(o[s]=n,this.messages.set(i,o),await this.persist()),s},this.get=i=>{this.isInitialized();let n=this.messages.get(i);return typeof n>"u"&&(n={}),n},this.has=(i,n)=>{this.isInitialized();const s=this.get(i),o=tr(n);return typeof s[o]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=Qe(e,this.name),this.core=r}get context(){return Ge(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,bc(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?wc(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=U("NOT_INITIALIZED",this.name);throw new Error(e)}}}class K1 extends of{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new at.EventEmitter,this.name=v1,this.queue=new Map,this.publishTimeout=j.toMiliseconds(j.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(i,n,s)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:s}});try{const c=(s==null?void 0:s.ttl)||E1,u=On(s),h=(s==null?void 0:s.prompt)||!1,l=(s==null?void 0:s.tag)||0,f=(s==null?void 0:s.id)||ta().toString(),d={topic:i,message:n,opts:{ttl:c,relay:u,prompt:h,tag:l,id:f}},w=setTimeout(()=>this.queue.set(f,d),this.publishTimeout);try{await await Ir(this.rpcPublish(i,n,c,u,h,l,f),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(f),this.relayer.events.emit(je.publish,d)}catch(y){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(o=s==null?void 0:s.internal)!=null&&o.throwOnFailedPublish)throw this.removeRequestFromQueue(f),y;return}finally{clearTimeout(w)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:s}})}catch(c){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(c),c}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.relayer=e,this.logger=Qe(r,this.name),this.registerEventListeners()}get context(){return Ge(this.logger)}rpcPublish(e,r,i,n,s,o,c){var u,h,l,f;const d={method:ri(n.protocol).publish,params:{topic:e,message:r,ttl:i,prompt:s,tag:o},id:c};return ze((u=d.params)==null?void 0:u.prompt)&&((h=d.params)==null||delete h.prompt),ze((l=d.params)==null?void 0:l.tag)&&((f=d.params)==null||delete f.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:d}),this.relayer.request(d)}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:i,opts:n}=e;await this.publish(r,i,n)})}registerEventListeners(){this.relayer.core.heartbeat.on(rr.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(je.connection_stalled);return}this.checkQueue()}),this.relayer.on(je.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}class V1{constructor(){this.map=new Map,this.set=(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const n=i.filter(s=>s!==r);if(!n.length){this.map.delete(e);return}this.map.set(e,n)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var H1=Object.defineProperty,k1=Object.defineProperties,G1=Object.getOwnPropertyDescriptors,qo=Object.getOwnPropertySymbols,W1=Object.prototype.hasOwnProperty,Y1=Object.prototype.propertyIsEnumerable,Ko=(t,e,r)=>e in t?H1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gr=(t,e)=>{for(var r in e||(e={}))W1.call(e,r)&&Ko(t,r,e[r]);if(qo)for(var r of qo(e))Y1.call(e,r)&&Ko(t,r,e[r]);return t},tn=(t,e)=>k1(t,G1(e));class J1 extends uf{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new V1,this.events=new at.EventEmitter,this.name=P1,this.version=R1,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Tt,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(i,n)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}});try{const s=On(n),o={topic:i,relay:s};this.pending.set(i,o);const c=await this.rpcSubscribe(i,s);return this.onSubscribe(c,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}}),c}catch(s){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(s),s}},this.unsubscribe=async(i,n)=>{await this.restartToComplete(),this.isInitialized(),typeof(n==null?void 0:n.id)<"u"?await this.unsubscribeById(i,n.id,n):await this.unsubscribeByTopic(i,n)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((n,s)=>{const o=new j.Watch;o.start(this.pendingSubscriptionWatchLabel);const c=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(c),o.stop(this.pendingSubscriptionWatchLabel),n(!0)),o.elapsed(this.pendingSubscriptionWatchLabel)>=C1&&(clearInterval(c),o.stop(this.pendingSubscriptionWatchLabel),s(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=Qe(r,this.name),this.clientId=""}get context(){return Ge(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async n=>await this.unsubscribeById(e,n,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const n=On(i);await this.rpcUnsubscribe(e,r,n);const s=Pe("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,r){const i={method:ri(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await Ir(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(je.connection_stalled)}return tr(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:ri(r.protocol).batchSubscribe,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{return await await Ir(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(je.connection_stalled)}}rpcUnsubscribe(e,r,i){const n={method:ri(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.request(n)}onSubscribe(e,r){this.setSubscription(e,tn(gr({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,gr({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r))}addSubscription(e,r){this.subscriptions.set(e,gr({},r)),this.topicMap.set(r.topic,e),this.events.emit(dt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=U("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(dt.deleted,tn(gr({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(dt.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<e;r++){const i=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(dt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=U("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const r=await this.rpcBatchSubscribe(e);Fr(r)&&this.onBatchSubscribe(r.map((i,n)=>tn(gr({},e[n]),{id:i})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(r=>{e.push(r)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(rr.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(je.connect,async()=>{await this.onConnect()}),this.relayer.on(je.disconnect,()=>{this.onDisconnect()}),this.events.on(dt.created,async e=>{const r=dt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(dt.deleted,async e=>{const r=dt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=U("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),e())},this.pollingInterval)})}}var Q1=Object.defineProperty,Vo=Object.getOwnPropertySymbols,X1=Object.prototype.hasOwnProperty,Z1=Object.prototype.propertyIsEnumerable,Ho=(t,e,r)=>e in t?Q1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,e0=(t,e)=>{for(var r in e)X1.call(e,r)&&Ho(t,r,e[r]);if(Vo)for(var r of Vo(e))Z1.call(e,r)&&Ho(t,r,e[r]);return t};class t0 extends af{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new at.EventEmitter,this.name=S1,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(i){throw this.logger.debug("Failed to Publish Request"),this.logger.error(i),i}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(je.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(je.error,r)},this.registerProviderListeners=()=>{this.provider.on(_t.payload,this.onPayloadHandler),this.provider.on(_t.connect,this.onConnectHandler),this.provider.on(_t.disconnect,this.onDisconnectHandler),this.provider.on(_t.error,this.onProviderErrorHandler)},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Qe(e.logger,this.name):$n(Fn({level:e.logger||D1})),this.messages=new q1(this.logger,e.core),this.subscriber=new J1(this,this.logger),this.publisher=new K1(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Lc,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${jo}...`),await this.restartTransport(jo)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},A1)}get context(){return Ge(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now()})}async subscribe(e,r){var i;this.isInitialized();let n=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"";return n||(await Promise.all([new Promise(s=>{this.subscriber.once(dt.created,o=>{o.topic===e&&s()})}),new Promise(async s=>{n=await this.subscriber.subscribe(e,r),s()})]),n)}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Ir(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(e){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(dt.resubscribed,()=>{r()})}),new Promise(async(r,i)=>{try{await Ir(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(n){i(n);return}r()})])}catch(r){this.logger.error(r);const i=r;if(!this.isConnectionStalled(i.message))throw r;this.provider.events.emit(_t.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(e){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await No())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(e){return this.staleConnectionErrors.some(r=>e.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Fw(new Bw(Cb({sdkVersion:x1,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:r,message:i}=e;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const n=this.messages.has(r,i);return n&&this.logger.debug(`Ignoring duplicate message: ${i}`),n}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),ts(e)){if(!e.method.endsWith(I1))return;const r=e.params,{topic:i,message:n,publishedAt:s}=r.data,o={topic:i,message:n,publishedAt:s};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(e0({type:"event",event:r.id},o)),this.events.emit(r.id,o),await this.acknowledgePayload(e),await this.onMessageEvent(o)}else Ii(e)&&this.events.emit(je.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(je.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=Rn(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(_t.payload,this.onPayloadHandler),this.provider.off(_t.connect,this.onConnectHandler),this.provider.off(_t.disconnect,this.onDisconnectHandler),this.provider.off(_t.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(je.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let e=await No();Iw(async r=>{this.initialized&&e!==r&&(e=r,r?await this.restartTransport().catch(i=>this.logger.error(i)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(i=>this.logger.error(i))))})}onProviderDisconnect(){this.events.emit(je.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(e=>this.logger.error(e))},j.toMiliseconds(O1)))}isInitialized(){if(!this.initialized){const{message:e}=U("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(e=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),e())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var r0=Object.defineProperty,ko=Object.getOwnPropertySymbols,i0=Object.prototype.hasOwnProperty,n0=Object.prototype.propertyIsEnumerable,Go=(t,e,r)=>e in t?r0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Wo=(t,e)=>{for(var r in e||(e={}))i0.call(e,r)&&Go(t,r,e[r]);if(ko)for(var r of ko(e))n0.call(e,r)&&Go(t,r,e[r]);return t};class xi extends cf{constructor(e,r,i,n=Tt,s=void 0){super(e,r,i,n),this.core=e,this.logger=r,this.name=i,this.map=new Map,this.version=N1,this.cached=[],this.initialized=!1,this.storagePrefix=Tt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!ze(o)?this.map.set(this.getKey(o),o):rw(o)?this.map.set(o.id,o):iw(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)},this.set=async(o,c)=>{this.isInitialized(),this.map.has(o)?await this.update(o,c):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:c}),this.map.set(o,c),await this.persist())},this.get=o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o)),this.getAll=o=>(this.isInitialized(),o?this.values.filter(c=>Object.keys(o).every(u=>zw(c[u],o[u]))):this.values),this.update=async(o,c)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:c});const u=Wo(Wo({},this.getData(o)),c);this.map.set(o,u),await this.persist()},this.delete=async(o,c)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:c}),this.map.delete(o),await this.persist())},this.logger=Qe(r,this.name),this.storagePrefix=n,this.getKey=s}get context(){return Ge(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){const{message:i}=U("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=U("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=U("NOT_INITIALIZED",this.name);throw new Error(e)}}}class s0{constructor(e,r){this.core=e,this.logger=r,this.name=$1,this.version=F1,this.events=new ha,this.initialized=!1,this.storagePrefix=Tt,this.ignoredPayloadTypes=[Gt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=In(),n=await this.core.crypto.setSymKey(i),s=nt(j.FIVE_MINUTES),o={protocol:Uc},c={topic:n,expiry:s,relay:o,active:!1},u=kb({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:i,relay:o});return await this.pairings.set(n,c),await this.core.relayer.subscribe(n),this.core.expirer.set(n,s),{topic:n,uri:u}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:n,symKey:s,relay:o}=Kb(i.uri);if(this.pairings.keys.includes(n))throw new Error(`Pairing already exists: ${n}`);if(this.core.crypto.hasKeys(n))throw new Error(`Keychain already exists: ${n}`);const c=nt(j.FIVE_MINUTES),u={topic:n,relay:o,expiry:c,active:!1};return await this.pairings.set(n,u),await this.core.crypto.setSymKey(s,n),await this.core.relayer.subscribe(n,{relay:o}),this.core.expirer.set(n,c),i.activatePairing&&await this.activate({topic:n}),u},this.activate=async({topic:i})=>{this.isInitialized();const n=nt(j.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:n}),this.core.expirer.set(i,n)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.pairings.keys.includes(n)){const s=await this.sendRequest(n,"wc_pairingPing",{}),{done:o,resolve:c,reject:u}=Zt();this.events.once(De("pairing_ping",s),({error:h})=>{h?u(h):c()}),await o()}},this.updateExpiry=async({topic:i,expiry:n})=>{this.isInitialized(),await this.pairings.update(i,{expiry:n})},this.updateMetadata=async({topic:i,metadata:n})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:n})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",Pe("USER_DISCONNECTED")),await this.deletePairing(n))},this.sendRequest=async(i,n,s)=>{const o=mr(n,s),c=await this.core.crypto.encode(i,o),u=pr[n].req;return this.core.history.set(i,o),this.core.relayer.publish(i,c,u),o.id},this.sendResult=async(i,n,s)=>{const o=Rn(i,s),c=await this.core.crypto.encode(n,o),u=await this.core.history.get(n,i),h=pr[u.request.method].res;await this.core.relayer.publish(n,c,h),await this.core.history.resolve(o)},this.sendError=async(i,n,s)=>{const o=Pn(i,s),c=await this.core.crypto.encode(n,o),u=await this.core.history.get(n,i),h=pr[u.request.method]?pr[u.request.method].res:pr.unregistered_method.res;await this.core.relayer.publish(n,c,h),await this.core.history.resolve(o)},this.deletePairing=async(i,n)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,Pe("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),n?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(n=>Nt(n.expiry));await Promise.all(i.map(n=>this.deletePairing(n.topic)))},this.onRelayEventRequest=i=>{const{topic:n,payload:s}=i;switch(s.method){case"wc_pairingPing":return this.onPairingPingRequest(n,s);case"wc_pairingDelete":return this.onPairingDeleteRequest(n,s);default:return this.onUnknownRpcMethodRequest(n,s)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:s}=i,o=(await this.core.history.get(n,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(n,s);default:return this.onUnknownRpcMethodResponse(o)}},this.onPairingPingRequest=async(i,n)=>{const{id:s}=n;try{this.isValidPing({topic:i}),await this.sendResult(s,i,!0),this.events.emit("pairing_ping",{id:s,topic:i})}catch(o){await this.sendError(s,i,o),this.logger.error(o)}},this.onPairingPingResponse=(i,n)=>{const{id:s}=n;setTimeout(()=>{vt(n)?this.events.emit(De("pairing_ping",s),{}):st(n)&&this.events.emit(De("pairing_ping",s),{error:n.error})},500)},this.onPairingDeleteRequest=async(i,n)=>{const{id:s}=n;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit("pairing_delete",{id:s,topic:i})}catch(o){await this.sendError(s,i,o),this.logger.error(o)}},this.onUnknownRpcMethodRequest=async(i,n)=>{const{id:s,method:o}=n;try{if(this.registeredMethods.includes(o))return;const c=Pe("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,i,c),this.logger.error(c)}catch(c){await this.sendError(s,i,c),this.logger.error(c)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(Pe("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{if(!ke(i)){const{message:n}=U("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(n)}if(!tw(i.uri)){const{message:n}=U("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(n)}},this.isValidPing=async i=>{if(!ke(i)){const{message:s}=U("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidDisconnect=async i=>{if(!ke(i)){const{message:s}=U("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidPairingTopic=async i=>{if(!Re(i,!1)){const{message:n}=U("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(n)}if(!this.pairings.keys.includes(i)){const{message:n}=U("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(n)}if(Nt(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:n}=U("EXPIRED",`pairing topic: ${i}`);throw new Error(n)}},this.core=e,this.logger=Qe(r,this.name),this.pairings=new xi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ge(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=U("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(je.message,async e=>{const{topic:r,message:i}=e;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const n=await this.core.crypto.decode(r,i);try{ts(n)?(this.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):Ii(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.core.history.delete(r,n.id))}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(et.expired,async e=>{const{topic:r}=_c(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit("pairing_expire",{topic:r}))})}}class o0 extends nf{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new at.EventEmitter,this.name=U1,this.version=L1,this.cached=[],this.initialized=!1,this.storagePrefix=Tt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,n,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:n,chainId:s}),this.records.has(n.id))return;const o={id:n.id,topic:i,request:{method:n.method,params:n.params||null},chainId:s,expiry:nt(j.THIRTY_DAYS)};this.records.set(o.id,o),this.events.emit(ft.created,o)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const n=await this.getRecord(i.id);typeof n.response>"u"&&(n.response=st(i)?{error:i.error}:{result:i.result},this.records.set(n.id,n),this.events.emit(ft.updated,n))},this.get=async(i,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:n}),await this.getRecord(n)),this.delete=(i,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(s=>{if(s.topic===i){if(typeof n<"u"&&s.id!==n)return;this.records.delete(s.id),this.events.emit(ft.deleted,s)}})},this.exists=async(i,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===i:!1),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=Qe(r,this.name)}get context(){return Ge(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:mr(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=U("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(ft.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=U("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(ft.created,e=>{const r=ft.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(ft.updated,e=>{const r=ft.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(ft.deleted,e=>{const r=ft.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.core.heartbeat.on(rr.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(e=>{j.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.delete(e.topic,e.id))})}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=U("NOT_INITIALIZED",this.name);throw new Error(e)}}}class a0 extends hf{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new at.EventEmitter,this.name=M1,this.version=B1,this.cached=[],this.initialized=!1,this.storagePrefix=Tt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const n=this.formatTarget(i);return typeof this.getExpiration(n)<"u"}catch{return!1}},this.set=(i,n)=>{this.isInitialized();const s=this.formatTarget(i),o={target:s,expiry:n};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(et.created,{target:s,expiration:o})},this.get=i=>{this.isInitialized();const n=this.formatTarget(i);return this.getExpiration(n)},this.del=i=>{if(this.isInitialized(),this.has(i)){const n=this.formatTarget(i),s=this.getExpiration(n);this.expirations.delete(n),this.events.emit(et.deleted,{target:n,expiration:s})}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=Qe(r,this.name)}get context(){return Ge(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return $b(e);if(typeof e=="number")return Fb(e);const{message:r}=U("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(et.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=U("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=U("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;j.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(et.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(rr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(et.created,e=>{const r=et.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(et.expired,e=>{const r=et.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(et.deleted,e=>{const r=et.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=U("NOT_INITIALIZED",this.name);throw new Error(e)}}}class c0 extends lf{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.name=en,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async i=>{if(this.verifyDisabled||Si()||!Cr())return;const n=(i==null?void 0:i.verifyUrl)||ni;this.verifyUrl!==n&&this.removeIframe(),this.verifyUrl=n;try{await this.createIframe()}catch(s){this.logger.warn(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.warn(s)}if(!this.initialized){this.removeIframe(),this.verifyUrl=zo;try{await this.createIframe()}catch(s){this.logger.error(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.error(s),this.verifyDisabled=!0}}},this.register=async i=>{this.initialized?this.sendPost(i.attestationId):(this.addToQueue(i.attestationId),await this.init())},this.resolve=async i=>{if(this.isDevEnv)return"";const n=(i==null?void 0:i.verifyUrl)||ni;let s="";try{s=await this.fetchAttestation(i.attestationId,n)}catch(o){this.logger.warn(`failed to resolve attestation: ${i.attestationId} from url: ${n}`),this.logger.warn(o),s=await this.fetchAttestation(i.attestationId,zo)}return s},this.fetchAttestation=async(i,n)=>{var s;this.logger.info(`resolving attestation: ${i} from url: ${n}`);const o=this.startAbortTimer(j.ONE_SECOND*2),c=await fetch(`${n}/attestation/${i}`,{signal:this.abortController.signal});return clearTimeout(o),c.status===200?(s=await c.json())==null?void 0:s.origin:""},this.addToQueue=i=>{this.queue.push(i)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(i=>this.sendPost(i)),this.queue=[])},this.sendPost=i=>{var n;try{if(!this.iframe)return;(n=this.iframe.contentWindow)==null||n.postMessage(i,"*"),this.logger.info(`postMessage sent: ${i} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let i;const n=s=>{s.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",n),i())};await Promise.race([new Promise(s=>{if(document.getElementById(en))return s();window.addEventListener("message",n);const o=document.createElement("iframe");o.id=en,o.src=`${this.verifyUrl}/${this.projectId}`,o.style.display="none",document.body.append(o),this.iframe=o,i=s}),new Promise((s,o)=>setTimeout(()=>{window.removeEventListener("message",n),o("verify iframe load timeout")},j.toMiliseconds(j.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.logger=Qe(r,this.name),this.verifyUrl=ni,this.abortController=new AbortController,this.isDevEnv=Zn()&&qw.IS_VITEST}get context(){return Ge(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),j.toMiliseconds(e))}}var u0=Object.defineProperty,Yo=Object.getOwnPropertySymbols,h0=Object.prototype.hasOwnProperty,l0=Object.prototype.propertyIsEnumerable,Jo=(t,e,r)=>e in t?u0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Qo=(t,e)=>{for(var r in e||(e={}))h0.call(e,r)&&Jo(t,r,e[r]);if(Yo)for(var r of Yo(e))l0.call(e,r)&&Jo(t,r,e[r]);return t};class is extends rf{constructor(e){super(e),this.protocol=Fc,this.version=f1,this.name=rs,this.events=new at.EventEmitter,this.initialized=!1,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Lc;const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:$n(Fn({level:(e==null?void 0:e.logger)||d1.logger}));this.logger=Qe(r,this.name),this.heartbeat=new rr.HeartBeat,this.crypto=new z1(this,this.logger,e==null?void 0:e.keychain),this.history=new o0(this,this.logger),this.expirer=new a0(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Ph(Qo(Qo({},p1),e==null?void 0:e.storageOptions)),this.relayer=new t0({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new s0(this,this.logger),this.verify=new c0(this.projectId||"",this.logger)}static async init(e){const r=new is(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(T1,i),r}get context(){return Ge(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const f0=is,Mc="wc",Bc=2,jc="client",ns=`${Mc}@${Bc}:${jc}:`,rn={name:jc,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Xo="WALLETCONNECT_DEEPLINK_CHOICE",d0="proposal",p0="Proposal expired",g0="session",Qr=j.SEVEN_DAYS,y0="engine",yr={wc_sessionPropose:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1104},res:{ttl:j.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1106},res:{ttl:j.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1112},res:{ttl:j.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1115}}},nn={min:j.FIVE_MINUTES,max:j.SEVEN_DAYS},Et={idle:"IDLE",active:"ACTIVE"},b0="request",w0=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var m0=Object.defineProperty,_0=Object.defineProperties,E0=Object.getOwnPropertyDescriptors,Zo=Object.getOwnPropertySymbols,v0=Object.prototype.hasOwnProperty,D0=Object.prototype.propertyIsEnumerable,ea=(t,e,r)=>e in t?m0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ve=(t,e)=>{for(var r in e||(e={}))v0.call(e,r)&&ea(t,r,e[r]);if(Zo)for(var r of Zo(e))D0.call(e,r)&&ea(t,r,e[r]);return t},br=(t,e)=>_0(t,E0(e));class S0 extends df{constructor(e){super(e),this.name=y0,this.events=new ha,this.initialized=!1,this.ignoredPayloadTypes=[Gt],this.requestQueue={state:Et.idle,queue:[]},this.sessionRequestQueue={state:Et.idle,queue:[]},this.requestQueueDelay=j.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(yr)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},j.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const i=br(Ve({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(i);const{pairingTopic:n,requiredNamespaces:s,optionalNamespaces:o,sessionProperties:c,relays:u}=i;let h=n,l,f=!1;if(h&&(f=this.client.core.pairing.pairings.get(h).active),!h||!f){const{topic:m,uri:b}=await this.client.core.pairing.create();h=m,l=b}const d=await this.client.core.crypto.generateKeyPair(),w=Ve({requiredNamespaces:s,optionalNamespaces:o,relays:u??[{protocol:Uc}],proposer:{publicKey:d,metadata:this.client.metadata}},c&&{sessionProperties:c}),{reject:y,resolve:S,done:I}=Zt(j.FIVE_MINUTES,p0);if(this.events.once(De("session_connect"),async({error:m,session:b})=>{if(m)y(m);else if(b){b.self.publicKey=d;const _=br(Ve({},b),{requiredNamespaces:b.requiredNamespaces,optionalNamespaces:b.optionalNamespaces});await this.client.session.set(b.topic,_),await this.setExpiry(b.topic,b.expiry),h&&await this.client.core.pairing.updateMetadata({topic:h,metadata:b.peer.metadata}),S(_)}}),!h){const{message:m}=U("NO_MATCHING_KEY",`connect() pairing topic: ${h}`);throw new Error(m)}const T=await this.sendRequest({topic:h,method:"wc_sessionPropose",params:w}),v=nt(j.FIVE_MINUTES);return await this.setProposal(T,Ve({id:T,expiry:v},w)),{uri:l,approval:I}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:i,relayProtocol:n,namespaces:s,sessionProperties:o}=r,c=this.client.proposal.get(i);let{pairingTopic:u,proposer:h,requiredNamespaces:l,optionalNamespaces:f}=c;u=u||"",wr(l)||(l=Jb(s,"approve()"));const d=await this.client.core.crypto.generateKeyPair(),w=h.publicKey,y=await this.client.core.crypto.generateSharedKey(d,w);u&&i&&(await this.client.core.pairing.updateMetadata({topic:u,metadata:h.metadata}),await this.sendResult({id:i,topic:u,result:{relay:{protocol:n??"irn"},responderPublicKey:d}}),await this.client.proposal.delete(i,Pe("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:u}));const S=Ve({relay:{protocol:n??"irn"},namespaces:s,requiredNamespaces:l,optionalNamespaces:f,pairingTopic:u,controller:{publicKey:d,metadata:this.client.metadata},expiry:nt(Qr)},o&&{sessionProperties:o});await this.client.core.relayer.subscribe(y),await this.sendRequest({topic:y,method:"wc_sessionSettle",params:S,throwOnFailedPublish:!0});const I=br(Ve({},S),{topic:y,pairingTopic:u,acknowledged:!1,self:S.controller,peer:{publicKey:h.publicKey,metadata:h.metadata},controller:d});return await this.client.session.set(y,I),await this.setExpiry(y,nt(Qr)),{topic:y,acknowledged:()=>new Promise(T=>setTimeout(()=>T(this.client.session.get(y)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:i,reason:n}=r,{pairingTopic:s}=this.client.proposal.get(i);s&&(await this.sendError(i,s,n),await this.client.proposal.delete(i,Pe("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:i,namespaces:n}=r,s=await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:n}}),{done:o,resolve:c,reject:u}=Zt();return this.events.once(De("session_update",s),({error:h})=>{h?u(h):c()}),await this.client.session.update(i,{namespaces:n}),{acknowledged:o}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:i}=r,n=await this.sendRequest({topic:i,method:"wc_sessionExtend",params:{}}),{done:s,resolve:o,reject:c}=Zt();return this.events.once(De("session_extend",n),({error:u})=>{u?c(u):o()}),await this.setExpiry(i,nt(Qr)),{acknowledged:s}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:i,request:n,topic:s,expiry:o}=r,c=Hu(),{done:u,resolve:h,reject:l}=Zt(o);return this.events.once(De("session_request",c),({error:f,result:d})=>{f?l(f):h(d)}),await Promise.all([new Promise(async f=>{await this.sendRequest({clientRpcId:c,topic:s,method:"wc_sessionRequest",params:{request:n,chainId:i},expiry:o,throwOnFailedPublish:!0}).catch(d=>l(d)),this.client.events.emit("session_request_sent",{topic:s,request:n,chainId:i,id:c}),f()}),new Promise(async f=>{const d=await this.client.core.storage.getItem(Xo);Ub({id:c,topic:s,wcDeepLink:d}),f()}),u()]).then(f=>f[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:n}=r,{id:s}=n;vt(n)?await this.sendResult({id:s,topic:i,result:n.result,throwOnFailedPublish:!0}):st(n)&&await this.sendError(s,i,n.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const n=await this.sendRequest({topic:i,method:"wc_sessionPing",params:{}}),{done:s,resolve:o,reject:c}=Zt();this.events.once(De("session_ping",n),({error:u})=>{u?c(u):o()}),await s()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:i,event:n,chainId:s}=r;await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:n,chainId:s}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.client.session.keys.includes(i)?(await this.sendRequest({topic:i,method:"wc_sessionDelete",params:Pe("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(i)):await this.client.core.pairing.disconnect({topic:i})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(i=>Zb(i,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),n=this.client.core.pairing.pairings.getAll().filter(s=>{var o,c;return((o=s.peerMetadata)==null?void 0:o.url)&&((c=s.peerMetadata)==null?void 0:c.url)===r.peer.metadata.url&&s.topic&&s.topic!==i.topic});if(n.length===0)return;this.client.logger.info(`Cleaning up ${n.length} duplicate pairing(s)`),await Promise.all(n.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}},this.deleteSession=async(r,i)=>{const{self:n}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,Pe("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(n.publicKey)&&await this.client.core.crypto.deleteKeyPair(n.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),i||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Xo).catch(s=>this.client.logger.warn(s))},this.deleteProposal=async(r,i)=>{await Promise.all([this.client.proposal.delete(r,Pe("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,i,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),n?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==r),n&&(this.sessionRequestQueue.state=Et.idle)},this.setExpiry=async(r,i)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:i}),this.client.core.expirer.set(r,i)},this.setProposal=async(r,i)=>{await this.client.proposal.set(r,i),this.client.core.expirer.set(r,i.expiry)},this.setPendingSessionRequest=async r=>{const i=yr.wc_sessionRequest.req.ttl,{id:n,topic:s,params:o}=r;await this.client.pendingRequest.set(n,{id:n,topic:s,params:o}),i&&this.client.core.expirer.set(n,nt(i))},this.sendRequest=async r=>{const{topic:i,method:n,params:s,expiry:o,relayRpcId:c,clientRpcId:u,throwOnFailedPublish:h}=r,l=mr(n,s,u);if(Cr()&&w0.includes(n)){const w=tr(JSON.stringify(l));this.client.core.verify.register({attestationId:w})}const f=await this.client.core.crypto.encode(i,l),d=yr[n].req;return o&&(d.ttl=o),c&&(d.id=c),this.client.core.history.set(i,l),h?(d.internal=br(Ve({},d.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,f,d)):this.client.core.relayer.publish(i,f,d).catch(w=>this.client.logger.error(w)),l.id},this.sendResult=async r=>{const{id:i,topic:n,result:s,throwOnFailedPublish:o}=r,c=Rn(i,s),u=await this.client.core.crypto.encode(n,c),h=await this.client.core.history.get(n,i),l=yr[h.request.method].res;o?(l.internal=br(Ve({},l.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,u,l)):this.client.core.relayer.publish(n,u,l).catch(f=>this.client.logger.error(f)),await this.client.core.history.resolve(c)},this.sendError=async(r,i,n)=>{const s=Pn(r,n),o=await this.client.core.crypto.encode(i,s),c=await this.client.core.history.get(i,r),u=yr[c.request.method].res;this.client.core.relayer.publish(i,o,u),await this.client.core.history.resolve(s)},this.cleanup=async()=>{const r=[],i=[];this.client.session.getAll().forEach(n=>{Nt(n.expiry)&&r.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{Nt(n.expiry)&&i.push(n.id)}),await Promise.all([...r.map(n=>this.deleteSession(n)),...i.map(n=>this.deleteProposal(n))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===Et.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Et.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(i=>setTimeout(i,300))}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=Et.idle},this.processRequest=r=>{const{topic:i,payload:n}=r,s=n.method;switch(s){case"wc_sessionPropose":return this.onSessionProposeRequest(i,n);case"wc_sessionSettle":return this.onSessionSettleRequest(i,n);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,n);case"wc_sessionExtend":return this.onSessionExtendRequest(i,n);case"wc_sessionPing":return this.onSessionPingRequest(i,n);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,n);case"wc_sessionRequest":return this.onSessionRequest(i,n);case"wc_sessionEvent":return this.onSessionEventRequest(i,n);default:return this.client.logger.info(`Unsupported request method ${s}`)}},this.onRelayEventResponse=async r=>{const{topic:i,payload:n}=r,s=(await this.client.core.history.get(i,n.id)).request.method;switch(s){case"wc_sessionPropose":return this.onSessionProposeResponse(i,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,n);case"wc_sessionExtend":return this.onSessionExtendResponse(i,n);case"wc_sessionPing":return this.onSessionPingResponse(i,n);case"wc_sessionRequest":return this.onSessionRequestResponse(i,n);default:return this.client.logger.info(`Unsupported response method ${s}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:i}=r,{message:n}=U("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(n)},this.onSessionProposeRequest=async(r,i)=>{const{params:n,id:s}=i;try{this.isValidConnect(Ve({},i.params));const o=nt(j.FIVE_MINUTES),c=Ve({id:s,pairingTopic:r,expiry:o},n);await this.setProposal(s,c);const u=tr(JSON.stringify(i)),h=await this.getVerifyContext(u,c.proposer.metadata);this.client.events.emit("session_proposal",{id:s,params:c,verifyContext:h})}catch(o){await this.sendError(s,r,o),this.client.logger.error(o)}},this.onSessionProposeResponse=async(r,i)=>{const{id:n}=i;if(vt(i)){const{result:s}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:s});const o=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:o});const c=o.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const u=s.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u});const h=await this.client.core.crypto.generateSharedKey(c,u);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:h});const l=await this.client.core.relayer.subscribe(h);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:l}),await this.client.core.pairing.activate({topic:r})}else st(i)&&(await this.client.proposal.delete(n,Pe("USER_DISCONNECTED")),this.events.emit(De("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(r,i)=>{const{id:n,params:s}=i;try{this.isValidSessionSettleRequest(s);const{relay:o,controller:c,expiry:u,namespaces:h,requiredNamespaces:l,optionalNamespaces:f,sessionProperties:d,pairingTopic:w}=i.params,y=Ve({topic:r,relay:o,expiry:u,namespaces:h,acknowledged:!0,pairingTopic:w,requiredNamespaces:l,optionalNamespaces:f,controller:c.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:c.publicKey,metadata:c.metadata}},d&&{sessionProperties:d});await this.sendResult({id:i.id,topic:r,result:!0}),this.events.emit(De("session_connect"),{session:y}),this.cleanupDuplicatePairings(y)}catch(o){await this.sendError(n,r,o),this.client.logger.error(o)}},this.onSessionSettleResponse=async(r,i)=>{const{id:n}=i;vt(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(De("session_approve",n),{})):st(i)&&(await this.client.session.delete(r,Pe("USER_DISCONNECTED")),this.events.emit(De("session_approve",n),{error:i.error}))},this.onSessionUpdateRequest=async(r,i)=>{const{params:n,id:s}=i;try{const o=`${r}_session_update`,c=Jr.get(o);if(c&&this.isRequestOutOfSync(c,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidUpdate(Ve({topic:r},n)),await this.client.session.update(r,{namespaces:n.namespaces}),await this.sendResult({id:s,topic:r,result:!0}),this.client.events.emit("session_update",{id:s,topic:r,params:n}),Jr.set(o,s)}catch(o){await this.sendError(s,r,o),this.client.logger.error(o)}},this.isRequestOutOfSync=(r,i)=>parseInt(i.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,i)=>{const{id:n}=i;vt(i)?this.events.emit(De("session_update",n),{}):st(i)&&this.events.emit(De("session_update",n),{error:i.error})},this.onSessionExtendRequest=async(r,i)=>{const{id:n}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,nt(Qr)),await this.sendResult({id:n,topic:r,result:!0}),this.client.events.emit("session_extend",{id:n,topic:r})}catch(s){await this.sendError(n,r,s),this.client.logger.error(s)}},this.onSessionExtendResponse=(r,i)=>{const{id:n}=i;vt(i)?this.events.emit(De("session_extend",n),{}):st(i)&&this.events.emit(De("session_extend",n),{error:i.error})},this.onSessionPingRequest=async(r,i)=>{const{id:n}=i;try{this.isValidPing({topic:r}),await this.sendResult({id:n,topic:r,result:!0}),this.client.events.emit("session_ping",{id:n,topic:r})}catch(s){await this.sendError(n,r,s),this.client.logger.error(s)}},this.onSessionPingResponse=(r,i)=>{const{id:n}=i;setTimeout(()=>{vt(i)?this.events.emit(De("session_ping",n),{}):st(i)&&this.events.emit(De("session_ping",n),{error:i.error})},500)},this.onSessionDeleteRequest=async(r,i)=>{const{id:n}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),await Promise.all([new Promise(s=>{this.client.core.relayer.once(je.publish,async()=>{s(await this.deleteSession(r))})}),this.sendResult({id:n,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:n,topic:r})}catch(s){this.client.logger.error(s)}},this.onSessionRequest=async(r,i)=>{const{id:n,params:s}=i;try{this.isValidRequest(Ve({topic:r},s)),await this.setPendingSessionRequest({id:n,topic:r,params:s}),this.addSessionRequestToSessionRequestQueue({id:n,topic:r,params:s}),await this.processSessionRequestQueue()}catch(o){await this.sendError(n,r,o),this.client.logger.error(o)}},this.onSessionRequestResponse=(r,i)=>{const{id:n}=i;vt(i)?this.events.emit(De("session_request",n),{result:i.result}):st(i)&&this.events.emit(De("session_request",n),{error:i.error})},this.onSessionEventRequest=async(r,i)=>{const{id:n,params:s}=i;try{const o=`${r}_session_event_${s.event.name}`,c=Jr.get(o);if(c&&this.isRequestOutOfSync(c,n)){this.client.logger.info(`Discarding out of sync request - ${n}`);return}this.isValidEmit(Ve({topic:r},s)),this.client.events.emit("session_event",{id:n,topic:r,params:s}),Jr.set(o,n)}catch(o){await this.sendError(n,r,o),this.client.logger.error(o)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Et.idle,this.processSessionRequestQueue()},j.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=async()=>{if(this.sessionRequestQueue.state===Et.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{const{id:i,topic:n,params:s}=r,o=tr(JSON.stringify(mr("wc_sessionRequest",s,i))),c=this.client.session.get(n),u=await this.getVerifyContext(o,c.peer.metadata);this.sessionRequestQueue.state=Et.active,this.client.events.emit("session_request",{id:i,topic:n,params:s,verifyContext:u})}catch(i){this.client.logger.error(i)}},this.isValidConnect=async r=>{if(!ke(r)){const{message:u}=U("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(u)}const{pairingTopic:i,requiredNamespaces:n,optionalNamespaces:s,sessionProperties:o,relays:c}=r;if(ze(i)||await this.isValidPairingTopic(i),!lw(c)){const{message:u}=U("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(u)}!ze(n)&&wr(n)!==0&&this.validateNamespaces(n,"requiredNamespaces"),!ze(s)&&wr(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),ze(o)||this.validateSessionProps(o,"sessionProperties")},this.validateNamespaces=(r,i)=>{const n=hw(r,"connect()",i);if(n)throw new Error(n.message)},this.isValidApprove=async r=>{if(!ke(r))throw new Error(U("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:n,relayProtocol:s,sessionProperties:o}=r;await this.isValidProposalId(i);const c=this.client.proposal.get(i),u=ii(n,"approve()");if(u)throw new Error(u.message);const h=xo(c.requiredNamespaces,n,"approve()");if(h)throw new Error(h.message);if(!Re(s,!0)){const{message:l}=U("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(l)}ze(o)||this.validateSessionProps(o,"sessionProperties")},this.isValidReject=async r=>{if(!ke(r)){const{message:s}=U("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(s)}const{id:i,reason:n}=r;if(await this.isValidProposalId(i),!dw(n)){const{message:s}=U("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(s)}},this.isValidSessionSettleRequest=r=>{if(!ke(r)){const{message:h}=U("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(h)}const{relay:i,controller:n,namespaces:s,expiry:o}=r;if(!vc(i)){const{message:h}=U("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(h)}const c=nw(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);const u=ii(s,"onSessionSettleRequest()");if(u)throw new Error(u.message);if(Nt(o)){const{message:h}=U("EXPIRED","onSessionSettleRequest()");throw new Error(h)}},this.isValidUpdate=async r=>{if(!ke(r)){const{message:u}=U("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(u)}const{topic:i,namespaces:n}=r;await this.isValidSessionTopic(i);const s=this.client.session.get(i),o=ii(n,"update()");if(o)throw new Error(o.message);const c=xo(s.requiredNamespaces,n,"update()");if(c)throw new Error(c.message)},this.isValidExtend=async r=>{if(!ke(r)){const{message:n}=U("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionTopic(i)},this.isValidRequest=async r=>{if(!ke(r)){const{message:u}=U("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(u)}const{topic:i,request:n,chainId:s,expiry:o}=r;await this.isValidSessionTopic(i);const{namespaces:c}=this.client.session.get(i);if(!Oo(c,s)){const{message:u}=U("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(u)}if(!pw(n)){const{message:u}=U("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(u)}if(!bw(c,s,n.method)){const{message:u}=U("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(u)}if(o&&!Ew(o,nn)){const{message:u}=U("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${nn.min} and ${nn.max}`);throw new Error(u)}},this.isValidRespond=async r=>{if(!ke(r)){const{message:s}=U("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(s)}const{topic:i,response:n}=r;if(await this.isValidSessionTopic(i),!gw(n)){const{message:s}=U("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(s)}},this.isValidPing=async r=>{if(!ke(r)){const{message:n}=U("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async r=>{if(!ke(r)){const{message:c}=U("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(c)}const{topic:i,event:n,chainId:s}=r;await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!Oo(o,s)){const{message:c}=U("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(c)}if(!yw(n)){const{message:c}=U("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(c)}if(!ww(o,s,n.name)){const{message:c}=U("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(c)}},this.isValidDisconnect=async r=>{if(!ke(r)){const{message:n}=U("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.getVerifyContext=async(r,i)=>{const n={verified:{verifyUrl:i.verifyUrl||ni,validation:"UNKNOWN",origin:i.url||""}};try{const s=await this.client.core.verify.resolve({attestationId:r,verifyUrl:i.verifyUrl});s&&(n.verified.origin=s,n.verified.validation=s===new URL(i.url).origin?"VALID":"INVALID")}catch(s){this.client.logger.error(s)}return this.client.logger.info(`Verify context: ${JSON.stringify(n)}`),n},this.validateSessionProps=(r,i)=>{Object.values(r).forEach(n=>{if(!Re(n,!1)){const{message:s}=U("MISSING_OR_INVALID",`${i} must be in Record<string, string> format. Received: ${JSON.stringify(n)}`);throw new Error(s)}})}}async isInitialized(){if(!this.initialized){const{message:e}=U("NOT_INITIALIZED",this.name);throw new Error(e)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(je.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const n=await this.client.core.crypto.decode(r,i);try{ts(n)?(this.client.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):Ii(n)?(await this.client.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.client.core.history.delete(r,n.id)):this.onRelayEventUnknownPayload({topic:r,payload:n})}catch(s){this.client.logger.error(s)}})}registerExpirerEvents(){this.client.core.expirer.on(et.expired,async e=>{const{topic:r,id:i}=_c(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,U("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}isValidPairingTopic(e){if(!Re(e,!1)){const{message:r}=U("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=U("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Nt(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=U("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!Re(e,!1)){const{message:r}=U("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(!this.client.session.keys.includes(e)){const{message:r}=U("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Nt(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:r}=U("EXPIRED",`session topic: ${e}`);throw new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Re(e,!1)){const{message:r}=U("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=U("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!fw(e)){const{message:r}=U("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=U("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Nt(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:r}=U("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class I0 extends xi{constructor(e,r){super(e,r,d0,ns),this.core=e,this.logger=r}}class O0 extends xi{constructor(e,r){super(e,r,g0,ns),this.core=e,this.logger=r}}class x0 extends xi{constructor(e,r){super(e,r,b0,ns,i=>i.id),this.core=e,this.logger=r}}class ss extends ff{constructor(e){super(e),this.protocol=Mc,this.version=Bc,this.name=rn.name,this.events=new at.EventEmitter,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(n){throw this.logger.error(n.message),n}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(n){throw this.logger.error(n.message),n}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(n){throw this.logger.error(n.message),n}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(n){throw this.logger.error(n.message),n}},this.update=async i=>{try{return await this.engine.update(i)}catch(n){throw this.logger.error(n.message),n}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(n){throw this.logger.error(n.message),n}},this.request=async i=>{try{return await this.engine.request(i)}catch(n){throw this.logger.error(n.message),n}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(n){throw this.logger.error(n.message),n}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(n){throw this.logger.error(n.message),n}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(n){throw this.logger.error(n.message),n}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(n){throw this.logger.error(n.message),n}},this.find=i=>{try{return this.engine.find(i)}catch(n){throw this.logger.error(n.message),n}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=(e==null?void 0:e.name)||rn.name,this.metadata=(e==null?void 0:e.metadata)||Nb();const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:$n(Fn({level:(e==null?void 0:e.logger)||rn.logger}));this.core=(e==null?void 0:e.core)||new f0(e),this.logger=Qe(r,this.name),this.session=new O0(this.core,this.logger),this.proposal=new I0(this.core,this.logger),this.pendingRequest=new x0(this.core,this.logger),this.engine=new S0(this)}static async init(e){const r=new ss(e);return await r.initialize(),r}get context(){return Ge(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const K0=ss;export{y0 as ENGINE_CONTEXT,Et as ENGINE_QUEUE_STATES,yr as ENGINE_RPC_OPTS,w0 as METHODS_TO_VERIFY,d0 as PROPOSAL_CONTEXT,p0 as PROPOSAL_EXPIRY_MESSAGE,b0 as REQUEST_CONTEXT,g0 as SESSION_CONTEXT,Qr as SESSION_EXPIRY,nn as SESSION_REQUEST_EXPIRY_BOUNDARIES,jc as SIGN_CLIENT_CONTEXT,rn as SIGN_CLIENT_DEFAULT,Mc as SIGN_CLIENT_PROTOCOL,ns as SIGN_CLIENT_STORAGE_PREFIX,Bc as SIGN_CLIENT_VERSION,K0 as SignClient,Xo as WALLETCONNECT_DEEPLINK_CHOICE,ss as default};
